/*!
 * tui-image-editor.min.js
 * @version 3.14.3-alm.4
 * @author NHN. FE Development Lab <dl_javascript@nhn.com>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("fabric").fabric):"function"==typeof define&&define.amd?define(["fabric"],t):"object"==typeof exports?exports.ImageEditor=t(require("fabric").fabric):(e.tui=e.tui||{},e.tui.ImageEditor=t(e.fabric))}(window,function(n){return r={},i.m=o=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emptyCropRectValues=t.defaultPixelTargetTolerance=t.defaultFilterRangeValues=t.defaultTextRangeValues=t.defaultShapeStrokeValues=t.defaultDrawRangeValues=t.defaultRotateRangeValues=t.defaultIconPath=t.rejectMessages=t.fObjectOptions=t.keyCodes=t.zoomModes=t.drawingMenuNames=t.drawingModes=t.historyNames=t.selectorNames=t.eventNames=t.commandNames=t.CROPZONE_DEFAULT_OPTIONS=t.SHAPE_DEFAULT_OPTIONS=t.componentNames=t.filterType=t.OBJ_TYPE=t.SHAPE_TYPE=t.SHAPE_FILL_TYPE=t.HELP_MENUS=t.DELETE_HELP_MENUS=t.COMMAND_HELP_MENUS=t.ZOOM_HELP_MENUS=void 0;var o=n(1),i=t.ZOOM_HELP_MENUS=["zoomIn","zoomOut","hand"],r=t.COMMAND_HELP_MENUS=["history","undo","redo","reset"],a=t.DELETE_HELP_MENUS=["delete","deleteAll"];t.HELP_MENUS=[].concat(i,r,a),t.SHAPE_FILL_TYPE={FILTER:"filter",COLOR:"color"},t.SHAPE_TYPE=["rect","circle","triangle"],t.OBJ_TYPE={CROPZONE:"cropzone"},t.filterType={VINTAGE:"vintage",SEPIA2:"sepia2",REMOVE_COLOR:"removeColor",COLOR_FILTER:"colorFilter",REMOVE_WHITE:"removeWhite",BLEND_COLOR:"blendColor",BLEND:"blend"},t.componentNames=(0,o.keyMirror)("IMAGE_LOADER","CROPPER","FLIP","ROTATION","FREE_DRAWING","LINE","TEXT","ICON","FILTER","SHAPE","ZOOM"),t.SHAPE_DEFAULT_OPTIONS={lockSkewingX:!0,lockSkewingY:!0,bringForward:!0,isRegular:!1},t.CROPZONE_DEFAULT_OPTIONS={hasRotatingPoint:!1,hasBorders:!1,lockScalingFlip:!0,lockRotation:!0,lockSkewingX:!0,lockSkewingY:!0},t.commandNames={CLEAR_OBJECTS:"clearObjects",LOAD_IMAGE:"loadImage",FLIP_IMAGE:"flip",ROTATE_IMAGE:"rotate",ADD_OBJECT:"addObject",REMOVE_OBJECT:"removeObject",APPLY_FILTER:"applyFilter",REMOVE_FILTER:"removeFilter",ADD_ICON:"addIcon",CHANGE_ICON_COLOR:"changeIconColor",ADD_SHAPE:"addShape",CHANGE_SHAPE:"changeShape",ADD_TEXT:"addText",CHANGE_TEXT:"changeText",CHANGE_TEXT_STYLE:"changeTextStyle",ADD_IMAGE_OBJECT:"addImageObject",RESIZE_CANVAS_DIMENSION:"resizeCanvasDimension",SET_OBJECT_PROPERTIES:"setObjectProperties",SET_OBJECT_POSITION:"setObjectPosition",CHANGE_SELECTION:"changeSelection"},t.eventNames={OBJECT_ACTIVATED:"objectActivated",OBJECT_REMOVED:"objectRemoved",OBJECT_MOVED:"objectMoved",OBJECT_SCALED:"objectScaled",OBJECT_CREATED:"objectCreated",OBJECT_ROTATED:"objectRotated",OBJECT_ADDED:"objectAdded",OBJECT_MODIFIED:"objectModified",TEXT_EDITING:"textEditing",TEXT_CHANGED:"textChanged",ICON_CREATE_RESIZE:"iconCreateResize",ICON_CREATE_END:"iconCreateEnd",ADD_TEXT:"addText",ADD_OBJECT:"addObject",ADD_OBJECT_AFTER:"addObjectAfter",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",REDO_STACK_CHANGED:"redoStackChanged",UNDO_STACK_CHANGED:"undoStackChanged",SELECTION_CLEARED:"selectionCleared",SELECTION_CREATED:"selectionCreated",EXECUTE_COMMAND:"executeCommand",AFTER_UNDO:"afterUndo",AFTER_REDO:"afterRedo",ZOOM_CHANGED:"zoomChanged",HAND_STARTED:"handStarted",HAND_STOPPED:"handStopped",KEY_DOWN:"keydown",KEY_UP:"keyup",INPUT_BOX_EDITING_STARTED:"inputBoxEditingStarted",INPUT_BOX_EDITING_STOPPED:"inputBoxEditingStopped",FOCUS:"focus",BLUR:"blur"},t.selectorNames={COLOR_PICKER_INPUT_BOX:".tui-colorpicker-palette-hex"},t.historyNames={LOAD_IMAGE:"Load",LOAD_MASK_IMAGE:"Mask",ADD_MASK_IMAGE:"Mask",ADD_IMAGE_OBJECT:"Mask",CROP:"Crop",APPLY_FILTER:"Filter",REMOVE_FILTER:"Filter",CHANGE_SHAPE:"Shape",CHANGE_ICON_COLOR:"Icon",ADD_TEXT:"Text",CHANGE_TEXT_STYLE:"Text",REMOVE_OBJECT:"Delete",CLEAR_OBJECTS:"Delete"},t.drawingModes=(0,o.keyMirror)("NORMAL","CROPPER","FREE_DRAWING","LINE_DRAWING","TEXT","SHAPE","ICON","ZOOM"),t.drawingMenuNames={TEXT:"text",CROP:"crop",SHAPE:"shape",ZOOM:"zoom"},t.zoomModes={DEFAULT:"normal",ZOOM:"zoom",HAND:"hand"},t.keyCodes={Z:90,Y:89,C:67,V:86,SHIFT:16,BACKSPACE:8,DEL:46,ARROW_DOWN:40,ARROW_UP:38,SPACE:32},t.fObjectOptions={SELECTION_STYLE:{borderColor:"red",cornerColor:"green",cornerSize:10,originX:"center",originY:"center",transparentCorners:!1}},t.rejectMessages={addedObject:"The object is already added.",flip:"The flipX and flipY setting values are not changed.",invalidDrawingMode:"This operation is not supported in the drawing mode.",invalidParameters:"Invalid parameters.",isLock:"The executing command state is locked.",loadImage:"The background image is empty.",loadingImageFailed:"Invalid image loaded.",noActiveObject:"There is no active object.",noObject:"The object is not in canvas.",redo:"The promise of redo command is reject.",rotation:"The current angle is same the old angle.",undo:"The promise of undo command is reject.",unsupportedOperation:"Unsupported operation.",unsupportedType:"Unsupported object type."},t.defaultIconPath={"icon-arrow":"M40 12V0l24 24-24 24V36H0V12h40z","icon-arrow-2":"M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ","icon-arrow-3":"M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ","icon-star":"M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ","icon-star-2":"M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ","icon-polygon":"M3,31 L19,3 h32 l16,28 l-16,28 H19  z ","icon-location":"M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z","icon-heart":"M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ","icon-bubble":"M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z"},t.defaultRotateRangeValues={realTimeEvent:!0,min:-360,max:360,value:0},t.defaultDrawRangeValues={min:5,max:30,value:12},t.defaultShapeStrokeValues={realTimeEvent:!0,min:2,max:300,value:3},t.defaultTextRangeValues={realTimeEvent:!0,min:10,max:100,value:50},t.defaultFilterRangeValues={tintOpacityRange:{realTimeEvent:!0,min:0,max:1,value:.7,useDecimal:!0},removewhiteDistanceRange:{realTimeEvent:!0,min:0,max:1,value:.2,useDecimal:!0},brightnessRange:{realTimeEvent:!0,min:-1,max:1,value:0,useDecimal:!0},noiseRange:{realTimeEvent:!0,min:0,max:1e3,value:100},pixelateRange:{realTimeEvent:!0,min:2,max:20,value:4},colorfilterThresholdRange:{realTimeEvent:!0,min:0,max:1,value:.2,useDecimal:!0},blurFilterRange:{value:.1}},t.defaultPixelTargetTolerance=10,t.emptyCropRectValues={LEFT:0,TOP:0,WIDTH:.5,HEIGHT:.5}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Promise=void 0,t.clamp=function(e,t,n){if(n<t){var o=[n,t];t=o[0],n=o[1]}return l(t,u(e,n))},t.keyMirror=function(){for(var t={},e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return(0,i.forEach)(n,function(e){t[e]=e}),t},t.makeStyleText=function(e){var n="";return(0,i.forEach)(e,function(e,t){n+=t+": "+e+";"}),n},t.getProperties=function(e,t){var n={},o=t.length,i=0,r=void 0;for(i=0;i<o;i+=1)r=t[i],n[r]=e[r];return n},t.toInteger=function(e){return parseInt(e,10)},t.toCamelCase=function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})},t.isSupportFileApi=function(){return!!(window.File&&window.FileList&&window.FileReader)},t.getRgb=function(e,t){4===e.length&&(e=""+e+e.slice(1,4));var n=parseInt(e.slice(1,3),16),o=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return"rgba("+n+", "+o+", "+i+", "+(t||1)+")"},t.sendHostName=function(){},t.styleLoad=function(e,t){var n=document.getElementsByTagName("head")[0],o=document.createElement("link"),i=encodeURIComponent(e);t&&(o.id=t);o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href","data:text/css;charset=UTF-8,"+i),n.appendChild(o)},t.getSelector=function(t){return function(e){return t.querySelector(e)}},t.base64ToBlob=function(e){var n="",t=void 0,o=void 0,i=void 0;t=e.replace(/data:(image\/.+);base64,/,function(e,t){return n=t,""});var r=(t=atob(t)).length;for(o=new Uint8Array(r),i=0;i<r;i+=1)o[i]=t.charCodeAt(i);return new Blob([o],{type:n})},t.fixFloatingPoint=function(e){return Number(e.toFixed(s))},t.assignmentForDestroy=function(n){(0,i.forEach)(n,function(e,t){n[t]=null})},t.cls=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return"."!==e.charAt(0)?""+c+t+e:"."+c+t+e.slice(1)},t.changeOrigin=function(e,t){var n=t.originX,o=t.originY,i=e.getPointByOrigin(n,o),r=i.x,a=i.y;e.set({left:r,top:a,originX:n,originY:o}),e.setCoords()},t.flipObject=function(t){var n={};return Object.keys(t).forEach(function(e){n[t[e]]=e}),n},t.setCustomProperty=function(e,t){e.customProps=e.customProps||{},(0,i.extend)(e.customProps,t)},t.getCustomProperty=function(t,e){var n={};(0,i.isString)(e)&&(e=[e]);return(0,i.forEach)(e,function(e){n[e]=t.customProps[e]}),n},t.capitalizeString=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},t.includes=h,t.getFillTypeFromOption=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,i.pick)(e,"type")||v.SHAPE_FILL_TYPE.COLOR},t.getFillTypeFromObject=function(e){var t=e.fill;if((void 0===t?{}:t).source)return v.SHAPE_FILL_TYPE.FILTER;return v.SHAPE_FILL_TYPE.COLOR},t.isShape=function(e){return 0<=(0,i.inArray)(e.get("type"),v.SHAPE_TYPE)},t.getObjectType=function(e){if(h(v.SHAPE_TYPE,e))return"Shape";switch(e){case"i-text":return"Text";case"path":case"line":return"Draw";case"activeSelection":return"Group";default:return g(e)}},t.isSilentCommand=function(e){var t=v.commandNames.LOAD_IMAGE;return"string"==typeof e?t===e:t===e.name},t.getHistoryTitle=function(e){var t=v.commandNames.FLIP_IMAGE,n=v.commandNames.ROTATE_IMAGE,o=v.commandNames.ADD_TEXT,i=v.commandNames.APPLY_FILTER,r=v.commandNames.REMOVE_FILTER,a=v.commandNames.CHANGE_SHAPE,s=v.commandNames.CHANGE_ICON_COLOR,c=v.commandNames.CHANGE_TEXT_STYLE,u=v.commandNames.CLEAR_OBJECTS,l=v.commandNames.ADD_IMAGE_OBJECT,h=v.commandNames.REMOVE_OBJECT,f=e.name,d=e.args,p=void 0;switch(f){case t:p={name:f,detail:"reset"===d[1]?d[1]:d[1].slice(4)};break;case n:p={name:f,detail:d[2]};break;case i:p={name:v.historyNames.APPLY_FILTER,detail:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.useAlpha,o=void 0===n||n,i=t.mode,r=v.filterType.VINTAGE,a=v.filterType.REMOVE_COLOR,s=v.filterType.BLEND_COLOR,c=v.filterType.SEPIA2,u=v.filterType.COLOR_FILTER,l=v.filterType.REMOVE_WHITE,h=v.filterType.BLEND,f=void 0;switch(e){case r:f=c;break;case a:f=o?u:l;break;case s:f="add"===i?h:i;break;default:f=e}return g(f)}(d[1],d[2])};break;case r:p={name:v.historyNames.REMOVE_FILTER,detail:"Remove"};break;case a:p={name:v.historyNames.CHANGE_SHAPE,detail:"Change"};break;case s:p={name:v.historyNames.CHANGE_ICON_COLOR,detail:"Change"};break;case c:p={name:v.historyNames.CHANGE_TEXT_STYLE,detail:"Change"};break;case h:p={name:v.historyNames.REMOVE_OBJECT,detail:d[2]};break;case u:p={name:v.historyNames.CLEAR_OBJECTS,detail:"All"};break;case l:p={name:v.historyNames.ADD_IMAGE_OBJECT,detail:"Add"};break;case o:p={name:v.historyNames.ADD_TEXT};break;default:p={name:f}}"mask"===d[1]&&(p={name:v.historyNames.LOAD_MASK_IMAGE,detail:"Apply"});return p},t.getHelpMenuBarPosition=function(e){return"top"!==e?"left"!==e?"right"!==e?"top":"left":"right":"bottom"},t.isEmptyCropzone=function(e){var t=e.left,n=e.top,o=e.width,i=e.height,r=v.emptyCropRectValues.LEFT,a=v.emptyCropRectValues.TOP,s=v.emptyCropRectValues.WIDTH,c=v.emptyCropRectValues.HEIGHT;return t===r&&n===a&&o===s&&i===c};var o,i=n(2),r=n(72),a=(o=r)&&o.__esModule?o:{default:o},v=n(0);var s=2,c="tui-image-editor-",u=Math.min,l=Math.max;function h(e,t){return 0<=e.indexOf(t)}function g(e){return e.replace(/[a-z]/,function(e){return e.toUpperCase()})}t.Promise=a.default},function(e,t,n){"use strict";
/*!
 * @file This file contains functions from tui.code-snippet@1.5.2 that are required by our custom
 * build of this package.
 * @author NHN. FE Development Lab <dl_javascript@nhn.com>
 * @license MIT
 */var o=0;function r(e,t,n){(s(e)?i:a)(e,t,n)}function i(e,t,n){var o=0,i=e.length;for(n=n||null;o<i&&!1!==t.call(n,e[o],o,e);o+=1);}function a(e,t,n){var o;for(o in n=n||null,e)if(e.hasOwnProperty(o)&&!1===t.call(n,e[o],o,e))break}function s(e){return e instanceof Array}function c(e){return e instanceof Function}function u(e){return null===e}function l(e){return e===Object(e)}function h(e){return void 0===e}e.exports={extend:function(e,t){var n,o,i,r,a=Object.prototype.hasOwnProperty;for(i=1,r=arguments.length;i<r;i+=1)for(o in n=arguments[i])a.call(n,o)&&(e[o]=n[o]);return e},filter:function(e,t,n){var o,i;if(n=n||null,!l(e)||!c(t))throw new Error("wrong parameter");return i=s(e)?(o=[],function(e,t){e.push(t[0])}):(o={},function(e,t){e[t[1]]=t[0]}),r(e,function(){t.apply(n,arguments)&&i(o,arguments)},n),o},forEach:r,forEachArray:i,forEachOwnProperties:a,inArray:function(e,t,n){var o,i;if(n=n||0,!s(t))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e,n);for(i=t.length,o=n;0<=n&&o<i;o+=1)if(t[o]===e)return o;return-1},isArray:s,isExisty:function(e){return!h(e)&&!u(e)},isFunction:c,isObject:l,isString:function(e){return"string"==typeof e||e instanceof String},isUndefined:h,map:function(e,t,n){var o=[];return n=n||null,r(e,function(){o.push(t.apply(n,arguments))}),o},pick:function(e,t){for(var n=arguments,o=n[0],i=1,r=n.length;i<r;i+=1){if(h(o)||u(o))return;o=o[n[i]]}return o},stamp:function(e){return e.__fe_id||(o+=1,e.__fe_id=o),e.__fe_id}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(71),r=(o=i)&&o.__esModule?o:{default:o};var a={};t.default={create:function(e){var t=a[e];if(t){for(var n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return new r.default(t,o)}return null},register:function(e){a[e.name]=e}}},function(e,t){e.exports=n},function(n,e,t){(function(e){function t(e){return e&&e.Math==Math&&e}n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof e&&e)||Function("return this")()}).call(this,t(78))},function(e,t,n){var o=n(5),i=n(47),r=n(11),a=n(48),s=n(53),c=n(85),u=i("wks"),l=o.Symbol,h=c?l:l&&l.withoutSetter||a;e.exports=function(e){return r(u,e)||(s&&r(l,e)?u[e]=l[e]:u[e]=h("Symbol."+e)),u[e]}},function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0});var i=(function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}(r,[{key:"fire",value:function(){for(var e=this.graphics,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return this.graphics.fire.apply(e,n)}},{key:"setCanvasImage",value:function(e,t){this.graphics.setCanvasImage(e,t)}},{key:"getCanvasElement",value:function(){return this.graphics.getCanvasElement()}},{key:"getCanvas",value:function(){return this.graphics.getCanvas()}},{key:"getCanvasImage",value:function(){return this.graphics.getCanvasImage()}},{key:"getImageName",value:function(){return this.graphics.getImageName()}},{key:"getEditor",value:function(){return this.graphics.getEditor()}},{key:"getName",value:function(){return this.name}},{key:"setImageProperties",value:function(e,t){this.graphics.setImageProperties(e,t)}},{key:"setCanvasCssDimension",value:function(e){this.graphics.setCanvasCssDimension(e)}},{key:"setCanvasBackstoreDimension",value:function(e){this.graphics.setCanvasBackstoreDimension(e)}},{key:"adjustCanvasDimension",value:function(){this.graphics.adjustCanvasDimension()}},{key:"adjustCanvasDimensionForRotate",value:function(){this.graphics.adjustCanvasDimensionForRotate()}}]),r);function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.name=e,this.graphics=t}t.default=i},function(e,t,n){var o=n(12),i=n(19),r=n(25);e.exports=o?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var o=n(13);e.exports=function(e){if(!o(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var o=n(9);e.exports=!o(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){"use strict";function m(o){function e(e,t,n){if(this instanceof o){switch(arguments.length){case 0:return new o;case 1:return new o(e);case 2:return new o(e,t)}return new o(e,t,n)}return o.apply(this,arguments)}return e.prototype=o.prototype,e}var _=n(5),y=n(50).f,b=n(51),O=n(35),E=n(36),C=n(8),k=n(11);e.exports=function(e,t){var n,o,i,r,a,s,c,u,l=e.target,h=e.global,f=e.stat,d=e.proto,p=h?_:f?_[l]:(_[l]||{}).prototype,v=h?O:O[l]||(O[l]={}),g=v.prototype;for(i in t)n=!b(h?i:l+(f?".":"#")+i,e.forced)&&p&&k(p,i),a=v[i],n&&(s=e.noTargetGet?(u=y(p,i))&&u.value:p[i]),r=n&&s?s:t[i],n&&typeof a==typeof r||(c=e.bind&&n?E(r,_):e.wrap&&n?m(r):d&&"function"==typeof r?E(Function.call,r):r,(e.sham||r&&r.sham||a&&a.sham)&&C(c,"sham",!0),v[i]=c,d&&(k(O,o=l+"Prototype")||C(O,o,{}),O[o][i]=r,e.real&&g&&!g[i]&&C(g,i,r)))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(42),s=(r=a)&&r.__esModule?r:{default:r};var c=s.default.create,u=s.default.types,l=(o(h,[{key:"getName",value:function(){return this.name}},{key:"start",value:function(){throw new Error(c(u.UN_IMPLEMENTATION,"start"))}},{key:"end",value:function(){throw new Error(c(u.UN_IMPLEMENTATION,"stop"))}}]),h);function h(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.name=e}t.default=l},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,n){function o(e){return"function"==typeof e?e:void 0}var i=n(35),r=n(5);e.exports=function(e,t){return arguments.length<2?o(i[e])||o(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}},function(e,t){e.exports={}},function(e,t,n){var o=n(12),i=n(45),r=n(10),a=n(46),s=Object.defineProperty;t.f=o?s:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t){e.exports=!0},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){"use strict";function o(e){var n,o;this.promise=new e(function(e,t){if(void 0!==n||void 0!==o)throw TypeError("Bad Promise constructor");n=e,o=t}),this.resolve=i(n),this.reject=i(o)}var i=n(16);e.exports.f=function(e){return new o(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCachedUndoDataForDimension=function(e){o=e},t.getCachedUndoDataForDimension=function(){return o},t.makeSelectionUndoData=function(u,l){var e=void 0;e="activeSelection"===u.type?u.getObjects().map(function(e){var t=e.angle,n=e.left,o=e.top,i=e.scaleX,r=e.scaleY,a=e.width,s=e.height;u.realizeTransform(e);var c=l(e);return e.set({angle:t,left:n,top:o,width:a,height:s,scaleX:i,scaleY:r}),c}):[l(u)];return e},t.makeSelectionUndoDatum=function(e,t,n){var o=void 0;n?o={id:e,width:t.width,height:t.height,top:t.top,left:t.left,angle:t.angle,scaleX:t.scaleX,scaleY:t.scaleY}:(o=(0,i.extend)({id:e},t),"i-text"===t.type&&(o.isEditing=!1));return o};var i=n(2),o=null},function(e,t,n){var o,i,r,a=n(77),s=n(5),c=n(13),u=n(8),l=n(11),h=n(33),f=n(34),d=s.WeakMap;if(a){var p=new d,v=p.get,g=p.has,m=p.set;o=function(e,t){return m.call(p,e,t),t},i=function(e){return v.call(p,e)||{}},r=function(e){return g.call(p,e)}}else{var _=h("state");f[_]=!0,o=function(e,t){return u(e,_,t),t},i=function(e){return l(e,_)?e[_]:{}},r=function(e){return l(e,_)}}e.exports={set:o,get:i,has:r,enforce:function(e){return r(e)?i(e):o(e,{})},getterFor:function(n){return function(e){var t;if(!c(e)||(t=i(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var o=n(81),i=n(31);e.exports=function(e){return o(i(e))}},function(e,t,n){var i=n(8);e.exports=function(e,t,n,o){o&&o.enumerable?e[t]=n:i(e,t,n)}},function(e,t,n){function d(e,t){this.stopped=e,this.result=t}var p=n(10),v=n(101),g=n(55),m=n(36),_=n(102),y=n(103);(e.exports=function(e,t,n,o,i){var r,a,s,c,u,l,h,f=m(t,n,o?2:1);if(i)r=e;else{if("function"!=typeof(a=_(e)))throw TypeError("Target is not iterable");if(v(a)){for(s=0,c=g(e.length);s<c;s++)if((u=o?f(p(h=e[s])[0],h[1]):f(e[s]))&&u instanceof d)return u;return new d(!1)}r=a.call(e)}for(l=r.next;!(h=l.call(r)).done;)if("object"==typeof(u=y(r,f,h.value,o))&&u&&u instanceof d)return u;return new d(!1)}).stop=function(e){return new d(!0,e)}},function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},function(e,t){var n=Math.ceil,o=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?o:n)(e)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var o=n(5),i=n(13),r=o.document,a=i(r)&&i(r.createElement);e.exports=function(e){return a?r.createElement(e):{}}},function(e,t,n){var o=n(47),i=n(48),r=o("keys");e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports={}},function(e,t){e.exports={}},function(e,t,n){var r=n(16);e.exports=function(o,i,e){if(r(o),void 0===i)return o;switch(e){case 0:return function(){return o.call(i)};case 1:return function(e){return o.call(i,e)};case 2:return function(e,t){return o.call(i,e,t)};case 3:return function(e,t,n){return o.call(i,e,t,n)}}return function(){return o.apply(i,arguments)}}},function(e,t,n){var o=n(11),i=n(83),r=n(33),a=n(84),s=r("IE_PROTO"),c=Object.prototype;e.exports=a?Object.getPrototypeOf:function(e){return e=i(e),o(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},function(e,t,n){var r=n(39),a=n(19).f,s=n(8),c=n(11),u=n(91),l=n(6)("toStringTag");e.exports=function(e,t,n,o){if(e){var i=n?e:e.prototype;c(i,l)||a(i,l,{configurable:!0,value:t}),o&&!r&&s(i,"toString",u)}}},function(e,t,n){var o={};o[n(6)("toStringTag")]="z",e.exports="[object z]"===String(o)},function(e,t,n){var o=n(39),i=n(21),r=n(6)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=o?i:function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),r))?n:a?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){"use strict";
/*!
 * @file This file is src/customEvent.js from tui.code-snippet@1.5.2 with some minor edits to use
 * our new codeSnippet.js file.
 * @author NHN. FE Development Lab <dl_javascript@nhn.com>
 * @license MIT
 */var a=n(2),s=/\s+/g;function o(){this.events=null,this.contexts=null}o.mixin=function(e){a.extend(e.prototype,o.prototype)},o.prototype._getHandlerItem=function(e,t){var n={handler:e};return t&&(n.context=t),n},o.prototype._safeEvent=function(e){var t,n=this.events;return n=n||(this.events={}),e&&((t=n[e])||(t=[],n[e]=t),n=t),n},o.prototype._safeContext=function(){var e=this.contexts;return e=e||(this.contexts=[])},o.prototype._indexOfContext=function(e){for(var t=this._safeContext(),n=0;t[n];){if(e===t[n][0])return n;n+=1}return-1},o.prototype._memorizeContext=function(e){var t,n;a.isExisty(e)&&(t=this._safeContext(),-1<(n=this._indexOfContext(e))?t[n][1]+=1:t.push([e,1]))},o.prototype._forgetContext=function(e){var t,n;a.isExisty(e)&&(t=this._safeContext(),-1<(n=this._indexOfContext(e))&&(--t[n][1],t[n][1]<=0&&t.splice(n,1)))},o.prototype._bindEvent=function(e,t,n){var o=this._safeEvent(e);this._memorizeContext(n),o.push(this._getHandlerItem(t,n))},o.prototype.on=function(e,t,n){var o=this;a.isString(e)?(e=e.split(s),a.forEach(e,function(e){o._bindEvent(e,t,n)})):a.isObject(e)&&(n=t,a.forEach(e,function(e,t){o.on(t,e,n)}))},o.prototype.once=function(t,n,o){var i=this;if(a.isObject(t))return o=n,void a.forEach(t,function(e,t){i.once(t,e,o)});this.on(t,function e(){n.apply(o,arguments),i.off(t,e,o)},o)},o.prototype._spliceMatches=function(e,t){var n,o=0;if(a.isArray(e))for(n=e.length;o<n;o+=1)!0===t(e[o])&&(e.splice(o,1),--n,--o)},o.prototype._matchHandler=function(n){var o=this;return function(e){var t=n===e.handler;return t&&o._forgetContext(e.context),t}},o.prototype._matchContext=function(n){var o=this;return function(e){var t=n===e.context;return t&&o._forgetContext(e.context),t}},o.prototype._matchHandlerAndContext=function(i,r){var a=this;return function(e){var t=i===e.handler,n=r===e.context,o=t&&n;return o&&a._forgetContext(e.context),o}},o.prototype._offByEventName=function(e,t){var n=this,o=a.forEachArray,i=a.isFunction(t),r=n._matchHandler(t);e=e.split(s),o(e,function(e){var t=n._safeEvent(e);i?n._spliceMatches(t,r):(o(t,function(e){n._forgetContext(e.context)}),n.events[e]=[])})},o.prototype._offByHandler=function(e){var t=this,n=this._matchHandler(e);a.forEach(this._safeEvent(),function(e){t._spliceMatches(e,n)})},o.prototype._offByObject=function(e,t){var n,o=this;this._indexOfContext(e)<0?a.forEach(e,function(e,t){o.off(t,e)}):a.isString(t)?(n=this._matchContext(e),o._spliceMatches(this._safeEvent(t),n)):a.isFunction(t)?(n=this._matchHandlerAndContext(t,e),a.forEach(this._safeEvent(),function(e){o._spliceMatches(e,n)})):(n=this._matchContext(e),a.forEach(this._safeEvent(),function(e){o._spliceMatches(e,n)}))},o.prototype.off=function(e,t){a.isString(e)?this._offByEventName(e,t):arguments.length?a.isFunction(e)?this._offByHandler(e):a.isObject(e)&&this._offByObject(e,t):(this.events={},this.contexts=[])},o.prototype.fire=function(e){this.invoke.apply(this,arguments)},o.prototype.invoke=function(e){var t,n,o,i;if(!this.hasListener(e))return!0;for(t=this._safeEvent(e),n=Array.prototype.slice.call(arguments,1),o=0;t[o];){if(!1===(i=t[o]).handler.apply(i.context,n))return!1;o+=1}return!0},o.prototype.hasListener=function(e){return 0<this.getListenerLength(e)},o.prototype.getListenerLength=function(e){return this._safeEvent(e).length},e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(2),r=(o=i)&&o.__esModule?o:{default:o};var a=(0,n(1).keyMirror)("UN_IMPLEMENTATION","NO_COMPONENT_NAME"),s="Should implement a method: ",c="Should set a component name",u={UN_IMPLEMENTATION:function(e){return s+e},NO_COMPONENT_NAME:function(){return c}};t.default={types:r.default.extend({},a),create:function(e){e=e.toLowerCase();for(var t=u[e],n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return t.apply(void 0,o)}}},function(e,t,n){var o=n(44),i=Function.toString;"function"!=typeof o.inspectSource&&(o.inspectSource=function(e){return i.call(e)}),e.exports=o.inspectSource},function(e,t,n){var o=n(5),i=n(79),r="__core-js_shared__",a=o[r]||i(r,{});e.exports=a},function(e,t,n){var o=n(12),i=n(9),r=n(32);e.exports=!o&&!i(function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(13);e.exports=function(e,t){if(!i(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!i(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var o=n(20),i=n(44);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:o?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,o=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+o).toString(36)}},function(e,t,n){"use strict";function m(){return this}var _=n(14),y=n(82),b=n(37),O=n(58),E=n(38),C=n(8),k=n(27),o=n(6),M=n(20),w=n(18),i=n(52),x=i.IteratorPrototype,P=i.BUGGY_SAFARI_ITERATORS,j=o("iterator"),T="values",S="entries";e.exports=function(e,t,n,o,i,r,a){y(n,t,o);function s(e){if(e===i&&v)return v;if(!P&&e in d)return d[e];switch(e){case"keys":case T:case S:return function(){return new n(this,e)}}return function(){return new n(this)}}var c,u,l,h=t+" Iterator",f=!1,d=e.prototype,p=d[j]||d["@@iterator"]||i&&d[i],v=!P&&p||s(i),g="Array"==t&&d.entries||p;if(g&&(c=b(g.call(new e)),x!==Object.prototype&&c.next&&(M||b(c)===x||(O?O(c,x):"function"!=typeof c[j]&&C(c,j,m)),E(c,h,!0,!0),M&&(w[h]=m))),i==T&&p&&p.name!==T&&(f=!0,v=function(){return p.call(this)}),M&&!a||d[j]===v||C(d,j,v),w[t]=v,i)if(u={values:s(T),keys:r?v:s("keys"),entries:s(S)},a)for(l in u)!P&&!f&&l in d||k(d,l,u[l]);else _({target:t,proto:!0,forced:P||f},u);return u}},function(e,t,n){var o=n(12),i=n(80),r=n(25),a=n(26),s=n(46),c=n(11),u=n(45),l=Object.getOwnPropertyDescriptor;t.f=o?l:function(e,t){if(e=a(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return r(!i.f.call(e,t),e[t])}},function(e,t,n){function o(e,t){var n=s[a(e)];return n==u||n!=c&&("function"==typeof t?i(t):!!t)}var i=n(9),r=/#|\.prototype\./,a=o.normalize=function(e){return String(e).replace(r,".").toLowerCase()},s=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},function(e,t,n){"use strict";var o,i,r,a=n(37),s=n(8),c=n(11),u=n(6),l=n(20),h=u("iterator"),f=!1;[].keys&&("next"in(r=[].keys())?(i=a(a(r)))!==Object.prototype&&(o=i):f=!0),null==o&&(o={}),l||c(o,h)||s(o,h,function(){return this}),e.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:f}},function(e,t,n){var o=n(9);e.exports=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())})},function(e,t,n){function o(){}function i(e){return"<script>"+e+"</"+p+">"}var r,a=n(10),s=n(86),c=n(56),u=n(34),l=n(57),h=n(32),f=n(33),d="prototype",p="script",v=f("IE_PROTO"),g=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;g=r?function(e){e.write(i("")),e.close();var t=e.parentWindow.Object;return e=null,t}(r):((t=h("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(i("document.F=Object")),e.close(),e.F);for(var n=c.length;n--;)delete g[d][c[n]];return g()};u[v]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(o[d]=a(e),n=new o,o[d]=null,n[v]=e):n=g(),void 0===t?n:s(n,t)}},function(e,t,n){var o=n(30),i=Math.min;e.exports=function(e){return 0<e?i(o(e),9007199254740991):0}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var o=n(17);e.exports=o("document","documentElement")},function(e,t,n){var i=n(10),r=n(92);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,o=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),o=e instanceof Array}catch(e){}return function(e,t){return i(e),r(t),o?n.call(e,t):e.__proto__=t,e}}():void 0)},function(e,t,n){var o=n(5);e.exports=o.Promise},function(e,t,n){var i=n(10),r=n(16),a=n(6)("species");e.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||null==(n=i(o)[a])?t:r(n)}},function(e,t,n){function o(e){if(k.hasOwnProperty(e)){var t=k[e];delete k[e],t()}}function i(e){return function(){o(e)}}function r(e){o(e.data)}function a(e){l.postMessage(e+"",m.protocol+"//"+m.host)}var s,c,u,l=n(5),h=n(9),f=n(21),d=n(36),p=n(57),v=n(32),g=n(62),m=l.location,_=l.setImmediate,y=l.clearImmediate,b=l.process,O=l.MessageChannel,E=l.Dispatch,C=0,k={},M="onreadystatechange";_&&y||(_=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return k[++C]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},s(C),C},y=function(e){delete k[e]},"process"==f(b)?s=function(e){b.nextTick(i(e))}:E&&E.now?s=function(e){E.now(i(e))}:O&&!g?(u=(c=new O).port2,c.port1.onmessage=r,s=d(u.postMessage,u,1)):!l.addEventListener||"function"!=typeof postMessage||l.importScripts||h(a)?s=M in v("script")?function(e){p.appendChild(v("script"))[M]=function(){p.removeChild(this),o(e)}}:function(e){setTimeout(i(e),0)}:(s=a,l.addEventListener("message",r,!1))),e.exports={set:_,clear:y}},function(e,t,n){var o=n(63);e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(o)},function(e,t,n){var o=n(17);e.exports=o("navigator","userAgent")||""},function(e,t,n){var o=n(10),i=n(13),r=n(22);e.exports=function(e,t){if(o(e),i(t)&&t.constructor===e)return t;var n=r.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var o=n(14),u=n(16),i=n(22),r=n(29),l=n(28);o({target:"Promise",stat:!0},{allSettled:function(e){var s=this,t=i.f(s),c=t.resolve,n=t.reject,o=r(function(){var o=u(s.resolve),i=[],r=0,a=1;l(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(s,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--a||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--a||c(i))})}),--a||c(i)});return o.error&&n(o.value),t.promise}})},function(e,t,n){"use strict";var I={rect:1,circle:2,triangle:1},N={rect:{w:"width",h:"height"},circle:{w:"rx",h:"ry"},triangle:{w:"width",h:"height"}};function R(e,t,n){var o=e.x,i=e.y,r=t.x,a=t.y,s=n*Math.PI/180;return{originX:(r-o)*Math.cos(s)-(a-i)*Math.sin(s)+o<o?"right":"left",originY:(r-o)*Math.sin(s)+(a-i)*Math.cos(s)+i<i?"bottom":"top"}}e.exports={setOrigins:function(e){var t=e.getPointByOrigin("left","top"),n=e.getPointByOrigin("right","top"),o=e.getPointByOrigin("right","bottom"),i=e.getPointByOrigin("left","bottom");e.origins={lt:t,rt:n,rb:o,lb:i}},resize:function(e,t,n){var o,i,r,a,s,c,u,l,h,f,d,p,v,g,m,_,y,b,O,E,C,k,M,w,x,P,j,T,S,A,D;"center"===(g=e).originX&&"center"===g.originY&&(s=t,u=(c=e).getPointByOrigin("center","center"),l=R(u,s,-c.angle),h=l.originX,f=l.originY,d=c.getPointByOrigin(h,f),p=c.left-(u.x-d.x),v=c.top-(u.y-d.y),c.set({originX:h,originY:f,left:p,top:v}),c.setCoords(),i=(o=e).originX,r=o.originY,a=i.substring(0,1)+r.substring(0,1),o.startPoint=o.origins[a]),n?function(e){var t=e.type,n=e.scaleX,o=e.scaleY,i=N[t],r=e[i.w]*n,a=e[i.h]*o;if(e.isRegular){var s=Math.max(n,o);r=e[i.w]*s,a=e[i.h]*s}var c={hasControls:!1,hasBorders:!1,scaleX:1,scaleY:1};c[i.w]=r,c[i.h]=a,e.set(c)}(e):(m=t,y=(_=e).type,b=_.strokeWidth,O=_.startPoint,E=I[y],C=N[y],k=!("triangle"!==_.type),M={},w=Math.abs(O.x-m.x)/E,x=Math.abs(O.y-m.y)/E,b<w&&(w-=b/E),b<x&&(x-=b/E),_.isRegular&&(w=x=Math.max(w,x),k&&(x=Math.sqrt(3)/2*w)),M[C.w]=w,M[C.h]=x,_.set(M)),P=t,T=(j=e).startPoint,S=R(T,P,-j.angle),A=S.originX,D=S.originY,j.setPositionByOrigin(T,A,D),j.setCoords()},adjustOriginToCenter:function(e){var t=e.getPointByOrigin("center","center"),n=e.originX,o=e.originY,i=e.getPointByOrigin(n,o),r=e.left+(t.x-i.x),a=e.top+(t.y-i.y);e.set({hasControls:!0,hasBorders:!0,originX:"center",originY:"center",left:r,top:a}),e.setCoords()}}},function(e,t,n){"use strict";n(68);var o,i=n(69),r=(o=i)&&o.__esModule?o:{default:o};n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),e.exports=r.default},function(e,t,n){"use strict";Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */,"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(e){if("Element"in e){var t="classList",n="prototype",o=e.Element[n],i=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[n].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},c=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(e,t)},u=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,i=n.length;o<i;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},l=u[n]=[],h=function(){return new u(this)};if(s[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return-1!==c(this,e+="")},l.add=function(){for(var e,t=arguments,n=0,o=t.length,i=!1;-1===c(this,e=t[n]+"")&&(this.push(e),i=!0),++n<o;);i&&this._updateClassName()},l.remove=function(){var e,t,n=arguments,o=0,i=n.length,r=!1;do{for(t=c(this,e=n[o]+"");-1!==t;)this.splice(t,1),r=!0,t=c(this,e)}while(++o<i);r&&this._updateClassName()},l.toggle=function(e,t){e+="";var n=this.contains(e),o=n?!0!==t&&"remove":!1!==t&&"add";return o&&this[o](e),!0===t||!1===t?t:!n},l.toString=function(){return this.join(" ")},i.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(o,t,f)}catch(e){void 0!==e.number&&-2146823252!==e.number||(f.enumerable=!1,i.defineProperty(o,t,f))}}else i[n].__defineGetter__&&o.__defineGetter__(t,h)}}(window.self),function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var o=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var t,n=arguments.length;for(t=0;t<n;t++)e=arguments[t],o.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}())
/*!
 * @copyright Copyright (c) 2017 IcoMoon.io
 * @license   Licensed under MIT license
 *            See https://github.com/Keyamoon/svgxuse
 * @version   1.2.6
 */},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=p(n(2)),a=p(n(70)),s=p(n(113)),c=p(n(3)),u=p(n(115)),l=n(23),h=n(1),f=n(0),d=p(n(41));function p(e){return e&&e.__esModule?e:{default:e}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=r.default.isUndefined,m=r.default.forEach,_=f.eventNames.MOUSE_DOWN,y=f.eventNames.MOUSE_UP,b=f.eventNames.MOUSE_MOVE,O=f.eventNames.OBJECT_MOVED,E=f.eventNames.OBJECT_SCALED,C=f.eventNames.OBJECT_ACTIVATED,k=f.eventNames.OBJECT_ROTATED,M=f.eventNames.OBJECT_ADDED,w=f.eventNames.OBJECT_REMOVED,x=f.eventNames.OBJECT_MODIFIED,P=f.eventNames.ADD_TEXT,j=f.eventNames.ADD_OBJECT,T=f.eventNames.TEXT_EDITING,S=f.eventNames.TEXT_CHANGED,A=f.eventNames.ICON_CREATE_RESIZE,D=f.eventNames.ICON_CREATE_END,I=f.eventNames.SELECTION_CLEARED,N=f.eventNames.SELECTION_CREATED,R=f.eventNames.ADD_OBJECT_AFTER,L=(o(F,[{key:"_attachColorPickerInputBoxEvents",value:function(){var e=this;this.ui.on(f.eventNames.INPUT_BOX_EDITING_STARTED,function(){e.isColorPickerInputBoxEditing=!0}),this.ui.on(f.eventNames.INPUT_BOX_EDITING_STOPPED,function(){e.isColorPickerInputBoxEditing=!1})}},{key:"_detachColorPickerInputBoxEvents",value:function(){this.ui.off(f.eventNames.INPUT_BOX_EDITING_STARTED),this.ui.off(f.eventNames.INPUT_BOX_EDITING_STOPPED)}},{key:"_setSelectionStyle",value:function(t,e){var n=e.applyCropSelectionStyle,o=e.applyGroupSelectionStyle;t&&this._graphics.setSelectionStyle(t),n&&this._graphics.setCropSelectionStyle(t),o&&this.on("selectionCreated",function(e){"activeSelection"===e.type&&e.set(t)})}},{key:"_attachInvokerEvents",value:function(){var t=this,e=f.eventNames.UNDO_STACK_CHANGED,n=f.eventNames.REDO_STACK_CHANGED,o=f.eventNames.EXECUTE_COMMAND,i=f.eventNames.AFTER_UNDO,r=f.eventNames.AFTER_REDO,a=f.eventNames.HAND_STARTED,s=f.eventNames.HAND_STOPPED;if(this._invoker.on(e,this.fire.bind(this,e)),this._invoker.on(n,this.fire.bind(this,n)),this.ui){var c=this._graphics.getCanvas();this._invoker.on(o,function(e){return t.ui.fire(o,e)}),this._invoker.on(i,function(e){return t.ui.fire(i,e)}),this._invoker.on(r,function(e){return t.ui.fire(r,e)}),c.on(a,function(){return t.ui.fire(a)}),c.on(s,function(){return t.ui.fire(s)})}}},{key:"_attachGraphicsEvents",value:function(){var e;this._graphics.on((v(e={},_,this._handlers.mousedown),v(e,y,this._handlers.mouseup),v(e,b,this._handlers.mousemove),v(e,O,this._handlers.objectMoved),v(e,E,this._handlers.objectScaled),v(e,k,this._handlers.objectRotated),v(e,C,this._handlers.objectActivated),v(e,M,this._handlers.objectAdded),v(e,w,this._handlers.objectRemoved),v(e,x,this._handlers.objectModified),v(e,P,this._handlers.addText),v(e,j,this._handlers.addObject),v(e,T,this._handlers.textEditing),v(e,S,this._handlers.textChanged),v(e,A,this._handlers.iconCreateResize),v(e,D,this._handlers.iconCreateEnd),v(e,I,this._handlers.selectionCleared),v(e,N,this._handlers.selectionCreated),e))}},{key:"_attachDomEvents",value:function(){document.addEventListener("keydown",this._handlers.keydown)}},{key:"_detachDomEvents",value:function(){document.removeEventListener("keydown",this._handlers.keydown)}},{key:"_onKeyDown",value:function(e){var t=e.ctrlKey,n=e.keyCode,o=e.metaKey,i=t||o,r=this.allowObjectRemoval;i&&(n===f.keyCodes.C?this._graphics.resetTargetObjectForCopyPaste():n===f.keyCodes.V?(this._graphics.pasteObject(),this.clearRedoStack()):n===f.keyCodes.Z?this.undo().catch(function(){}):n===f.keyCodes.Y&&this.redo().catch(function(){}));var a=n===f.keyCodes.BACKSPACE||n===f.keyCodes.DEL,s=this._graphics.isReadyRemoveObject();!this.isColorPickerInputBoxEditing&&s&&a&&r&&(e.preventDefault(),this.removeActiveObject())}},{key:"removeActiveObject",value:function(){var e=this._graphics.getActiveObjectIdForRemove();this.removeObject(e)}},{key:"_onMouseDown",value:function(e,t){this.fire(f.eventNames.MOUSE_DOWN,e,t)}},{key:"_onMouseUp",value:function(e,t){this.fire(f.eventNames.MOUSE_UP,e,t)}},{key:"_onMouseMove",value:function(e,t){this.fire(f.eventNames.MOUSE_MOVE,e,t)}},{key:"_pushAddObjectCommand",value:function(e){var t=c.default.create(f.commandNames.ADD_OBJECT,this._graphics,e);this._invoker.pushUndoStack(t)}},{key:"_pushModifyObjectCommand",value:function(e){var t=this,n=e.type,o=(0,l.makeSelectionUndoData)(e,function(e){return(0,l.makeSelectionUndoDatum)(t._graphics.getObjectId(e),e,"activeSelection"===n)}),i=c.default.create(f.commandNames.CHANGE_SELECTION,this._graphics,o);i.execute(this._graphics,o),this._invoker.pushUndoStack(i)}},{key:"_onObjectActivated",value:function(e){this.fire(f.eventNames.OBJECT_ACTIVATED,e)}},{key:"_onObjectRemoved",value:function(e){this.fire(f.eventNames.OBJECT_REMOVED,e)}},{key:"_onObjectMoved",value:function(e){this.fire(f.eventNames.OBJECT_MOVED,e)}},{key:"_onObjectScaled",value:function(e){this.fire(f.eventNames.OBJECT_SCALED,e)}},{key:"_onObjectRotated",value:function(e){this.fire(f.eventNames.OBJECT_ROTATED,e)}},{key:"getDrawingMode",value:function(){return this._graphics.getDrawingMode()}},{key:"clearObjects",value:function(){return this.execute(f.commandNames.CLEAR_OBJECTS)}},{key:"deactivateAll",value:function(){this._graphics.deactivateAll(),this._graphics.renderAll()}},{key:"discardSelection",value:function(){this._graphics.discardSelection()}},{key:"changeSelectableAll",value:function(e){this._graphics.changeSelectableAll(e)}},{key:"_initHistory",value:function(){this.ui&&this.ui.initHistory()}},{key:"_clearHistory",value:function(){this.ui&&this.ui.clearHistory()}},{key:"execute",value:function(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var r=[this._graphics].concat(o);return(t=this._invoker).execute.apply(t,[e].concat(r))}},{key:"executeSilent",value:function(e){for(var t,n=arguments.length,o=Array(1<n?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];var r=[this._graphics].concat(o);return(t=this._invoker).executeSilent.apply(t,[e].concat(r))}},{key:"undo",value:function(e){for(var t=this,n=0<arguments.length&&void 0!==e?e:1,o=h.Promise.resolve(),i=0;i<n;i+=1)o=o.then(function(){return t._invoker.undo()});return o}},{key:"redo",value:function(e){for(var t=this,n=0<arguments.length&&void 0!==e?e:1,o=h.Promise.resolve(),i=0;i<n;i+=1)o=o.then(function(){return t._invoker.redo()});return o}},{key:"zoom",value:function(e){var t=e.x,n=e.y,o=e.zoomLevel;this._graphics.zoom({x:t,y:n},o)}},{key:"resetZoom",value:function(){this._graphics.resetZoom()}},{key:"loadImageFromFile",value:function(t,e){if(!t)return h.Promise.reject(f.rejectMessages.invalidParameters);var n=URL.createObjectURL(t);return e=e||t.name,this.loadImageFromURL(n,e).then(function(e){return URL.revokeObjectURL(t),e})}},{key:"loadImageFromURL",value:function(e,t){return t&&e?this.execute(f.commandNames.LOAD_IMAGE,t,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"addImageObject",value:function(e){return e?this.execute(f.commandNames.ADD_IMAGE_OBJECT,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"startDrawingMode",value:function(e,t){return this._graphics.startDrawingMode(e,t)}},{key:"stopDrawingMode",value:function(){this._graphics.stopDrawingMode()}},{key:"crop",value:function(e){var t=this._graphics.getCroppedImageData(e);return t?this.loadImageFromURL(t.url,t.imageName):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"getCropzoneRect",value:function(){return this._graphics.getCropzoneRect()}},{key:"setCropzoneRect",value:function(e){this._graphics.setCropzoneRect(e)}},{key:"_flip",value:function(e){return this.execute(f.commandNames.FLIP_IMAGE,e)}},{key:"flipX",value:function(){return this._flip("flipX")}},{key:"flipY",value:function(){return this._flip("flipY")}},{key:"resetFlip",value:function(){return this._flip("reset")}},{key:"_rotate",value:function(e,t,n){return n?this.executeSilent(f.commandNames.ROTATE_IMAGE,e,t):this.execute(f.commandNames.ROTATE_IMAGE,e,t)}},{key:"rotate",value:function(e,t){return this._rotate("rotate",e,t)}},{key:"setAngle",value:function(e,t){return this._rotate("setAngle",e,t)}},{key:"setBrush",value:function(e){this._graphics.setBrush(e)}},{key:"setDrawingShape",value:function(e,t){this._graphics.setDrawingShape(e,t)}},{key:"setDrawingIcon",value:function(e,t){this._graphics.setIconStyle(e,t)}},{key:"addShape",value:function(e,t){return t=t||{},this._setPositions(t),this.execute(f.commandNames.ADD_SHAPE,e,t)}},{key:"changeShape",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.CHANGE_SHAPE,e,t)}},{key:"addText",value:function(e,t){return e=e||"",t=t||{},this.execute(f.commandNames.ADD_TEXT,e,t)}},{key:"changeText",value:function(e,t){return t=t||"",this.execute(f.commandNames.CHANGE_TEXT,e,t)}},{key:"changeTextStyle",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.CHANGE_TEXT_STYLE,e,t)}},{key:"_changeActivateMode",value:function(e){"ICON"!==e&&this.getDrawingMode()!==e&&this.startDrawingMode(e)}},{key:"_onTextChanged",value:function(e){this.fire(f.eventNames.TEXT_CHANGED,e)}},{key:"_onIconCreateResize",value:function(e){this.fire(f.eventNames.ICON_CREATE_RESIZE,e)}},{key:"_onIconCreateEnd",value:function(e){this.fire(f.eventNames.ICON_CREATE_END,e)}},{key:"_onTextEditing",value:function(){this.fire(f.eventNames.TEXT_EDITING)}},{key:"_onAddText",value:function(e){this.fire(f.eventNames.ADD_TEXT,{originPosition:e.originPosition,clientPosition:e.clientPosition})}},{key:"_onAddObject",value:function(e){var t=this._graphics.getObject(e.id);this._invoker.fire(f.eventNames.EXECUTE_COMMAND,(0,h.getObjectType)(t.type)),this._pushAddObjectCommand(t)}},{key:"_onObjectAdded",value:function(e){this.fire(M,e),this.fire(R,e)}},{key:"_onObjectModified",value:function(e){e.type!==f.OBJ_TYPE.CROPZONE&&(this._invoker.fire(f.eventNames.EXECUTE_COMMAND,(0,h.getObjectType)(e.type)),this._pushModifyObjectCommand(e))}},{key:"_selectionCleared",value:function(){this.fire(I)}},{key:"_selectionCreated",value:function(e){"activeSelection"===e.type&&e.set({lockRotation:!0,lockScalingX:!0,lockScalingY:!0,hasControls:!1}),this.fire(N,e)}},{key:"registerIcons",value:function(e){this._graphics.registerPaths(e)}},{key:"changeCursor",value:function(e){this._graphics.changeCursor(e)}},{key:"addIcon",value:function(e,t){return t=t||{},this._setPositions(t),this.execute(f.commandNames.ADD_ICON,e,t)}},{key:"changeIconColor",value:function(e,t){return this.execute(f.commandNames.CHANGE_ICON_COLOR,e,t)}},{key:"removeObject",value:function(e){var t=this._graphics.getObject(e).type;return this.execute(f.commandNames.REMOVE_OBJECT,e,(0,h.getObjectType)(t))}},{key:"hasFilter",value:function(e){return this._graphics.hasFilter(e)}},{key:"removeFilter",value:function(e){return this.execute(f.commandNames.REMOVE_FILTER,e)}},{key:"applyFilter",value:function(e,t,n){return this[n?"executeSilent":"execute"](f.commandNames.APPLY_FILTER,e,t)}},{key:"toDataURL",value:function(e){return this._graphics.toDataURL(e)}},{key:"getImageName",value:function(){return this._graphics.getImageName()}},{key:"clearUndoStack",value:function(){this._invoker.clearUndoStack()}},{key:"clearRedoStack",value:function(){this._invoker.clearRedoStack()}},{key:"isEmptyUndoStack",value:function(){return this._invoker.isEmptyUndoStack()}},{key:"isEmptyRedoStack",value:function(){return this._invoker.isEmptyRedoStack()}},{key:"resizeCanvasDimension",value:function(e){return e?this.execute(f.commandNames.RESIZE_CANVAS_DIMENSION,e):h.Promise.reject(f.rejectMessages.invalidParameters)}},{key:"resizeCanvasDimensionQuietly",value:function(e){return this._graphics.setCssMaxDimension(e),this._graphics.adjustCanvasDimension(),h.Promise.resolve()}},{key:"destroy",value:function(){var n=this;this.stopDrawingMode(),this._detachDomEvents(),this._graphics.destroy(),this._graphics=null,this.ui&&(this._detachColorPickerInputBoxEvents(),this.ui.destroy()),m(this,function(e,t){n[t]=null},this)}},{key:"_setPositions",value:function(e){var t=this._graphics.getCenter();g(e.left)&&(e.left=t.left),g(e.top)&&(e.top=t.top)}},{key:"setObjectProperties",value:function(e,t){return this.execute(f.commandNames.SET_OBJECT_PROPERTIES,e,t)}},{key:"setObjectPropertiesQuietly",value:function(e,t){this._graphics.setObjectProperties(e,t)}},{key:"getObjectProperties",value:function(e,t){return this._graphics.getObject(e)?this._graphics.getObjectProperties(e,t):null}},{key:"getCanvasSize",value:function(){return this._graphics.getCanvasSize()}},{key:"getCanvasZoom",value:function(){return this._graphics.getCanvasZoom()}},{key:"getCurrentAngle",value:function(){return this._graphics.getCanvasImage().angle}},{key:"getObjectPosition",value:function(e,t,n){return this._graphics.getObjectPosition(e,t,n)}},{key:"setObjectPosition",value:function(e,t){return this.execute(f.commandNames.SET_OBJECT_POSITION,e,t)}},{key:"setCanvasZoom",value:function(e){this._graphics.setCanvasZoom(e)}},{key:"setAllowObjectRemoval",value:function(e){this.allowObjectRemoval=e}}]),F);function F(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),t=r.default.extend({includeUI:!1,usageStatistics:!1},t),this.mode=null,this.activeObjectId=null,this.allowObjectRemoval=!0,this._invoker=new a.default,this._graphics=new u.default(this.ui?this.ui.getEditorArea():e,{cssMaxWidth:t.cssMaxWidth,cssMaxHeight:t.cssMaxHeight}),this._handlers={keydown:this._onKeyDown.bind(this),mousedown:this._onMouseDown.bind(this),mouseup:this._onMouseUp.bind(this),mousemove:this._onMouseMove.bind(this),objectActivated:this._onObjectActivated.bind(this),objectRemoved:this._onObjectRemoved.bind(this),objectMoved:this._onObjectMoved.bind(this),objectScaled:this._onObjectScaled.bind(this),objectRotated:this._onObjectRotated.bind(this),objectAdded:this._onObjectAdded.bind(this),objectModified:this._onObjectModified.bind(this),createdPath:this._onCreatedPath,addText:this._onAddText.bind(this),addObject:this._onAddObject.bind(this),textEditing:this._onTextEditing.bind(this),textChanged:this._onTextChanged.bind(this),iconCreateResize:this._onIconCreateResize.bind(this),iconCreateEnd:this._onIconCreateEnd.bind(this),selectionCleared:this._selectionCleared.bind(this),selectionCreated:this._selectionCreated.bind(this)},this._attachInvokerEvents(),this._attachGraphicsEvents(),this._attachDomEvents(),this._setSelectionStyle(t.selectionStyle,{applyCropSelectionStyle:t.applyCropSelectionStyle,applyGroupSelectionStyle:t.applyGroupSelectionStyle}),t.usageStatistics&&(0,h.sendHostName)(),this.ui&&(this.ui.initCanvas(),this.setReAction(),this._attachColorPickerInputBoxEvents()),fabric.enableGLFiltering=!1}s.default.mixin(L),d.default.mixin(L),t.default=L},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=l(n(2)),a=l(n(3)),s=n(1),c=n(0),u=l(n(41));function l(e){return e&&e.__esModule?e:{default:e}}var h=r.default.isFunction,f=r.default.isString,d=(o(p,[{key:"_invokeExecution",value:function(t,e){var n=this,o=1<arguments.length&&void 0!==e&&e;this.lock();var i=t.args;return i=i||[],t.execute.apply(t,i).then(function(e){return n._isSilent||(n.pushUndoStack(t),n.fire(o?c.eventNames.AFTER_REDO:c.eventNames.EXECUTE_COMMAND,t)),n.unlock(),h(t.executeCallback)&&t.executeCallback(e),e}).catch(function(e){return n.unlock(),s.Promise.reject(e)})}},{key:"_invokeUndo",value:function(t){var n=this;this.lock();var e=t.args;return e=e||[],t.undo.apply(t,e).then(function(e){return n.pushRedoStack(t),n.fire(c.eventNames.AFTER_UNDO,t),n.unlock(),h(t.undoCallback)&&t.undoCallback(e),e}).catch(function(e){return n.unlock(),s.Promise.reject(e)})}},{key:"_fireRedoStackChanged",value:function(){this.fire(c.eventNames.REDO_STACK_CHANGED,this._redoStack.length)}},{key:"_fireUndoStackChanged",value:function(){this.fire(c.eventNames.UNDO_STACK_CHANGED,this._undoStack.length)}},{key:"lock",value:function(){this._isLocked=!0}},{key:"unlock",value:function(){this._isLocked=!1}},{key:"executeSilent",value:function(){var e=this;this._isSilent=!0;for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return this.execute.apply(this,n.concat([this._isSilent])).then(function(){e._isSilent=!1})}},{key:"execute",value:function(){var t=this;if(this._isLocked)return s.Promise.reject(c.rejectMessages.isLock);for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];var i=n[0];return f(i)&&(i=a.default.create.apply(a.default,n)),this._invokeExecution(i).then(function(e){return t.clearRedoStack(),e})}},{key:"undo",value:function(){var e=this._undoStack.pop(),t="";return e&&this._isLocked&&(this.pushUndoStack(e,!0),e=null),e?(this.isEmptyUndoStack()&&this._fireUndoStackChanged(),this._invokeUndo(e)):(t=c.rejectMessages.undo,this._isLocked&&(t=t+" Because "+c.rejectMessages.isLock),s.Promise.reject(t))}},{key:"redo",value:function(){var e=this._redoStack.pop(),t="";return e&&this._isLocked&&(this.pushRedoStack(e,!0),e=null),e?(this.isEmptyRedoStack()&&this._fireRedoStackChanged(),this._invokeExecution(e,!0)):(t=c.rejectMessages.redo,this._isLocked&&(t=t+" Because "+c.rejectMessages.isLock),s.Promise.reject(t))}},{key:"pushUndoStack",value:function(e,t){this._undoStack.push(e),t||this._fireUndoStackChanged()}},{key:"pushRedoStack",value:function(e,t){this._redoStack.push(e),t||this._fireRedoStackChanged()}},{key:"isEmptyRedoStack",value:function(){return 0===this._redoStack.length}},{key:"isEmptyUndoStack",value:function(){return 0===this._undoStack.length}},{key:"clearUndoStack",value:function(){this.isEmptyUndoStack()||(this._undoStack=[],this._fireUndoStackChanged())}},{key:"clearRedoStack",value:function(){this.isEmptyRedoStack()||(this._redoStack=[],this._fireRedoStackChanged())}}]),p);function p(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),this._undoStack=[],this._redoStack=[],this._isLocked=!1,this._isSilent=!1}u.default.mixin(d),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=s(n(2)),a=s(n(42));function s(e){return e&&e.__esModule?e:{default:e}}var c=a.default.create,u=a.default.types,l=(o(h,[{key:"execute",value:function(){throw new Error(c(u.UN_IMPLEMENTATION,"execute"))}},{key:"undo",value:function(){throw new Error(c(u.UN_IMPLEMENTATION,"undo"))}},{key:"setUndoData",value:function(e,t,n){return t&&(e=t),t=n?t||e:(r.default.extend(this.undoData,e),null)}},{key:"setExecuteCallback",value:function(e){return this.executeCallback=e,this}},{key:"setUndoCallback",value:function(e){return this.undoCallback=e,this}},{key:"isRedo",get:function(){return 0<Object.keys(this.undoData).length}}]),h);function h(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.name=e.name,this.args=t,this.execute=e.execute,this.undo=e.undo,this.executeCallback=e.executeCallback||null,this.undoCallback=e.undoCallback||null,this.undoData={}}t.default=l},function(e,t,n){var o=n(73);n(109),n(110),n(111),n(112),e.exports=o},function(e,t,n){n(74),n(75),n(93),n(97),n(65),n(108);var o=n(35);e.exports=o.Promise},function(e,t){},function(e,t,n){"use strict";var i=n(76).charAt,o=n(24),r=n(49),a="String Iterator",s=o.set,c=o.getterFor(a);r(String,"String",function(e){s(this,{type:a,string:String(e),index:0})},function(){var e,t=c(this),n=t.string,o=t.index;return o>=n.length?{value:void 0,done:!0}:(e=i(n,o),t.index+=e.length,{value:e,done:!1})})},function(e,t,n){function o(s){return function(e,t){var n,o,i=String(u(e)),r=c(t),a=i.length;return r<0||a<=r?s?"":void 0:(n=i.charCodeAt(r))<55296||56319<n||r+1===a||(o=i.charCodeAt(r+1))<56320||57343<o?s?i.charAt(r):n:s?i.slice(r,r+2):o-56320+(n-55296<<10)+65536}}var c=n(30),u=n(31);e.exports={codeAt:o(!1),charAt:o(!0)}},function(e,t,n){var o=n(5),i=n(43),r=o.WeakMap;e.exports="function"==typeof r&&/native code/.test(i(r))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o=n(5),i=n(8);e.exports=function(t,n){try{i(o,t,n)}catch(e){o[t]=n}return n}},function(e,t,n){"use strict";var o={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!o.call({1:2},1);t.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:o},function(e,t,n){var o=n(9),i=n(21),r="".split;e.exports=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==i(e)?r.call(e,""):Object(e)}:Object},function(e,t,n){"use strict";function i(){return this}var r=n(52).IteratorPrototype,a=n(54),s=n(25),c=n(38),u=n(18);e.exports=function(e,t,n){var o=t+" Iterator";return e.prototype=a(r,{next:s(1,n)}),c(e,o,!1,!0),u[o]=i,e}},function(e,t,n){var o=n(31);e.exports=function(e){return Object(o(e))}},function(e,t,n){var o=n(9);e.exports=!o(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},function(e,t,n){var o=n(53);e.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var o=n(12),a=n(19),s=n(10),c=n(87);e.exports=o?Object.defineProperties:function(e,t){s(e);for(var n,o=c(t),i=o.length,r=0;r<i;)a.f(e,n=o[r++],t[n]);return e}},function(e,t,n){var o=n(88),i=n(56);e.exports=Object.keys||function(e){return o(e,i)}},function(e,t,n){var a=n(11),s=n(26),c=n(89).indexOf,u=n(34);e.exports=function(e,t){var n,o=s(e),i=0,r=[];for(n in o)!a(u,n)&&a(o,n)&&r.push(n);for(;t.length>i;)a(o,n=t[i++])&&(~c(r,n)||r.push(n));return r}},function(e,t,n){function o(s){return function(e,t,n){var o,i=c(e),r=u(i.length),a=l(n,r);if(s&&t!=t){for(;a<r;)if((o=i[a++])!=o)return!0}else for(;a<r;a++)if((s||a in i)&&i[a]===t)return s||a||0;return!s&&-1}}var c=n(26),u=n(55),l=n(90);e.exports={includes:o(!0),indexOf:o(!1)}},function(e,t,n){var o=n(30),i=Math.max,r=Math.min;e.exports=function(e,t){var n=o(e);return n<0?i(n+t,0):r(n,t)}},function(e,t,n){"use strict";var o=n(39),i=n(40);e.exports=o?{}.toString:function(){return"[object "+i(this)+"]"}},function(e,t,n){var o=n(13);e.exports=function(e){if(!o(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){n(94);var o=n(96),i=n(5),r=n(40),a=n(8),s=n(18),c=n(6)("toStringTag");for(var u in o){var l=i[u],h=l&&l.prototype;h&&r(h)!==c&&a(h,c,u),s[u]=s.Array}},function(e,t,n){"use strict";var o=n(26),i=n(95),r=n(18),a=n(24),s=n(49),c="Array Iterator",u=a.set,l=a.getterFor(c);e.exports=s(Array,"Array",function(e,t){u(this,{type:c,target:o(e),index:0,kind:t})},function(){var e=l(this),t=e.target,n=e.kind,o=e.index++;return!t||o>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:o,done:!1}:"values"==n?{value:t[o],done:!1}:{value:[o,t[o]],done:!1}},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(e,t,n){"use strict";function v(e){var t;return!(!O(e)||"function"!=typeof(t=e.then))&&t}function r(h,f,d){if(!f.notified){f.notified=!0;var p=f.reactions;T(function(){for(var e=f.value,t=1==f.state,n=0;p.length>n;){var o,i,r,a=p[n++],s=t?a.ok:a.fail,c=a.resolve,u=a.reject,l=a.domain;try{s?(t||(2===f.rejection&&ie(h,f),f.rejection=1),!0===s?o=e:(l&&l.enter(),o=s(e),l&&(l.exit(),r=!0)),o===a.promise?u(G("Promise-chain cycle")):(i=v(o))?i.call(o,c,u):c(o)):u(e)}catch(e){l&&!r&&l.exit(),u(e)}}f.reactions=[],f.notified=!1,d&&!f.rejection&&ne(h,f)})}}function i(e,t,n){var o,i;Q?((o=Y.createEvent("Event")).promise=t,o.reason=n,o.initEvent(e,!1,!0),d.dispatchEvent(o)):o={promise:t,reason:n},(i=d["on"+e])?i(o):e===$&&A("Unhandled promise rejection",n)}function a(t,n,o,i){return function(e){t(n,o,e,i)}}function s(e,t,n,o){t.done||(t.done=!0,o&&(t=o),t.value=n,t.state=2,r(e,t,!0))}var o,c,u,l,h=n(14),f=n(20),d=n(5),p=n(17),g=n(59),m=n(27),_=n(98),y=n(38),b=n(99),O=n(13),E=n(16),C=n(100),k=n(21),M=n(43),w=n(28),x=n(104),P=n(60),j=n(61).set,T=n(105),S=n(64),A=n(106),D=n(22),I=n(29),N=n(24),R=n(51),L=n(6),F=n(107),H=L("species"),z="Promise",B=N.get,U=N.set,X=N.getterFor(z),Z=g,G=d.TypeError,Y=d.document,W=d.process,V=p("fetch"),J=D.f,q=J,K="process"==k(W),Q=!!(Y&&Y.createEvent&&d.dispatchEvent),$="unhandledrejection",ee=R(z,function(){if(!(M(Z)!==String(Z))){if(66===F)return!0;if(!K&&"function"!=typeof PromiseRejectionEvent)return!0}if(f&&!Z.prototype.finally)return!0;if(51<=F&&/native code/.test(Z))return!1;function e(e){e(function(){},function(){})}var t=Z.resolve(1);return(t.constructor={})[H]=e,!(t.then(function(){})instanceof e)}),te=ee||!x(function(e){Z.all(e).catch(function(){})}),ne=function(n,o){j.call(d,function(){var e,t=o.value;if(oe(o)&&(e=I(function(){K?W.emit("unhandledRejection",t,n):i($,n,t)}),o.rejection=K||oe(o)?2:1,e.error))throw e.value})},oe=function(e){return 1!==e.rejection&&!e.parent},ie=function(e,t){j.call(d,function(){K?W.emit("rejectionHandled",e):i("rejectionhandled",e,t.value)})},re=function(n,o,e,t){if(!o.done){o.done=!0,t&&(o=t);try{if(n===e)throw G("Promise can't be resolved itself");var i=v(e);i?T(function(){var t={done:!1};try{i.call(e,a(re,n,t,o),a(s,n,t,o))}catch(e){s(n,t,e,o)}}):(o.value=e,o.state=1,r(n,o,!1))}catch(e){s(n,{done:!1},e,o)}}};ee&&(Z=function(e){C(this,Z,z),E(e),o.call(this);var t=B(this);try{e(a(re,this,t),a(s,this,t))}catch(e){s(this,t,e)}},(o=function(){U(this,{type:z,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=_(Z.prototype,{then:function(e,t){var n=X(this),o=J(P(this,Z));return o.ok="function"!=typeof e||e,o.fail="function"==typeof t&&t,o.domain=K?W.domain:void 0,n.parent=!0,n.reactions.push(o),0!=n.state&&r(this,n,!1),o.promise},catch:function(e){return this.then(void 0,e)}}),c=function(){var e=new o,t=B(e);this.promise=e,this.resolve=a(re,e,t),this.reject=a(s,e,t)},D.f=J=function(e){return e===Z||e===u?new c:q(e)},f||"function"!=typeof g||(l=g.prototype.then,m(g.prototype,"then",function(e,t){var n=this;return new Z(function(e,t){l.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof V&&h({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return S(Z,V.apply(d,arguments))}}))),h({global:!0,wrap:!0,forced:ee},{Promise:Z}),y(Z,z,!1,!0),b(z),u=p(z),h({target:z,stat:!0,forced:ee},{reject:function(e){var t=J(this);return t.reject.call(void 0,e),t.promise}}),h({target:z,stat:!0,forced:f||ee},{resolve:function(e){return S(f&&this===u?Z:this,e)}}),h({target:z,stat:!0,forced:te},{all:function(e){var s=this,t=J(s),c=t.resolve,u=t.reject,n=I(function(){var o=E(s.resolve),i=[],r=0,a=1;w(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(s,e).then(function(e){n||(n=!0,i[t]=e,--a||c(i))},u)}),--a||c(i)});return n.error&&u(n.value),t.promise},race:function(e){var n=this,o=J(n),i=o.reject,t=I(function(){var t=E(n.resolve);w(e,function(e){t.call(n,e).then(o.resolve,i)})});return t.error&&i(t.value),o.promise}})},function(e,t,n){var i=n(27);e.exports=function(e,t,n){for(var o in t)n&&n.unsafe&&e[o]?e[o]=t[o]:i(e,o,t[o],n);return e}},function(e,t,n){"use strict";var o=n(17),i=n(19),r=n(6),a=n(12),s=r("species");e.exports=function(e){var t=o(e),n=i.f;a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){var o=n(6),i=n(18),r=o("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[r]===e)}},function(e,t,n){var o=n(40),i=n(18),r=n(6)("iterator");e.exports=function(e){if(null!=e)return e[r]||e["@@iterator"]||i[o(e)]}},function(e,t,n){var r=n(10);e.exports=function(t,e,n,o){try{return o?e(r(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&r(i.call(t)),e}}},function(e,t,n){var i=n(6)("iterator"),r=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){r=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o={};o[i]=function(){return{next:function(){return{done:n=!0}}}},e(o)}catch(e){}return n}},function(e,t,n){var o,i,r,a,s,c,u,l,h=n(5),f=n(50).f,d=n(21),p=n(61).set,v=n(62),g=h.MutationObserver||h.WebKitMutationObserver,m=h.process,_=h.Promise,y="process"==d(m),b=f(h,"queueMicrotask"),O=b&&b.value;O||(o=function(){var e,t;for(y&&(e=m.domain)&&e.exit();i;){t=i.fn,i=i.next;try{t()}catch(e){throw i?a():r=void 0,e}}r=void 0,e&&e.enter()},a=y?function(){m.nextTick(o)}:g&&!v?(s=!0,c=document.createTextNode(""),new g(o).observe(c,{characterData:!0}),function(){c.data=s=!s}):_&&_.resolve?(u=_.resolve(void 0),l=u.then,function(){l.call(u,o)}):function(){p.call(h,o)}),e.exports=O||function(e){var t={fn:e,next:void 0};r&&(r.next=t),i||(i=t,a()),r=t}},function(e,t,n){var o=n(5);e.exports=function(e,t){var n=o.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},function(e,t,n){var o,i,r=n(5),a=n(63),s=r.process,c=s&&s.versions,u=c&&c.v8;u?i=(o=u.split("."))[0]+o[1]:a&&(!(o=a.match(/Edge\/(\d+)/))||74<=o[1])&&(o=a.match(/Chrome\/(\d+)/))&&(i=o[1]),e.exports=i&&+i},function(e,t,n){"use strict";var o=n(14),i=n(20),r=n(59),a=n(9),s=n(17),c=n(60),u=n(64),l=n(27);o({target:"Promise",proto:!0,real:!0,forced:!!r&&a(function(){r.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=c(this,s("Promise")),e="function"==typeof t;return this.then(e?function(e){return u(n,t()).then(function(){return e})}:t,e?function(e){return u(n,t()).then(function(){throw e})}:t)}}),i||"function"!=typeof r||r.prototype.finally||l(r.prototype,"finally",s("Promise").prototype.finally)},function(e,t,n){"use strict";var o=n(14),i=n(12),r=n(37),a=n(58),s=n(54),c=n(19),u=n(25),l=n(28),h=n(8),f=n(24),d=f.set,p=f.getterFor("AggregateError"),v=function(e,t){var n=this;if(!(n instanceof v))return new v(e,t);a&&(n=a(new Error(t),r(n)));var o=[];return l(e,o.push,o),i?d(n,{errors:o,type:"AggregateError"}):n.errors=o,void 0!==t&&h(n,"message",String(t)),n};v.prototype=s(Error.prototype,{constructor:u(5,v),message:u(5,""),name:u(5,"AggregateError")}),i&&c.f(v.prototype,"errors",{get:function(){return p(this).errors},configurable:!0}),o({global:!0},{AggregateError:v})},function(e,t,n){n(65)},function(e,t,n){"use strict";var o=n(14),i=n(22),r=n(29);o({target:"Promise",stat:!0},{try:function(e){var t=i.f(this),n=r(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},function(e,t,n){"use strict";var o=n(14),h=n(16),f=n(17),i=n(22),r=n(29),d=n(28),p="No one promise resolved";o({target:"Promise",stat:!0},{any:function(e){var c=this,t=i.f(c),u=t.resolve,l=t.reject,n=r(function(){var o=h(c.resolve),i=[],r=0,a=1,s=!1;d(e,function(e){var t=r++,n=!1;i.push(void 0),a++,o.call(c,e).then(function(e){n||s||(s=!0,u(e))},function(e){n||s||(n=!0,i[t]=e,--a||l(new(f("AggregateError"))(i,p)))})}),--a||l(new(f("AggregateError"))(i,p))});return n.error&&l(n.value),t.promise}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(2),i=n(114),a=(o=i)&&o.__esModule?o:{default:o},c=n(1),s=n(0);t.default={getActions:function(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction(),history:this._historyAction()}},_mainAction:function(){function n(){"crop"===i.ui.submenu&&(i.stopDrawingMode(),i.ui.changeMenu("crop"))}function e(e){var t,n;return t=e,"rotate"===i.ui.submenu&&i.ui.rotate.setRangeBarAngle("setAngle",t),n=e,"filter"===i.ui.submenu&&i.ui.filter.setFilterState(n),e}function t(){i.ui.filter&&i.ui.filter.initFilterCheckBoxState()}var i=this;return(0,r.extend)({initLoadImage:function(t,e){return i.loadImageFromURL(t,e).then(function(e){n(),i.ui.initializeImgUrl=t,i.ui.resizeEditor({imageSize:e}),i.clearUndoStack(),i._invoker.fire(s.eventNames.EXECUTE_COMMAND,s.historyNames.LOAD_IMAGE)})},undo:function(){i.isEmptyUndoStack()||(n(),i.deactivateAll(),i.undo().then(e))},redo:function(){i.isEmptyRedoStack()||(n(),i.deactivateAll(),i.redo().then(e))},reset:function(){n(),i.loadImageFromURL(i.ui.initializeImgUrl,"resetImage").then(function(e){n(),t(),i.ui.resizeEditor({imageSize:e}),i.clearUndoStack(),i._initHistory()})},delete:function(){i.ui.changeHelpButtonEnabled("delete",!1),n(),i.removeActiveObject(),i.activeObjectId=null},deleteAll:function(){n(),i.clearObjects(),i.ui.changeHelpButtonEnabled("delete",!1),i.ui.changeHelpButtonEnabled("deleteAll",!1)},load:function(e){(0,c.isSupportFileApi)()||alert("This browser does not support file-api"),i.ui.initializeImgUrl=URL.createObjectURL(e),i.loadImageFromFile(e).then(function(e){n(),t(),i.clearUndoStack(),i.ui.activeMenuEvent(),i.ui.resizeEditor({imageSize:e}),i._clearHistory(),i._invoker.fire(s.eventNames.EXECUTE_COMMAND,s.historyNames.LOAD_IMAGE)}).catch(function(e){return Promise.reject(e)})},download:function(){var e=i.toDataURL(),t=i.getImageName(),n=void 0,o=void 0;(0,c.isSupportFileApi)()&&window.saveAs?(o=(n=(0,c.base64ToBlob)(e)).type.split("/")[1],t.split(".").pop()!==o&&(t+="."+o),saveAs(n,t)):window.open().document.body.innerHTML="<img src='"+e+"'>"},history:function(e){i.ui.toggleHistoryMenu(e)},zoomIn:function(){var e;i.ui.toggleZoomButtonStatus("zoomIn"),i.deactivateAll(),e=i._graphics.getZoomMode(),i.stopDrawingMode(),e!==s.zoomModes.ZOOM?(i.startDrawingMode(s.drawingModes.ZOOM),i._graphics.startZoomInMode()):i._graphics.endZoomInMode()},zoomOut:function(){i._graphics.zoomOut()},hand:function(){var e;i.ui.offZoomInButtonStatus(),i.ui.toggleZoomButtonStatus("hand"),i.deactivateAll(),e=i._graphics.getZoomMode(),i.stopDrawingMode(),e!==s.zoomModes.HAND?(i.startDrawingMode(s.drawingModes.ZOOM),i._graphics.startHandMode()):i._graphics.endHandMode()}},this._commonAction())},_iconAction:function(){var i=this;return(0,r.extend)({changeColor:function(e){i.activeObjectId&&i.changeIconColor(i.activeObjectId,e)},addIcon:function(e,t){i.startDrawingMode("ICON"),i.setDrawingIcon(e,t)},cancelAddIcon:function(){i.ui.icon.clearIconType(),i.changeSelectableAll(!0),i.changeCursor("default"),i.stopDrawingMode()},registerDefaultIcons:function(e,t){var n={};n[e]=t,i.registerIcons(n)},registerCustomIcon:function(e,o){(new a.default).imageToSVG(e,function(e){var t=e.match(/path[^>]*d="([^"]*)"/)[1],n={};n[o.name]=t,i.registerIcons(n),i.addIcon(o.name,{left:100,top:100})},a.default.tracerDefaultOption())}},this._commonAction())},_drawAction:function(){var n=this;return(0,r.extend)({setDrawMode:function(e,t){n.stopDrawingMode(),"free"===e?n.startDrawingMode("FREE_DRAWING",t):n.startDrawingMode("LINE_DRAWING",t)},setColor:function(e){n.setBrush({color:e})}},this._commonAction())},_maskAction:function(){var n=this;return(0,r.extend)({loadImageFromURL:function(e,t){return n.loadImageFromURL(n.toDataURL(),"FilterImage").then(function(){n.addImageObject(e).then(function(){URL.revokeObjectURL(t)}),n._invoker.fire(s.eventNames.EXECUTE_COMMAND,s.historyNames.LOAD_MASK_IMAGE)})},applyFilter:function(){n.applyFilter("mask",{maskObjId:n.activeObjectId})}},this._commonAction())},_textAction:function(){var n=this;return(0,r.extend)({changeTextStyle:function(e,t){n.activeObjectId&&n.changeTextStyle(n.activeObjectId,e,t)}},this._commonAction())},_rotateAction:function(){var n=this;return(0,r.extend)({rotate:function(e,t){n.rotate(e,t),n.ui.resizeEditor(),n.ui.rotate.setRangeBarAngle("rotate",e)},setAngle:function(e,t){n.setAngle(e,t),n.ui.resizeEditor(),n.ui.rotate.setRangeBarAngle("setAngle",e)}},this._commonAction())},_shapeAction:function(){var n=this;return(0,r.extend)({changeShape:function(e,t){n.activeObjectId&&n.changeShape(n.activeObjectId,e,t)},setDrawingShape:function(e){n.setDrawingShape(e)}},this._commonAction())},_cropAction:function(){var t=this;return(0,r.extend)({crop:function(){var e=t.getCropzoneRect();e&&!(0,c.isEmptyCropzone)(e)&&t.crop(e).then(function(){t.stopDrawingMode(),t.ui.resizeEditor(),t.ui.changeMenu("crop"),t._invoker.fire(s.eventNames.EXECUTE_COMMAND,s.historyNames.CROP)}).catch(function(e){return Promise.reject(e)})},cancel:function(){t.stopDrawingMode(),t.ui.changeMenu("crop")},preset:function(e){switch(e){case"preset-square":t.setCropzoneRect(1);break;case"preset-3-2":t.setCropzoneRect(1.5);break;case"preset-4-3":t.setCropzoneRect(4/3);break;case"preset-5-4":t.setCropzoneRect(5/4);break;case"preset-7-5":t.setCropzoneRect(1.4);break;case"preset-16-9":t.setCropzoneRect(16/9);break;default:t.setCropzoneRect(),t.ui.crop.changeApplyButtonStatus(!1)}}},this._commonAction())},_flipAction:function(){var t=this;return(0,r.extend)({flip:function(e){return t[e]()}},this._commonAction())},_filterAction:function(){var i=this;return(0,r.extend)({applyFilter:function(e,t,n,o){e?i.applyFilter(t,n,o):i.hasFilter(t)&&i.removeFilter(t)}},this._commonAction())},setReAction:function(){var s=this;this.on({undoStackChanged:function(e){e?(s.ui.changeHelpButtonEnabled("undo",!0),s.ui.changeHelpButtonEnabled("reset",!0)):(s.ui.changeHelpButtonEnabled("undo",!1),s.ui.changeHelpButtonEnabled("reset",!1)),s.ui.resizeEditor()},redoStackChanged:function(e){e?s.ui.changeHelpButtonEnabled("redo",!0):s.ui.changeHelpButtonEnabled("redo",!1),s.ui.resizeEditor()},objectActivated:function(e){s.activeObjectId=e.id,s.ui.changeHelpButtonEnabled("delete",!0),s.ui.changeHelpButtonEnabled("deleteAll",!0),"cropzone"===e.type?s.ui.crop.changeApplyButtonStatus(!0):-1<["rect","circle","triangle"].indexOf(e.type)?(s.stopDrawingMode(),"shape"!==s.ui.submenu&&s.ui.changeMenu("shape",!1,!1),s.ui.shape.setShapeStatus({strokeColor:e.stroke,strokeWidth:e.strokeWidth,fillColor:e.fill}),s.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height))):"path"===e.type||"line"===e.type?"draw"!==s.ui.submenu&&(s.ui.changeMenu("draw",!1,!1),s.ui.draw.changeStandbyMode()):-1<["i-text","text"].indexOf(e.type)?("text"!==s.ui.submenu&&s.ui.changeMenu("text",!1,!1),s.ui.text.setTextStyleStateOnAction(e)):"icon"===e.type&&(s.stopDrawingMode(),"icon"!==s.ui.submenu&&s.ui.changeMenu("icon",!1,!1),s.ui.icon.setIconPickerColor(e.fill))},addText:function(e){var t=s.ui.text,n=t.textColor,o=t.fontSize,i=t.fontStyle,r=t.fontWeight,a=t.underline;s.addText("Double Click",{position:e.originPosition,styles:{fill:n,fontSize:o,fontFamily:"Noto Sans",fontStyle:i,fontWeight:r,underline:a}}).then(function(){s.changeCursor("default")})},addObjectAfter:function(e){"icon"===e.type?s.ui.icon.changeStandbyMode():-1<["rect","circle","triangle"].indexOf(e.type)&&(s.ui.shape.setMaxStrokeValue(Math.min(e.width,e.height)),s.ui.shape.changeStandbyMode())},objectScaled:function(e){if(-1<["i-text","text"].indexOf(e.type))s.ui.text.fontSize=(0,c.toInteger)(e.fontSize);else if(0<=["rect","circle","triangle"].indexOf(e.type)){var t=e.width,n=e.height,o=s.ui.shape.getStrokeValue();t<o&&s.ui.shape.setStrokeValue(t),n<o&&s.ui.shape.setStrokeValue(n)}},selectionCleared:function(){s.activeObjectId=null,"text"===s.ui.submenu?s.changeCursor("text"):"draw"!==s.ui.submenu&&"crop"!==s.ui.submenu&&s.stopDrawingMode()}})},_historyAction:function(){var t=this;return{undo:function(e){return t.undo(e)},redo:function(e){return t.redo(e)}}},_commonAction:function(){var t=this,n=s.drawingModes.TEXT,o=s.drawingModes.CROPPER,i=s.drawingModes.SHAPE,r=s.drawingModes.ZOOM;return{modeChange:function(e){switch(e){case s.drawingMenuNames.TEXT:t._changeActivateMode(n);break;case s.drawingMenuNames.CROP:t.startDrawingMode(o);break;case s.drawingMenuNames.SHAPE:t._changeActivateMode(i),t.setDrawingShape(t.ui.shape.type,t.ui.shape.options);break;case s.drawingMenuNames.ZOOM:t.startDrawingMode(r)}},deactivateAll:this.deactivateAll.bind(this),changeSelectableAll:this.changeSelectableAll.bind(this),discardSelection:this.discardSelection.bind(this),stopDrawingMode:this.stopDrawingMode.bind(this)}},mixin:function(e){(0,r.extend)(e.prototype,this)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=(o(a,null,[{key:"tracerDefaultOption",value:function(){return{pathomit:100,ltres:.1,qtres:1,scale:1,strokewidth:5,viewbox:!1,linefilter:!0,desc:!1,rightangleenhance:!1,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]}}}]),o(a,[{key:"imageToSVG",value:function(e,t,n){var o=this;n=this.checkoptions(n),this.loadImage(e,function(e){t(o.imagedataToSVG(o.getImgdata(e),n))},n)}},{key:"imagedataToSVG",value:function(e,t){t=this.checkoptions(t);var n=this.imagedataToTracedata(e,t);return this.getsvgstring(n,t)}},{key:"imageToTracedata",value:function(e,t,n){var o=this;n=this.checkoptions(n),this.loadImage(e,function(e){t(o.imagedataToTracedata(o.getImgdata(e),n))},n)}},{key:"imagedataToTracedata",value:function(e,t){t=this.checkoptions(t);var n=this.colorquantization(e,t),o=void 0;if(0===t.layering){o={layers:[],palette:n.palette,width:n.array[0].length-2,height:n.array.length-2};for(var i=0;i<n.palette.length;i+=1){var r=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(n,i),t.pathomit),t),t.ltres,t.qtres);o.layers.push(r)}}else{var a=this.layering(n);t.layercontainerid&&this.drawLayers(a,this.specpalette,t.scale,t.layercontainerid);var s=this.batchpathscan(a,t.pathomit),c=this.batchinternodes(s,t);o={layers:this.batchtracelayers(c,t.ltres,t.qtres),palette:n.palette,width:e.width,height:e.height}}return o}},{key:"checkoptions",value:function(e){"string"==typeof(e=e||{})&&(e=e.toLowerCase(),e=this.optionpresets[e]?this.optionpresets[e]:{});for(var t=Object.keys(this.optionpresets.default),n=0;n<t.length;n+=1)e.hasOwnProperty(t[n])||(e[t[n]]=this.optionpresets.default[t[n]]);return e}},{key:"colorquantization",value:function(e,t){var n=[],o=0,i=void 0,r=void 0,a=void 0,s=[],c=e.width*e.height,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0;for(l=0;l<e.height+2;l+=1)for(n[l]=[],u=0;u<e.width+2;u+=1)n[l][u]=-1;for(d=t.pal?t.pal:0===t.colorsampling?this.generatepalette(t.numberofcolors):1===t.colorsampling?this.samplepalette(t.numberofcolors,e):this.samplepalette2(t.numberofcolors,e),0<t.blurradius&&(e=this.blur(e,t.blurradius,t.blurdelta)),f=0;f<t.colorquantcycles;f+=1){if(0<f)for(h=0;h<d.length;h+=1)0<s[h].n&&(d[h]={r:Math.floor(s[h].r/s[h].n),g:Math.floor(s[h].g/s[h].n),b:Math.floor(s[h].b/s[h].n),a:Math.floor(s[h].a/s[h].n)}),s[h].n/c<t.mincolorratio&&f<t.colorquantcycles-1&&(d[h]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(u=0;u<d.length;u+=1)s[u]={r:0,g:0,b:0,a:0,n:0};for(l=0;l<e.height;l+=1)for(u=0;u<e.width;u+=1){for(o=4*(l*e.width+u),r=1024,h=a=0;h<d.length;h+=1)(i=Math.abs(d[h].r-e.data[o])+Math.abs(d[h].g-e.data[o+1])+Math.abs(d[h].b-e.data[o+2])+Math.abs(d[h].a-e.data[o+3]))<r&&(r=i,a=h);s[a].r+=e.data[o],s[a].g+=e.data[o+1],s[a].b+=e.data[o+2],s[a].a+=e.data[o+3],s[a].n+=1,n[l+1][u+1]=a}}return{array:n,palette:d}}},{key:"samplepalette",value:function(e,t){for(var n=void 0,o=[],i=0;i<e;i+=1)n=4*Math.floor(Math.random()*t.data.length/4),o.push({r:t.data[n],g:t.data[n+1],b:t.data[n+2],a:t.data[n+3]});return o}},{key:"samplepalette2",value:function(e,t){for(var n=void 0,o=[],i=Math.ceil(Math.sqrt(e)),r=Math.ceil(e/i),a=t.width/(i+1),s=t.height/(r+1),c=0;c<r;c+=1)for(var u=0;u<i&&o.length!==e;u+=1)n=4*Math.floor((c+1)*s*t.width+(u+1)*a),o.push({r:t.data[n],g:t.data[n+1],b:t.data[n+2],a:t.data[n+3]});return o}},{key:"generatepalette",value:function(e){var t=[],n=void 0,o=void 0,i=void 0;if(e<8)for(var r=Math.floor(255/(e-1)),a=0;a<e;a+=1)t.push({r:a*r,g:a*r,b:a*r,a:255});else{var s=Math.floor(Math.pow(e,1/3)),c=Math.floor(255/(s-1)),u=e-s*s*s;for(n=0;n<s;n+=1)for(o=0;o<s;o+=1)for(i=0;i<s;i+=1)t.push({r:n*c,g:o*c,b:i*c,a:255});for(n=0;n<u;n+=1)t.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return t}},{key:"layering",value:function(e){var t=[],n=0,o=e.array.length,i=e.array[0].length,r=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f=void 0,d=void 0,p=void 0,v=void 0;for(v=0;v<e.palette.length;v+=1)for(t[v]=[],p=0;p<o;p+=1)for(t[v][p]=[],d=0;d<i;d+=1)t[v][p][d]=0;for(p=1;p<o-1;p+=1)for(d=1;d<i-1;d+=1)n=e.array[p][d],r=e.array[p-1][d-1]===n?1:0,a=e.array[p-1][d]===n?1:0,s=e.array[p-1][d+1]===n?1:0,c=e.array[p][d-1]===n?1:0,u=e.array[p][d+1]===n?1:0,l=e.array[p+1][d-1]===n?1:0,h=e.array[p+1][d]===n?1:0,f=e.array[p+1][d+1]===n?1:0,t[n][p+1][d+1]=1+2*u+4*f+8*h,c||(t[n][p+1][d]=2+4*h+8*l),a||(t[n][p][d+1]=0+2*s+4*u+8),r||(t[n][p][d]=0+2*a+4+8*c);return t}},{key:"layeringstep",value:function(e,t){var n=[],o=e.array.length,i=e.array[0].length,r=void 0,a=void 0;for(a=0;a<o;a+=1)for(n[a]=[],r=0;r<i;r+=1)n[a][r]=0;for(a=1;a<o;a+=1)for(r=1;r<i;r+=1)n[a][r]=(e.array[a-1][r-1]===t?1:0)+(e.array[a-1][r]===t?2:0)+(e.array[a][r-1]===t?8:0)+(e.array[a][r]===t?4:0);return n}},{key:"pathscan",value:function(e,t){for(var n=[],o=0,i=0,r=0,a=0,s=e[0].length,c=e.length,u=0,l=!0,h=!1,f=void 0,d=0;d<c;d+=1)for(var p=0;p<s;p+=1)if(4===e[d][p]||11===e[d][p])for(r=p,a=d,n[o]={},n[o].points=[],n[o].boundingbox=[r,a,r,a],n[o].holechildren=[],l=!1,i=0,h=11===e[d][p],u=1;!l;){if(n[o].points[i]={},n[o].points[i].x=r-1,n[o].points[i].y=a-1,n[o].points[i].t=e[a][r],r-1<n[o].boundingbox[0]&&(n[o].boundingbox[0]=r-1),r-1>n[o].boundingbox[2]&&(n[o].boundingbox[2]=r-1),a-1<n[o].boundingbox[1]&&(n[o].boundingbox[1]=a-1),a-1>n[o].boundingbox[3]&&(n[o].boundingbox[3]=a-1),f=this.pathscan_combined_lookup[e[a][r]][u],e[a][r]=f[0],u=f[1],r+=f[2],a+=f[3],r-1===n[o].points[0].x&&a-1===n[o].points[0].y)if(l=!0,n[o].points.length<t)n.pop();else{if(n[o].isholepath=!!h,h){for(var v=0,g=[-1,-1,s+1,c+1],m=0;m<o;m++)!n[m].isholepath&&this.boundingboxincludes(n[m].boundingbox,n[o].boundingbox)&&this.boundingboxincludes(g,n[m].boundingbox)&&(g=n[v=m].boundingbox);n[v].holechildren.push(o)}o+=1}i+=1}return n}},{key:"boundingboxincludes",value:function(e,t){return e[0]<t[0]&&e[1]<t[1]&&e[2]>t[2]&&e[3]>t[3]}},{key:"batchpathscan",value:function(e,t){var n=[];for(var o in e)e.hasOwnProperty(o)&&(n[o]=this.pathscan(e[o],t));return n}},{key:"internodes",value:function(e,t){var n=[],o=0,i=0,r=0,a=0,s=0,c=void 0,u=void 0;for(c=0;c<e.length;c+=1)for(n[c]={},n[c].points=[],n[c].boundingbox=e[c].boundingbox,n[c].holechildren=e[c].holechildren,n[c].isholepath=e[c].isholepath,o=e[c].points.length,u=0;u<o;u+=1)i=(u+1)%o,r=(u+2)%o,a=(u-1+o)%o,s=(u-2+o)%o,t.rightangleenhance&&this.testrightangle(e[c],s,a,u,i,r)&&(0<n[c].points.length&&(n[c].points[n[c].points.length-1].linesegment=this.getdirection(n[c].points[n[c].points.length-1].x,n[c].points[n[c].points.length-1].y,e[c].points[u].x,e[c].points[u].y)),n[c].points.push({x:e[c].points[u].x,y:e[c].points[u].y,linesegment:this.getdirection(e[c].points[u].x,e[c].points[u].y,(e[c].points[u].x+e[c].points[i].x)/2,(e[c].points[u].y+e[c].points[i].y)/2)})),n[c].points.push({x:(e[c].points[u].x+e[c].points[i].x)/2,y:(e[c].points[u].y+e[c].points[i].y)/2,linesegment:this.getdirection((e[c].points[u].x+e[c].points[i].x)/2,(e[c].points[u].y+e[c].points[i].y)/2,(e[c].points[i].x+e[c].points[r].x)/2,(e[c].points[i].y+e[c].points[r].y)/2)});return n}},{key:"testrightangle",value:function(e,t,n,o,i,r){return e.points[o].x===e.points[t].x&&e.points[o].x===e.points[n].x&&e.points[o].y===e.points[i].y&&e.points[o].y===e.points[r].y||e.points[o].y===e.points[t].y&&e.points[o].y===e.points[n].y&&e.points[o].x===e.points[i].x&&e.points[o].x===e.points[r].x}},{key:"getdirection",value:function(e,t,n,o){return e<n?t<o?1:o<t?7:0:n<e?t<o?3:o<t?5:4:t<o?2:o<t?6:8}},{key:"batchinternodes",value:function(e,t){var n=[];for(var o in e)e.hasOwnProperty(o)&&(n[o]=this.internodes(e[o],t));return n}},{key:"tracepath",value:function(e,t,n){var o=0,i=void 0,r=void 0,a=void 0,s={segments:[]};for(s.boundingbox=e.boundingbox,s.holechildren=e.holechildren,s.isholepath=e.isholepath;o<e.points.length;){for(i=e.points[o].linesegment,r=-1,a=o+1;(e.points[a].linesegment===i||e.points[a].linesegment===r||-1===r)&&a<e.points.length-1;)e.points[a].linesegment!==i&&-1===r&&(r=e.points[a].linesegment),a+=1;a===e.points.length-1&&(a=0),s.segments=s.segments.concat(this.fitseq(e,t,n,o,a)),o=0<a?a:e.points.length}return s}},{key:"fitseq",value:function(e,t,n,o,i){if(i>e.points.length||i<0)return[];var r=o,a=0,s=!0,c=void 0,u=void 0,l=void 0,h=i-o;h<0&&(h+=e.points.length);for(var f=(e.points[i].x-e.points[o].x)/h,d=(e.points[i].y-e.points[o].y)/h,p=(o+1)%e.points.length,v=void 0;p!=i;)(v=p-o)<0&&(v+=e.points.length),c=e.points[o].x+f*v,u=e.points[o].y+d*v,t<(l=(e.points[p].x-c)*(e.points[p].x-c)+(e.points[p].y-u)*(e.points[p].y-u))&&(s=!1),a<l&&(r=p,a=l),p=(p+1)%e.points.length;if(s)return[{type:"L",x1:e.points[o].x,y1:e.points[o].y,x2:e.points[i].x,y2:e.points[i].y}];var g=r;s=!0,a=0;var m=(g-o)/h,_=(1-m)*(1-m),y=2*(1-m)*m,b=m*m,O=(_*e.points[o].x+b*e.points[i].x-e.points[g].x)/-y,E=(_*e.points[o].y+b*e.points[i].y-e.points[g].y)/-y;for(p=o+1;p!=i;)y=2*(1-(m=(p-o)/h))*m,b=m*m,c=(_=(1-m)*(1-m))*e.points[o].x+y*O+b*e.points[i].x,u=_*e.points[o].y+y*E+b*e.points[i].y,n<(l=(e.points[p].x-c)*(e.points[p].x-c)+(e.points[p].y-u)*(e.points[p].y-u))&&(s=!1),a<l&&(r=p,a=l),p=(p+1)%e.points.length;if(s)return[{type:"Q",x1:e.points[o].x,y1:e.points[o].y,x2:O,y2:E,x3:e.points[i].x,y3:e.points[i].y}];var C=g;return this.fitseq(e,t,n,o,C).concat(this.fitseq(e,t,n,C,i))}},{key:"batchtracepaths",value:function(e,t,n){var o=[];for(var i in e)e.hasOwnProperty(i)&&o.push(this.tracepath(e[i],t,n));return o}},{key:"batchtracelayers",value:function(e,t,n){var o=[];for(var i in e)e.hasOwnProperty(i)&&(o[i]=this.batchtracepaths(e[i],t,n));return o}},{key:"roundtodec",value:function(e,t){return Number(e.toFixed(t))}},{key:"svgpathstring",value:function(e,t,n,o){var i=e.layers[t],r=i[n],a="",s=void 0;if(o.linefilter&&r.segments.length<3)return a;if(a="<path "+(o.desc?'desc="l '+t+" p "+n+'" ':"")+this.tosvgcolorstr(e.palette[t],o)+'d="',-1===o.roundcoords){for(a+="M "+r.segments[0].x1*o.scale+" "+r.segments[0].y1*o.scale+" ",s=0;s<r.segments.length;s++)a+=r.segments[s].type+" "+r.segments[s].x2*o.scale+" "+r.segments[s].y2*o.scale+" ",r.segments[s].hasOwnProperty("x3")&&(a+=r.segments[s].x3*o.scale+" "+r.segments[s].y3*o.scale+" ");a+="Z "}else{for(a+="M "+this.roundtodec(r.segments[0].x1*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[0].y1*o.scale,o.roundcoords)+" ",s=0;s<r.segments.length;s++)a+=r.segments[s].type+" "+this.roundtodec(r.segments[s].x2*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[s].y2*o.scale,o.roundcoords)+" ",r.segments[s].hasOwnProperty("x3")&&(a+=this.roundtodec(r.segments[s].x3*o.scale,o.roundcoords)+" "+this.roundtodec(r.segments[s].y3*o.scale,o.roundcoords)+" ");a+="Z "}for(var c=0;c<r.holechildren.length;c++){var u=i[r.holechildren[c]];if(-1===o.roundcoords)for(u.segments[u.segments.length-1].hasOwnProperty("x3")?a+="M "+u.segments[u.segments.length-1].x3*o.scale+" "+u.segments[u.segments.length-1].y3*o.scale+" ":a+="M "+u.segments[u.segments.length-1].x2*o.scale+" "+u.segments[u.segments.length-1].y2*o.scale+" ",s=u.segments.length-1;0<=s;s--)a+=u.segments[s].type+" ",u.segments[s].hasOwnProperty("x3")&&(a+=u.segments[s].x2*o.scale+" "+u.segments[s].y2*o.scale+" "),a+=u.segments[s].x1*o.scale+" "+u.segments[s].y1*o.scale+" ";else for(u.segments[u.segments.length-1].hasOwnProperty("x3")?a+="M "+this.roundtodec(u.segments[u.segments.length-1].x3*o.scale)+" "+this.roundtodec(u.segments[u.segments.length-1].y3*o.scale)+" ":a+="M "+this.roundtodec(u.segments[u.segments.length-1].x2*o.scale)+" "+this.roundtodec(u.segments[u.segments.length-1].y2*o.scale)+" ",s=u.segments.length-1;0<=s;s--)a+=u.segments[s].type+" ",u.segments[s].hasOwnProperty("x3")&&(a+=this.roundtodec(u.segments[s].x2*o.scale)+" "+this.roundtodec(u.segments[s].y2*o.scale)+" "),a+=this.roundtodec(u.segments[s].x1*o.scale)+" "+this.roundtodec(u.segments[s].y1*o.scale)+" ";a+="Z "}if(a+='" />',o.lcpr||o.qcpr){for(s=0;s<r.segments.length;s++)r.segments[s].hasOwnProperty("x3")&&o.qcpr&&(a+='<circle cx="'+r.segments[s].x2*o.scale+'" cy="'+r.segments[s].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<circle cx="'+r.segments[s].x3*o.scale+'" cy="'+r.segments[s].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<line x1="'+r.segments[s].x1*o.scale+'" y1="'+r.segments[s].y1*o.scale+'" x2="'+r.segments[s].x2*o.scale+'" y2="'+r.segments[s].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',a+='<line x1="'+r.segments[s].x2*o.scale+'" y1="'+r.segments[s].y2*o.scale+'" x2="'+r.segments[s].x3*o.scale+'" y2="'+r.segments[s].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!r.segments[s].hasOwnProperty("x3")&&o.lcpr&&(a+='<circle cx="'+r.segments[s].x2*o.scale+'" cy="'+r.segments[s].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />');for(c=0;c<r.holechildren.length;c++)for(u=i[r.holechildren[c]],s=0;s<u.segments.length;s++)u.segments[s].hasOwnProperty("x3")&&o.qcpr&&(a+='<circle cx="'+u.segments[s].x2*o.scale+'" cy="'+u.segments[s].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<circle cx="'+u.segments[s].x3*o.scale+'" cy="'+u.segments[s].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',a+='<line x1="'+u.segments[s].x1*o.scale+'" y1="'+u.segments[s].y1*o.scale+'" x2="'+u.segments[s].x2*o.scale+'" y2="'+u.segments[s].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',a+='<line x1="'+u.segments[s].x2*o.scale+'" y1="'+u.segments[s].y2*o.scale+'" x2="'+u.segments[s].x3*o.scale+'" y2="'+u.segments[s].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!u.segments[s].hasOwnProperty("x3")&&o.lcpr&&(a+='<circle cx="'+u.segments[s].x2*o.scale+'" cy="'+u.segments[s].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />')}return a}},{key:"getsvgstring",value:function(e,t){t=this.checkoptions(t);for(var n=e.width*t.scale,o=e.height*t.scale,i="<svg "+(t.viewbox?'viewBox="0 0 '+n+" "+o+'" ':'width="'+n+'" height="'+o+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+this.versionnumber+'" >',r=0;r<e.layers.length;r+=1)for(var a=0;a<e.layers[r].length;a+=1)e.layers[r][a].isholepath||(i+=this.svgpathstring(e,r,a,t));return i+="</svg>"}},{key:"compareNumbers",value:function(e,t){return e-t}},{key:"torgbastr",value:function(e){return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"}},{key:"tosvgcolorstr",value:function(e,t){return'fill="rgb('+e.r+","+e.g+","+e.b+')" stroke="rgb('+e.r+","+e.g+","+e.b+')" stroke-width="'+t.strokewidth+'" opacity="'+e.a/255+'" '}},{key:"appendSVGString",value:function(e,t){var n=void 0;t?(n=document.getElementById(t))||((n=document.createElement("div")).id=t,document.body.appendChild(n)):(n=document.createElement("div"),document.body.appendChild(n)),n.innerHTML+=e}},{key:"blur",value:function(e,t,n){var o=void 0,i=void 0,r=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,h=void 0,f={width:e.width,height:e.height,data:[]};if((t=Math.floor(t))<1)return e;5<t&&(t=5),1024<(n=Math.abs(n))&&(n=1024);var d=this.gks[t-1];for(i=0;i<e.height;i++)for(o=0;o<e.width;o++){for(h=l=u=c=s=0,r=-t;r<t+1;r++)0<o+r&&o+r<e.width&&(a=4*(i*e.width+o+r),s+=e.data[a]*d[r+t],c+=e.data[a+1]*d[r+t],u+=e.data[a+2]*d[r+t],l+=e.data[a+3]*d[r+t],h+=d[r+t]);a=4*(i*e.width+o),f.data[a]=Math.floor(s/h),f.data[a+1]=Math.floor(c/h),f.data[a+2]=Math.floor(u/h),f.data[a+3]=Math.floor(l/h)}var p=new Uint8ClampedArray(f.data);for(i=0;i<e.height;i++)for(o=0;o<e.width;o++){for(h=l=u=c=s=0,r=-t;r<t+1;r++)0<i+r&&i+r<e.height&&(s+=p[a=4*((i+r)*e.width+o)]*d[r+t],c+=p[a+1]*d[r+t],u+=p[a+2]*d[r+t],l+=p[a+3]*d[r+t],h+=d[r+t]);a=4*(i*e.width+o),f.data[a]=Math.floor(s/h),f.data[a+1]=Math.floor(c/h),f.data[a+2]=Math.floor(u/h),f.data[a+3]=Math.floor(l/h)}for(i=0;i<e.height;i++)for(o=0;o<e.width;o++)a=4*(i*e.width+o),n<Math.abs(f.data[a]-e.data[a])+Math.abs(f.data[a+1]-e.data[a+1])+Math.abs(f.data[a+2]-e.data[a+2])+Math.abs(f.data[a+3]-e.data[a+3])&&(f.data[a]=e.data[a],f.data[a+1]=e.data[a+1],f.data[a+2]=e.data[a+2],f.data[a+3]=e.data[a+3]);return f}},{key:"loadImage",value:function(e,t,n){var o=new Image;n&&n.corsenabled&&(o.crossOrigin="Anonymous"),o.src=e,o.onload=function(){var e=document.createElement("canvas");e.width=o.width,e.height=o.height,e.getContext("2d").drawImage(o,0,0),t(e)}}},{key:"getImgdata",value:function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)}},{key:"drawLayers",value:function(e,t,n,o){n=n||1;var i=void 0,r=void 0,a=void 0,s=void 0,c=void 0,u=void 0;for(c in o?(u=document.getElementById(o))||((u=document.createElement("div")).id=o,document.body.appendChild(u)):(u=document.createElement("div"),document.body.appendChild(u)),e)if(e.hasOwnProperty(c)){i=e[c][0].length,r=e[c].length;var l=document.createElement("canvas");l.width=i*n,l.height=r*n;var h=l.getContext("2d");for(s=0;s<r;s+=1)for(a=0;a<i;a+=1)h.fillStyle=this.torgbastr(t[e[c][s][a]%t.length]),h.fillRect(a*n,s*n,n,n);u.appendChild(l)}}}]),a);function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.versionnumber="1.2.4",this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}]}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=j(n(2)),r=j(n(4)),a=j(n(116)),s=j(n(117)),c=j(n(119)),u=j(n(120)),l=j(n(121)),h=j(n(122)),d=j(n(124)),p=j(n(125)),v=j(n(126)),g=j(n(131)),m=j(n(133)),_=j(n(134)),y=j(n(135)),b=j(n(136)),O=j(n(137)),E=j(n(138)),C=j(n(139)),k=j(n(140)),M=n(23),w=n(1),x=n(0),P=j(n(41));function j(e){return e&&e.__esModule?e:{default:e}}var T=f.default.extend,S=f.default.stamp,A=f.default.isArray,D=f.default.isString,I=f.default.forEachArray,N=f.default.forEachOwnProperties,R={cssOnly:!0},L={backstoreOnly:!0},F=(o(H,[{key:"destroy",value:function(){this._canvas.clear(),this._canvas.dispose(),this._detachZoomEvents()}},{key:"_attachZoomEvents",value:function(){this.getComponent(x.componentNames.ZOOM).attachKeyboardZoomEvents()}},{key:"_detachZoomEvents",value:function(){this.getComponent(x.componentNames.ZOOM).detachKeyboardZoomEvents()}},{key:"deactivateAll",value:function(){return this._canvas.discardActiveObject(),this}},{key:"renderAll",value:function(){return this._canvas.renderAll(),this}},{key:"add",value:function(e){var t,n=[];A(e)?n=e:n.push(e),(t=this._canvas).add.apply(t,n)}},{key:"contains",value:function(e){return this._canvas.contains(e)}},{key:"getObjects",value:function(){return this._canvas.getObjects().slice()}},{key:"getObject",value:function(e){return this._objects[e]}},{key:"remove",value:function(e){this._canvas.remove(e)}},{key:"removeAll",value:function(e){var t=this._canvas,n=t.getObjects().slice();return t.remove.apply(t,this._canvas.getObjects()),e&&t.clear(),n}},{key:"removeObjectById",value:function(e){var t=[],n=this._canvas,o=this.getObject(e);return o&&o.isType("group")&&!o.isEmpty()?(n.discardActiveObject(),o.forEachObject(function(e){t.push(e),n.remove(e)})):n.contains(o)&&(t.push(o),n.remove(o)),t}},{key:"getObjectId",value:function(e){var t=null;for(t in this._objects)if(this._objects.hasOwnProperty(t)&&e===this._objects[t])return t;return null}},{key:"getActiveObject",value:function(){return this._canvas._activeObject}},{key:"getActiveObjectIdForRemove",value:function(){var e=this.getActiveObject(),t=e.type,n=e.left,o=e.top;if("activeSelection"!==t)return this.getObjectId(e);var i=new r.default.Group([].concat(e.getObjects()),{left:n,top:o});return this._addFabricObject(i)}},{key:"isReadyRemoveObject",value:function(){var e=this.getActiveObject();return e&&!e.isEditing}},{key:"getActiveObjects",value:function(){var e=this._canvas._activeObject;return e&&"activeSelection"===e.type?e:null}},{key:"getActiveSelectionFromObjects",value:function(e){var t=this.getCanvas();return new r.default.ActiveSelection(e,{canvas:t})}},{key:"setActiveObject",value:function(e){this._canvas.setActiveObject(e)}},{key:"setCropSelectionStyle",value:function(e){this.cropSelectionStyle=e}},{key:"getComponent",value:function(e){return this._componentMap[e]}},{key:"getDrawingMode",value:function(){return this._drawingMode}},{key:"startDrawingMode",value:function(e,t){if(this._isSameDrawingMode(e))return!0;this.stopDrawingMode();var n=this._getDrawingModeInstance(e);return n&&n.start&&(n.start(this,t),this._drawingMode=e),!!n}},{key:"stopDrawingMode",value:function(){if(!this._isSameDrawingMode(x.drawingModes.NORMAL)){var e=this._getDrawingModeInstance(this.getDrawingMode());e&&e.end&&e.end(this),this._drawingMode=x.drawingModes.NORMAL}}},{key:"zoom",value:function(e,t){var n=e.x,o=e.y,i=this.getComponent(x.componentNames.ZOOM);i.zoom({x:n,y:o},t)}},{key:"getZoomMode",value:function(){return this.getComponent(x.componentNames.ZOOM).mode}},{key:"startZoomInMode",value:function(){this.getComponent(x.componentNames.ZOOM).startZoomInMode()}},{key:"endZoomInMode",value:function(){this.getComponent(x.componentNames.ZOOM).endZoomInMode()}},{key:"zoomOut",value:function(){this.getComponent(x.componentNames.ZOOM).zoomOut()}},{key:"startHandMode",value:function(){this.getComponent(x.componentNames.ZOOM).startHandMode()}},{key:"endHandMode",value:function(){this.getComponent(x.componentNames.ZOOM).endHandMode()}},{key:"resetZoom",value:function(){this.getComponent(x.componentNames.ZOOM).resetZoom()}},{key:"toDataURL",value:function(e){var t=this.getComponent(x.componentNames.CROPPER);t.changeVisibility(!1);var n=this._canvas&&this._canvas.toDataURL(e);return t.changeVisibility(!0),n}},{key:"setCanvasImage",value:function(e,t){t&&S(t),this.imageName=e,this.canvasImage=t}},{key:"setCssMaxDimension",value:function(e){this.cssMaxWidth=e.width||this.cssMaxWidth,this.cssMaxHeight=e.height||this.cssMaxHeight}},{key:"adjustCanvasDimension",value:function(){var e=this.canvasImage.scale(1).getBoundingRect(),t=e.width,n=e.height,o=this._calcMaxDimension(t,n);this.setCanvasCssDimension({width:"100%",height:"100%","max-width":o.width+"px","max-height":o.height+"px"}),this.setCanvasBackstoreDimension({width:o.width,height:o.height})}},{key:"adjustCanvasDimensionForRotate",value:function(){var e=this.canvasImage.scale(1).getBoundingRect(),t=e.width,n=e.height,o=n,i=t;this.setCanvasCssDimension({width:"100%",height:"100%","max-width":o+"px","max-height":i+"px"}),this.setCanvasBackstoreDimension({width:t,height:n}),this.canvasImage.viewportCenter()}},{key:"setCanvasCssDimension",value:function(e){this._canvas.setDimensions(e,R)}},{key:"setCanvasBackstoreDimension",value:function(e){this._canvas.setDimensions(e,L)}},{key:"setCanvasZoom",value:function(e){this._canvas.setZoom(e)}},{key:"setImageProperties",value:function(e,t){var n=this.canvasImage;n&&(n.set(e).setCoords(),t&&this._canvas.renderAll())}},{key:"getCanvasElement",value:function(){return this._canvas.getElement()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getCanvasImage",value:function(){return this.canvasImage}},{key:"getImageName",value:function(){return this.imageName}},{key:"addImageObject",value:function(e){var n=this,o=this._callbackAfterLoadingImageObject.bind(this);return new w.Promise(function(t){r.default.Image.fromURL(e,function(e){o(e),t(n.createObjectProperties(e))},{crossOrigin:"Anonymous"})})}},{key:"getCenter",value:function(){return this._canvas.getCenter()}},{key:"getCropzoneRect",value:function(){return this.getComponent(x.componentNames.CROPPER).getCropzoneRect()}},{key:"setCropzoneRect",value:function(e){this.getComponent(x.componentNames.CROPPER).setCropzoneRect(e)}},{key:"getCroppedImageData",value:function(e){return this.getComponent(x.componentNames.CROPPER).getCroppedImageData(e)}},{key:"setBrush",value:function(e){var t=this._drawingMode,n=x.componentNames.FREE_DRAWING;t===x.drawingModes.LINE_DRAWING&&(n=x.componentNames.LINE),this.getComponent(n).setBrush(e)}},{key:"setDrawingShape",value:function(e,t){this.getComponent(x.componentNames.SHAPE).setStates(e,t)}},{key:"setIconStyle",value:function(e,t){this.getComponent(x.componentNames.ICON).setStates(e,t)}},{key:"registerPaths",value:function(e){this.getComponent(x.componentNames.ICON).registerPaths(e)}},{key:"changeCursor",value:function(e){var t=this.getCanvas();t.defaultCursor=e,t.renderAll()}},{key:"hasFilter",value:function(e){return this.getComponent(x.componentNames.FILTER).hasFilter(e)}},{key:"setSelectionStyle",value:function(e){T(x.fObjectOptions.SELECTION_STYLE,e)}},{key:"setObjectProperties",value:function(e,t){var n=this.getObject(e),o=T({},t);return n.set(o),n.setCoords(),this.getCanvas().renderAll(),o}},{key:"getObjectProperties",value:function(e,t){var n=this.getObject(e),o={};return D(t)?o[t]=n[t]:A(t)?I(t,function(e){o[e]=n[e]}):N(t,function(e,t){o[t]=n[t]}),o}},{key:"getObjectPosition",value:function(e,t,n){var o=this.getObject(e);return o?o.getPointByOrigin(t,n):null}},{key:"setObjectPosition",value:function(e,t){var n=this.getObject(e),o=t.x,i=t.y,r=t.originX,a=t.originY;if(!n)return!1;var s=n.getPointByOrigin(r,a),c=n.getPointByOrigin("center","center"),u=c.x-s.x,l=c.y-s.y;return n.set({left:o+u,top:i+l}),n.setCoords(),!0}},{key:"getCanvasSize",value:function(){var e=this.getCanvasImage();return{width:e?e.width:0,height:e?e.height:0}}},{key:"getCanvasZoom",value:function(){return this._canvas.getZoom()}},{key:"createStaticCanvas",value:function(){var e=new r.default.StaticCanvas;return e.set({enableRetinaScaling:!1}),e}},{key:"_getDrawingModeInstance",value:function(e){return this._drawingModeMap[e]}},{key:"_setObjectCachingToFalse",value:function(){r.default.Object.prototype.objectCaching=!1}},{key:"_setCanvasElement",value:function(e){var t=void 0,n=void 0;"CANVAS"!==(t=e.nodeType?e:document.querySelector(e)).nodeName.toUpperCase()&&(n=document.createElement("canvas"),t.appendChild(n)),this._canvas=new r.default.Canvas(n,{containerClass:"tui-image-editor-canvas-container",enableRetinaScaling:!1,targetFindTolerance:x.defaultPixelTargetTolerance})}},{key:"_createDrawingModeInstances",value:function(){this._register(this._drawingModeMap,new _.default),this._register(this._drawingModeMap,new y.default),this._register(this._drawingModeMap,new b.default),this._register(this._drawingModeMap,new O.default),this._register(this._drawingModeMap,new E.default),this._register(this._drawingModeMap,new C.default),this._register(this._drawingModeMap,new k.default)}},{key:"_createComponents",value:function(){this._register(this._componentMap,new a.default(this)),this._register(this._componentMap,new s.default(this)),this._register(this._componentMap,new c.default(this)),this._register(this._componentMap,new u.default(this)),this._register(this._componentMap,new l.default(this)),this._register(this._componentMap,new h.default(this)),this._register(this._componentMap,new d.default(this)),this._register(this._componentMap,new p.default(this)),this._register(this._componentMap,new v.default(this)),this._register(this._componentMap,new g.default(this)),this._register(this._componentMap,new m.default(this))}},{key:"_register",value:function(e,t){e[t.getName()]=t}},{key:"_isSameDrawingMode",value:function(e){return this.getDrawingMode()===e}},{key:"_calcMaxDimension",value:function(e,t){var n=this.cssMaxWidth/e,o=this.cssMaxHeight/t,i=Math.min(e,this.cssMaxWidth),r=Math.min(t,this.cssMaxHeight);return n<1&&n<o?(i=e*n,r=t*n):o<1&&o<n&&(i=e*o,r=t*o),{width:Math.floor(i),height:Math.floor(r)}}},{key:"_callbackAfterLoadingImageObject",value:function(e){var t=this.getCanvasImage().getCenterPoint();e.set(x.fObjectOptions.SELECTION_STYLE),e.set({left:t.x,top:t.y,crossOrigin:"Anonymous"}),this.getCanvas().add(e).setActiveObject(e)}},{key:"_attachCanvasEvents",value:function(){var e=this._canvas,t=this._handler;e.on({"mouse:down":t.onMouseDown,"mouse:up":t.onMouseUp,"mouse:move":t.onMouseMove,"object:added":t.onObjectAdded,"object:removed":t.onObjectRemoved,"object:moving":t.onObjectMoved,"object:scaling":t.onObjectScaled,"object:modified":t.onObjectModified,"object:rotating":t.onObjectRotated,"path:created":t.onPathCreated,"selection:cleared":t.onSelectionCleared,"selection:created":t.onSelectionCreated,"selection:updated":t.onSelectionChanged})}},{key:"_onMouseDown",value:function(e){var t=this,n=e.e,o=e.target,i=this._canvas.getPointer(n);if(o){var r=o.type,a=(0,M.makeSelectionUndoData)(o,function(e){return(0,M.makeSelectionUndoDatum)(t.getObjectId(e),e,"activeSelection"===r)});(0,M.setCachedUndoDataForDimension)(a)}this.fire(x.eventNames.MOUSE_DOWN,n,i)}},{key:"_onMouseUp",value:function(e){var t=this._canvas.getPointer(e.e);this.fire(x.eventNames.MOUSE_UP,e.e,t)}},{key:"_onMouseMove",value:function(e){var t=this._canvas.getPointer(e.e);this.fire(x.eventNames.MOUSE_MOVE,e.e,t)}},{key:"_onObjectAdded",value:function(e){var t=e.target;t.isType("cropzone")||this._addFabricObject(t)}},{key:"_onObjectRemoved",value:function(e){var t=e.target,n=this.createObjectProperties(t);this._removeFabricObject(S(t)),this.fire(x.eventNames.OBJECT_REMOVED,n)}},{key:"_onObjectMoved",value:function(e){var t=this;this._lazyFire(x.eventNames.OBJECT_MOVED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_onObjectScaled",value:function(e){var t=this;this._lazyFire(x.eventNames.OBJECT_SCALED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_onObjectModified",value:function(e){var t=e.target;"activeSelection"===t.type&&t.getObjects().forEach(function(e){return e.fire("modifiedInGroup",t)}),this.fire(x.eventNames.OBJECT_MODIFIED,t,this.getObjectId(t))}},{key:"_onObjectRotated",value:function(e){var t=this;this._lazyFire(x.eventNames.OBJECT_ROTATED,function(e){return t.createObjectProperties(e)},e.target)}},{key:"_lazyFire",value:function(t,n,e){var o=this,i=e&&e.canvasEventDelegation?e.canvasEventDelegation(t):"none";"unregistered"===i&&e.canvasEventRegister(t,function(e){o.fire(t,n(e))}),"none"===i&&this.fire(t,n(e))}},{key:"_onSelectionChanged",value:function(e){var t=e.target;if(this._canvas.bringToFront(t),"activeSelection"!==t.type){var n=this.createObjectProperties(t);this.fire(x.eventNames.OBJECT_ACTIVATED,n)}else if(0<e.selected.length&&2===t.size()){var o=this.createObjectProperties(t);this.fire(x.eventNames.OBJECT_ACTIVATED,o),this.fire(x.eventNames.SELECTION_CREATED,e.target)}}},{key:"_onPathCreated",value:function(e){var t=e.path.getCenterPoint(),n=t.x,o=t.y;e.path.set(T({left:n,top:o,angle:0},x.fObjectOptions.SELECTION_STYLE));var i=this.createObjectProperties(e.path);this.fire(x.eventNames.ADD_OBJECT,i)}},{key:"_onSelectionCleared",value:function(){this.fire(x.eventNames.SELECTION_CLEARED)}},{key:"_onSelectionCreated",value:function(e){var t=e.target,n=this.createObjectProperties(t);this.fire(x.eventNames.OBJECT_ACTIVATED,n),this.fire(x.eventNames.SELECTION_CREATED,e.target)}},{key:"discardSelection",value:function(){this._canvas.discardActiveObject(),this._canvas.renderAll()}},{key:"changeSelectableAll",value:function(t){this._canvas.forEachObject(function(e){e.selectable=t,e.evented=t,e.hoverCursor=t?"move":"crosshair"})}},{key:"createObjectProperties",value:function(e){var t={id:S(e),type:e.type};if(T(t,(0,w.getProperties)(e,["left","top","width","height","fill","stroke","strokeWidth","opacity","angle"])),(0,w.includes)(["i-text","text"],e.type))T(t,this._createTextProperties(e,t));else if((0,w.includes)(["rect","triangle","circle"],e.type)){var n=this.getComponent(x.componentNames.SHAPE);T(t,{fill:n.makeFillPropertyForUserEvent(e)})}return t}},{key:"_createTextProperties",value:function(e){var t={};return T(t,(0,w.getProperties)(e,["text","fontFamily","fontSize","fontStyle","fontWeight","textAlign","textDecoration","fontWeight"])),t}},{key:"_addFabricObject",value:function(e){var t=S(e);return this._objects[t]=e,t}},{key:"_removeFabricObject",value:function(e){delete this._objects[e]}},{key:"resetTargetObjectForCopyPaste",value:function(){var e=this.getActiveObject();e&&(this.targetObjectForCopyPaste=e)}},{key:"pasteObject",value:function(){var t=this;if(!this.targetObjectForCopyPaste)return w.Promise.resolve([]);var e=this.targetObjectForCopyPaste,n="activeSelection"===e.type?e.getObjects():[e],o=null;return this.discardSelection(),this._cloneObject(n).then(function(e){o=1<e.length?t.getActiveSelectionFromObjects(e):e[0],t.targetObjectForCopyPaste=o,t.setActiveObject(o)})}},{key:"_cloneObject",value:function(e){var t=this,n=f.default.map(e,function(e){return t._cloneObjectItem(e)});return w.Promise.all(n)}},{key:"_cloneObjectItem",value:function(e){var n=this;return this._copyFabricObjectForPaste(e).then(function(e){var t=n.createObjectProperties(e);return n.add(e),n.fire(x.eventNames.ADD_OBJECT,t),e})}},{key:"_copyFabricObjectForPaste",value:function(e){function l(e,t){return t?e-10:e+10}var h=this;return this._copyFabricObject(e).then(function(e){var t=e.left,n=e.top,o=e.width,i=e.height,r=h.getCanvasSize(),a=r.width,s=r.height,c=t+o/2,u=n+i/2;return e.set(f.default.extend({left:l(t,a<c+10),top:l(n,s<u+10)},x.fObjectOptions.SELECTION_STYLE)),e})}},{key:"_copyFabricObject",value:function(o){var i=this;return new w.Promise(function(n){o.clone(function(e){var t=i.getComponent(x.componentNames.SHAPE);(0,w.isShape)(e)&&t.processForCopiedObject(e,o),n(e)})})}}]),H);function H(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.cssMaxWidth,o=t.cssMaxHeight;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,H),this.canvasImage=null,this.cssMaxWidth=n||1e3,this.cssMaxHeight=o||800,this.cropSelectionStyle={},this.targetObjectForCopyPaste=null,this.imageName="",this._objects={},this._canvas=null,this._drawingMode=x.drawingModes.NORMAL,this._drawingModeMap={},this._componentMap={},this._handler={onMouseDown:this._onMouseDown.bind(this),onMouseUp:this._onMouseUp.bind(this),onMouseMove:this._onMouseMove.bind(this),onObjectAdded:this._onObjectAdded.bind(this),onObjectRemoved:this._onObjectRemoved.bind(this),onObjectMoved:this._onObjectMoved.bind(this),onObjectScaled:this._onObjectScaled.bind(this),onObjectModified:this._onObjectModified.bind(this),onObjectRotated:this._onObjectRotated.bind(this),onSelectionChanged:this._onSelectionChanged.bind(this),onPathCreated:this._onPathCreated.bind(this),onSelectionCleared:this._onSelectionCleared.bind(this),onSelectionCreated:this._onSelectionCreated.bind(this)},this._setObjectCachingToFalse(),this._setCanvasElement(e),this._createDrawingModeInstances(),this._createComponents(),this._attachCanvasEvents(),this._attachZoomEvents()}P.default.mixin(F),t.default=F},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(7),s=(r=a)&&r.__esModule?r:{default:r},c=n(1),u=n(0);var l={padding:0,crossOrigin:"Anonymous"},h=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,s.default),o(f,[{key:"load",value:function(t,e){var n=this,o=void 0;if(t||e)o=this._setBackgroundImage(e).then(function(e){return n.setCanvasImage(t,e),n.adjustCanvasDimension(),e});else{var i=this.getCanvas();i.backgroundImage=null,i.renderAll(),o=new c.Promise(function(e){n.setCanvasImage("",null),e()})}return o}},{key:"_setBackgroundImage",value:function(e){var i=this;return e?new c.Promise(function(t,n){var o=i.getCanvas();o.setBackgroundImage(e,function(){var e=o.backgroundImage;e&&e.getElement()?t(e):n(u.rejectMessages.loadingImageFailed)},l)}):c.Promise.reject(u.rejectMessages.loadImage)}}]),f);function f(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,u.componentNames.IMAGE_LOADER,e))}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=u(n(2)),r=u(n(4)),a=u(n(7)),s=u(n(118)),c=n(0),d=n(1);function u(e){return e&&e.__esModule?e:{default:e}}var l={presetRatio:null,top:-10,left:-10,height:1,width:1},h=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,a.default),o(p,[{key:"start",value:function(){if(!this._cropzone){var e=this.getCanvas();e.forEachObject(function(e){e.evented=!1}),this._cropzone=new s.default(e,f.default.extend({left:0,top:0,width:.5,height:.5,strokeWidth:0,cornerSize:10,cornerColor:"black",fill:"transparent"},c.CROPZONE_DEFAULT_OPTIONS,this.graphics.cropSelectionStyle)),e.discardActiveObject(),e.add(this._cropzone),e.on("mouse:down",this._listeners.mousedown),e.selection=!1,e.defaultCursor="crosshair",r.default.util.addListener(document,"keydown",this._listeners.keydown),r.default.util.addListener(document,"keyup",this._listeners.keyup)}}},{key:"end",value:function(){var e=this.getCanvas(),t=this._cropzone;t&&(e.remove(t),e.selection=!0,e.defaultCursor="default",e.off("mouse:down",this._listeners.mousedown),e.forEachObject(function(e){e.evented=!0}),this._cropzone=null,r.default.util.removeListener(document,"keydown",this._listeners.keydown),r.default.util.removeListener(document,"keyup",this._listeners.keyup))}},{key:"changeVisibility",value:function(e){this._cropzone&&this._cropzone.set({visible:e})}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas();if(!e.target){t.selection=!1;var n=t.getPointer(e.e);this._startX=n.x,this._startY=n.y,t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),o=n.x,i=n.y,r=this._cropzone;10<Math.abs(o-this._startX)+Math.abs(i-this._startY)&&(t.remove(r),r.set(this._calcRectDimensionFromPoint(o,i)),t.add(r),t.setActiveObject(r))}},{key:"_calcRectDimensionFromPoint",value:function(e,t){var n=this.getCanvas(),o=n.getZoom(),i=n.getWidth()/o,r=n.getHeight()/o,a=this._startX,s=this._startY,c=(0,d.clamp)(e,0,a),u=(0,d.clamp)(t,0,s),l=(0,d.clamp)(e,a,i)-c,h=(0,d.clamp)(t,s,r)-u;return this._withShiftKey&&(h<l?h=l:l<h&&(l=h),e<=a&&(c=a-l),t<=s&&(u=s-h)),{left:c,top:u,width:l,height:h}}},{key:"_onFabricMouseUp",value:function(){var e=this._cropzone,t=this._listeners,n=this.getCanvas();n.setActiveObject(e),n.requestRenderAll(),n.off({"mouse:move":t.mousemove,"mouse:up":t.mouseup})}},{key:"getCroppedImageData",value:function(e){var t=this.getCanvas(),n=t.contains(this._cropzone);if(!e)return null;n&&t.remove(this._cropzone);var o={imageName:this.getImageName(),url:t.toDataURL(e)};return n&&t.add(this._cropzone),o}},{key:"getCropzoneRect",value:function(){var e=this._cropzone;return e.isValid()?{left:e.left,top:e.top,width:e.width,height:e.height}:null}},{key:"setCropzoneRect",value:function(e){var t=this.getCanvas(),n=this._cropzone;t.discardActiveObject(),t.selection=!1,t.remove(n),n.set(e?this._getPresetPropertiesForCropSize(e):l),t.add(n),t.selection=!0,e&&t.setActiveObject(n)}},{key:"_getPresetPropertiesForCropSize",value:function(e){function t(e,t){return t<e?t/e:1}var n=this.getCanvas(),o=n.getWidth(),i=n.getHeight(),r=i<=o?o:i,a=r*e,s=r,c=t(a,o),u=f.default.map([a,s],function(e){return e*c});a=u[0];var l=t(s=u[1],i),h=f.default.map([a,s],function(e){return(0,d.fixFloatingPoint)(e*l)});return a=h[0],{presetRatio:e,top:(i-(s=h[1]))/2,left:(o-a)/2,width:a,height:s}}},{key:"_onKeyDown",value:function(e){e.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!0)}},{key:"_onKeyUp",value:function(e){e.keyCode===c.keyCodes.SHIFT&&(this._withShiftKey=!1)}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,c.componentNames.CROPPER,e));return t._cropzone=null,t._startX=null,t._startY=null,t._withShiftKey=!1,t._listeners={keydown:t._onKeyDown.bind(t),keyup:t._onKeyUp.bind(t),mousedown:t._onFabricMouseDown.bind(t),mousemove:t._onFabricMouseMove.bind(t),mouseup:t._onFabricMouseUp.bind(t)},t}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(n(2)),o=i(n(4)),h=n(1),s=n(0);function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){}var c=["tl","tr","mt","ml","mr","mb","bl","br"];function p(e,t){return t<e?"width":"height"}var u=o.default.util.createClass(o.default.Rect,{initialize:function(e,t,n){(t=l.default.extend(t,n)).type="cropzone",this.callSuper("initialize",t),this._addEventHandler(),this.canvas=e,this.options=t,this.setControlVisible("mtr",!1)},canvasEventDelegation:function(e){var t="unregistered";return this.canvasEventTrigger[e]!==a?t="registered":[s.eventNames.OBJECT_MOVED,s.eventNames.OBJECT_SCALED].indexOf(e)<0&&(t="none"),t},canvasEventRegister:function(e,t){this.canvasEventTrigger[e]=t},_addEventHandler:function(){var e;this.canvasEventTrigger=(r(e={},s.eventNames.OBJECT_MOVED,a),r(e,s.eventNames.OBJECT_SCALED,a),e),this.on({moving:this._onMoving.bind(this),scaling:this._onScaling.bind(this)}),o.default.util.addListener(document,"keydown",this._onKeyDown.bind(this)),o.default.util.addListener(document,"keyup",this._onKeyUp.bind(this))},_renderCropzone:function(e){var t=this.flipX?-1:1,n=this.flipY?-1:1,o=t/this.scaleX,i=n/this.scaleY;e.scale(o,i),this._fillOuterRect(e,"rgba(0, 0, 0, 0.5)"),this.options.lineWidth?this._strokeBorder(e,"rgb(255, 255, 255)",{lineWidth:this.options.lineWidth}):(this._strokeBorder(e,"rgb(0, 0, 0)",{lineDashWidth:7}),this._strokeBorder(e,"rgb(255, 255, 255)",{lineDashWidth:7,lineDashOffset:7})),e.scale(1/o,1/i)},_render:function(e){this.callSuper("_render",e),this._renderCropzone(e)},_fillOuterRect:function(e,t){var n=this._getCoordinates(),o=n.x,i=n.y;e.save(),e.fillStyle=t,e.beginPath(),e.moveTo(o[0]-1,i[0]-1),e.lineTo(o[3]+1,i[0]-1),e.lineTo(o[3]+1,i[3]+1),e.lineTo(o[0]-1,i[3]+1),e.lineTo(o[0]-1,i[0]-1),e.closePath(),e.moveTo(o[1],i[1]),e.lineTo(o[1],i[2]),e.lineTo(o[2],i[2]),e.lineTo(o[2],i[1]),e.lineTo(o[1],i[1]),e.closePath(),e.fill(),e.restore()},_fillInnerRect:function(e){var t=this._getCoordinates(),n=t.x,o=t.y,i=this._caculateInnerPosition(n,(n[2]-n[1])/3),r=this._caculateInnerPosition(o,(o[2]-o[1])/3);e.save(),e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=this.options.lineWidth,e.beginPath(),e.moveTo(i[0],r[1]),e.lineTo(i[3],r[1]),e.moveTo(i[0],r[2]),e.lineTo(i[3],r[2]),e.moveTo(i[1],r[0]),e.lineTo(i[1],r[3]),e.moveTo(i[2],r[0]),e.lineTo(i[2],r[3]),e.stroke(),e.closePath(),e.restore()},_caculateInnerPosition:function(e,t){var n=[];return n[0]=e[1],n[1]=e[1]+t,n[2]=e[1]+2*t,n[3]=e[2],n},_getCoordinates:function(){var e=this.canvas,t=this.width,n=this.height,o=this.left,i=this.top,r=t/2,a=n/2,s=e.getZoom(),c=e.getWidth()/s,u=e.getHeight()/s;return{x:l.default.map([-(r+o),-r,r,c-o-t+r],Math.ceil),y:l.default.map([-(a+i),-a,a,u-i-n+a],Math.ceil)}},_strokeBorder:function(e,t,n){var o=n.lineDashWidth,i=n.lineDashOffset,r=n.lineWidth,a=this.width/2,s=this.height/2;e.save(),e.strokeStyle=t,e.setLineDash&&e.setLineDash([o,o]),i&&(e.lineDashOffset=i),r&&(e.lineWidth=r),e.beginPath(),e.moveTo(-a,-s),e.lineTo(a,-s),e.lineTo(a,s),e.lineTo(-a,s),e.lineTo(-a,-s),e.stroke(),e.restore()},_onMoving:function(){var e=this.height,t=this.width,n=this.left,o=this.top,i=this.canvas.getZoom(),r=this.canvas.getWidth()/i-t,a=this.canvas.getHeight()/i-e;this.left=(0,h.clamp)(n,0,r),this.top=(0,h.clamp)(o,0,a),this.canvasEventTrigger[s.eventNames.OBJECT_MOVED](this)},_onScaling:function(e){var t=e.transform.corner,n=this.canvas.getPointer(e.e);this.scale(1);var o=this._calcScalingSizeFromPointer(n,t);this.set(o),this.canvasEventTrigger[s.eventNames.OBJECT_SCALED](this)},_calcScalingSizeFromPointer:function(e,t){var n;return(n=t,0<=c.indexOf(n))&&this._resizeCropZone(e,t)},adjustRatioCropzoneSize:function(e){var t=e.width,n=e.height,o=e.leftMaker,i=e.topMaker,r=e.maxWidth,a=e.maxHeight,s=e.scaleTo;if(t=r?(0,h.clamp)(t,1,r):t,n=a?(0,h.clamp)(n,1,a):n,!this.presetRatio)return this._withShiftKey&&(n<t?n=t:t<n&&(t=n)),{width:t,height:n,left:o(t),top:i(n)};"width"===s?n=t/this.presetRatio:t=n*this.presetRatio;var c=Math.min(r/t,a/n);if(c<=1){var u=[t,n].map(function(e){return e*c});t=u[0],n=u[1]}return{width:t,height:n,left:o(t),top:i(n)}},_getCropzoneRectInfo:function(){var e=this.canvas.getZoom(),t=this.canvas.getWidth()/e,n=this.canvas.getHeight()/e,o=this.getBoundingRect(!0,!0),i=o.top,r=o.left,a=o.width,s=o.height;return{rectTop:i,rectLeft:r,rectWidth:a,rectHeight:s,rectRight:r+a,rectBottom:i+s,canvasWidth:t,canvasHeight:n}},_resizeCropZone:function(e,t){var n=e.x,o=e.y,i=this._getCropzoneRectInfo(),r=i.rectWidth,a=i.rectHeight,s=i.rectTop,c=i.rectLeft,u=i.rectBottom,l=i.rectRight,h=i.canvasWidth,f=i.canvasHeight,d={tl:{width:l-n,height:u-o,leftMaker:function(e){return l-e},topMaker:function(e){return u-e},maxWidth:l,maxHeight:u,scaleTo:p(c-n,s-o)},tr:{width:n-c,height:u-o,leftMaker:function(){return c},topMaker:function(e){return u-e},maxWidth:h-c,maxHeight:u,scaleTo:p(n-l,s-o)},mt:{width:r,height:u-o,leftMaker:function(){return c},topMaker:function(e){return u-e},maxWidth:h-c,maxHeight:u,scaleTo:"height"},ml:{width:l-n,height:a,leftMaker:function(e){return l-e},topMaker:function(){return s},maxWidth:l,maxHeight:f-s,scaleTo:"width"},mr:{width:n-c,height:a,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:h-c,maxHeight:f-s,scaleTo:"width"},mb:{width:r,height:o-s,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:h-c,maxHeight:f-s,scaleTo:"height"},bl:{width:l-n,height:o-s,leftMaker:function(e){return l-e},topMaker:function(){return s},maxWidth:l,maxHeight:f-s,scaleTo:p(c-n,o-u)},br:{width:n-c,height:o-s,leftMaker:function(){return c},topMaker:function(){return s},maxWidth:h-c,maxHeight:f-s,scaleTo:p(n-l,o-u)}};return this.adjustRatioCropzoneSize(d[t])},isValid:function(){return 0<=this.left&&0<=this.top&&0<this.width&&0<this.height},_onKeyDown:function(e){e.keyCode===s.keyCodes.SHIFT&&(this._withShiftKey=!0)},_onKeyUp:function(e){e.keyCode===s.keyCodes.SHIFT&&(this._withShiftKey=!1)}});t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=u(n(2)),a=u(n(7)),s=n(1),c=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,a.default),o(h,[{key:"getCurrentSetting",value:function(){var e=this.getCanvasImage();return{flipX:e.flipX,flipY:e.flipY}}},{key:"set",value:function(e){var t=this.getCurrentSetting(),n=t.flipX!==e.flipX,o=t.flipY!==e.flipY;return n||o?(r.default.extend(t,e),this.setImageProperties(t,!0),this._invertAngle(n,o),this._flipObjects(n,o),s.Promise.resolve({flipX:t.flipX,flipY:t.flipY,angle:this.getCanvasImage().angle})):s.Promise.reject(c.rejectMessages.flip)}},{key:"_invertAngle",value:function(e,t){var n=this.getCanvasImage(),o=n.angle;e&&(o*=-1),t&&(o*=-1),n.rotate(parseFloat(o)).setCoords()}},{key:"_flipObjects",value:function(e,t){var n=this.getCanvas();e&&n.forEachObject(function(e){e.set({angle:parseFloat(-1*e.angle),flipX:!e.flipX,left:n.width-e.left}).setCoords()}),t&&n.forEachObject(function(e){e.set({angle:parseFloat(-1*e.angle),flipY:!e.flipY,top:n.height-e.top}).setCoords()}),n.renderAll()}},{key:"reset",value:function(){return this.set({flipX:!1,flipY:!1})}},{key:"flipX",value:function(){var e=this.getCurrentSetting();return this.set({flipX:!e.flipX,flipY:e.flipY})}},{key:"flipY",value:function(){var e=this.getCurrentSetting();return this.set({flipX:e.flipX,flipY:!e.flipY})}}]),h);function h(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,c.componentNames.FLIP,e))}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=u(n(4)),r=u(n(7)),a=n(1),s=n(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(h,r.default),o(h,[{key:"getCurrentAngle",value:function(){return this.getCanvasImage().angle}},{key:"setAngle",value:function(e){var t=this.getCurrentAngle()%360;e%=360;var n=this.getCanvasImage(),o=n.getCenterPoint();n.set({angle:e}).setCoords(),this.adjustCanvasDimensionForRotate();var i=n.getCenterPoint();return this._rotateForEachObject(o,i,e-t),a.Promise.resolve(e)}},{key:"_rotateForEachObject",value:function(i,e,r){var t=this.getCanvas(),a=i.x-e.x,s=i.y-e.y;t.forEachObject(function(e){var t=e.getCenterPoint(),n=c.default.util.degreesToRadians(r),o=c.default.util.rotatePoint(t,i,n);e.set({left:o.x-a,top:o.y-s,angle:(e.angle+r)%360}),e.setCoords()}),t.renderAll()}},{key:"rotate",value:function(e){var t=this.getCurrentAngle();return this.setAngle(t+e)}}]),h);function h(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,s.componentNames.ROTATION,e))}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=c(n(4)),a=c(n(7)),s=n(0);function c(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,a.default),o(l,[{key:"start",value:function(e){var t=this.getCanvas();t.isDrawingMode=!0,this.setBrush(e),t.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;e=e||{},this.width=e.width||this.width,e.color&&(this.oColor=new r.default.Color(e.color)),t.width=this.width,t.color=this.oColor.toRgba()}},{key:"end",value:function(){var e=this.getCanvas();e.isDrawingMode=!1,e.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(){var e=this.getCanvas();e.isDrawingMode=!0,e.on({"mouse:up":this._listeners.mouseup})}},{key:"_onFabricMouseUp",value:function(e){var t=this.getCanvas(),n=t.findTarget(e.e);n&&(n.set({perPixelTargetFind:!1}),t.setActiveObject(n)),t.off({"mouse:up":this._listeners.mouseup}),t.isDrawingMode=!1}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,s.componentNames.FREE_DRAWING,e));return t.width=12,t.oColor=new r.default.Color("rgba(0, 0, 0, 0.5)"),t._listeners={mousedown:t._onFabricMouseDown.bind(t),mouseup:t._onFabricMouseUp.bind(t)},t}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a=l(n(2)),r=l(n(4)),s=l(n(7)),c=l(n(123)),u=n(0);function l(e){return e&&e.__esModule?e:{default:e}}var h=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,s.default),o(f,[{key:"setHeadOption",value:function(e){var t=e.arrowType,n=void 0===t?{head:null,tail:null}:t;this._arrowType=n}},{key:"start",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=this.getCanvas();n.defaultCursor="crosshair",n.selection=!1,this.setHeadOption(t),this.setBrush(t),n.forEachObject(function(e){e.set({evented:!1})}),n.on({"mouse:down":this._listeners.mousedown})}},{key:"setBrush",value:function(e){var t=this.getCanvas().freeDrawingBrush;e=e||{},this._width=e.width||this._width,e.color&&(this._oColor=new r.default.Color(e.color)),t.width=this._width,t.color=this._oColor.toRgba()}},{key:"end",value:function(){var e=this.getCanvas();e.defaultCursor="default",e.selection=!0,e.forEachObject(function(e){e.set({evented:!0})}),e.off("mouse:down",this._listeners.mousedown)}},{key:"_onFabricMouseDown",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e),o=n.x,i=n.y,r=[o,i,o,i];this._line=new c.default(r,{stroke:this._oColor.toRgba(),strokeWidth:this._width,arrowType:this._arrowType,evented:!1,perPixelTargetFind:!0,targetFindTolerance:u.defaultPixelTargetTolerance,angle:0}),this._line.set(u.fObjectOptions.SELECTION_STYLE),t.add(this._line),t.on({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup}),this.fire(u.eventNames.ADD_OBJECT,this._createLineEventObjectProperties())}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas(),n=t.getPointer(e.e);this._line.set({x2:n.x,y2:n.y}),this._line.setCoords(),t.renderAll()}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas();this.fire(u.eventNames.OBJECT_ADDED,this._createLineEventObjectProperties()),e.forEachObject(function(e){e.set({evented:!0})}),e.setActiveObject(this._line),e.requestRenderAll(),this._line=null,e.off({"mouse:move":this._listeners.mousemove,"mouse:up":this._listeners.mouseup})}},{key:"_createLineEventObjectProperties",value:function(){var e=this.graphics.createObjectProperties(this._line),t=this._line,n=t.x1,o=t.x2,i=t.y1,r=t.y2;return a.default.extend({},e,{startPosition:{x:n,y:i},endPosition:{x:o,y:r}})}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,u.componentNames.LINE,e));return t._width=12,t._oColor=new r.default.Color("rgba(0, 0, 0, 0.5)"),t._listeners={mousedown:t._onFabricMouseDown.bind(t),mousemove:t._onFabricMouseMove.bind(t),mouseup:t._onFabricMouseUp.bind(t)},t}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};var a=r.default.util.createClass(r.default.Line,{type:"line",initialize:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};this.callSuper("initialize",e,n),this.arrowType=n.arrowType},_render:function(e){var t=this.calcLinePoints(),n={fromX:t.x1,fromY:t.y1,toX:t.x2,toY:t.y2};(this.ctx=e).lineWidth=this.strokeWidth,this._renderBasicLinePath(n),this._drawDecoratorPath(n),this._renderStroke(e)},_renderBasicLinePath:function(e){var t=e.fromX,n=e.fromY,o=e.toX,i=e.toY;this.ctx.beginPath(),this.ctx.moveTo(t,n),this.ctx.lineTo(o,i)},_drawDecoratorPath:function(e){this._drawDecoratorPathType("head",e),this._drawDecoratorPathType("tail",e)},_drawDecoratorPathType:function(e,t){switch(this.arrowType[e]){case"triangle":this._drawTrianglePath(e,t);break;case"chevron":this._drawChevronPath(e,t)}},_drawTrianglePath:function(e,t){var n=1.7*this.ctx.lineWidth;this._drawChevronPath(e,t,n),this.ctx.closePath()},_drawChevronPath:function(e,t,n){var o=this,i=t.fromX,r=t.fromY,a=t.toX,s=t.toY,c=this.ctx;n=n||2.7*this.ctx.lineWidth;function u(e){return o.getRotatePosition(n,e,{x:h,y:f})}var l="head"===e?[i,r]:[a,s],h=l[0],f=l[1],d="head"===e?[a,s]:[i,r],p=d[0],v=d[1],g=180*Math.atan2(v-f,p-h)/Math.PI;c.moveTo.apply(c,u(30+g)),c.lineTo(h,f),c.lineTo.apply(c,u(g-30))},getRotatePosition:function(e,t,n){var o=t*Math.PI/180,i=n.x,r=n.y;return[e*Math.cos(o)+i,e*Math.sin(o)+r]}});t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=a(n(2)),u=a(n(4)),r=a(n(7)),l=n(1),h=n(0),f=n(23);function a(e){return e&&e.__esModule?e:{default:e}}var s={fill:"#000000",left:0,top:0,angle:0},d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,r.default),o(p,[{key:"start",value:function(){var e=this.getCanvas();this.isPrevEditing=!1,e.selection=!1,e.defaultCursor="text",e.on({"mouse:down":this._listeners.mousedown,"selection:created":this._listeners.select,"selection:updated":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:scaling":this._listeners.scaling,"text:changed":this._listeners.textChanged}),this.setCanvasRatio()}},{key:"end",value:function(){var t=this.getCanvas();t.selection=!0,t.defaultCursor="default",t.forEachObject(function(e){"i-text"===e.type&&""===e.text&&t.remove(e)}),t.off({"mouse:down":this._listeners.mousedown,"selection:created":this._listeners.select,"selection:updated":this._listeners.select,"before:selection:cleared":this._listeners.selectClear,"object:selected":this._listeners.select,"object:scaling":this._listeners.scaling,"text:changed":this._listeners.textChanged})}},{key:"adjustOriginPosition",value:function(e,t){var n="center",o="center";"start"===t&&(n="left",o="top");var i=e.getPointByOrigin(n,o),r=i.x,a=i.y;e.set({left:r,top:a,originX:n,originY:o}),e.setCoords()}},{key:"add",value:function(r,a){var s=this;return new l.Promise(function(e){var t=s.getCanvas(),n=null,o=h.fObjectOptions.SELECTION_STYLE,i=s._defaultStyles;s._setInitPos(a.position),a.styles&&"textDecoration"in(i=c.default.extend(i,a.styles))&&c.default.extend(i,s._getTextDecorationAdaptObject(i.textDecoration)),c.default.isExisty(a.autofocus)||(a.autofocus=!0),n=new u.default.IText(r,i),o=c.default.extend({},o),n.set(o),n.on({mouseup:s._onFabricMouseUp.bind(s)}),t.add(n),a.autofocus&&(n.enterEditing(),n.selectAll()),t.getActiveObject()||t.setActiveObject(n),s.isPrevEditing=!0,e(s.graphics.createObjectProperties(n))})}},{key:"change",value:function(t,n){var o=this;return new l.Promise(function(e){t.set("text",n),o.getCanvas().renderAll(),e()})}},{key:"setStyle",value:function(r,a){var s=this;return new l.Promise(function(e){"textDecoration"in a&&c.default.extend(a,s._getTextDecorationAdaptObject(a.textDecoration));var t=r.isEditing,n=0,o=0;if(r.isEditing&&(n=r.selectionStart,o=r.selectionEnd,r.exitEditing()),r.set(a),t){r.enterEditing(),r.setSelectionStart(n),r.setSelectionEnd(o),s.fire(h.eventNames.TEXT_EDITING);var i=s.graphics.getObjectId(r);null!==i&&(0,f.setCachedUndoDataForDimension)((0,f.makeSelectionUndoData)(r,function(){return(0,f.makeSelectionUndoDatum)(i,r,!1)}))}s.getCanvas().renderAll(),e()})}},{key:"getText",value:function(e){return e.text}},{key:"setSelectedInfo",value:function(e,t){this._selectedObj=e,this._isSelected=t}},{key:"isSelected",value:function(){return this._isSelected}},{key:"getSelectedObj",value:function(){return this._selectedObj}},{key:"setCanvasRatio",value:function(){var e=this.getCanvasElement(),t=parseInt(e.style.maxWidth,10),n=e.width;this._ratio=n/t}},{key:"getCanvasRatio",value:function(){return this._ratio}},{key:"_getTextDecorationAdaptObject",value:function(e){return{underline:"underline"===e,linethrough:"line-through"===e,overline:"overline"===e}}},{key:"_setInitPos",value:function(e){e=e||this.getCanvasImage().getCenterPoint(),this._defaultStyles.left=e.x,this._defaultStyles.top=e.y}},{key:"_onInput",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._textarea.style;n.width=Math.ceil(t.width/e)+"px",n.height=Math.ceil(t.height/e)+"px"}},{key:"_onKeyDown",value:function(){var e=this,t=this.getCanvasRatio(),n=this._editingObj,o=this._textarea.style;setTimeout(function(){n.text(e._textarea.value),o.width=Math.ceil(n.width/t)+"px",o.height=Math.ceil(n.height/t)+"px"},0)}},{key:"_onBlur",value:function(){var e=this.getCanvasRatio(),t=this._editingObj,n=this._editingObjInfos,o=this._textarea.value,i=t.width/e-n.width/e,r=t.height/e-n.height/e;if(1===e&&(i/=2,r/=2),this._textarea.style.display="none",t.set({left:n.left+i,top:n.top+r}),o.length){this.getCanvas().add(t);var a={id:c.default.stamp(t),type:t.type,text:o};this.fire(h.eventNames.TEXT_CHANGED,a)}}},{key:"_onScroll",value:function(){this._textarea.scrollLeft=0,this._textarea.scrollTop=0}},{key:"_onFabricScaling",value:function(e){var t=e.target;t.fontSize=t.fontSize*t.scaleY,t.scaleX=1,t.scaleY=1}},{key:"_onFabricTextChanged",value:function(e){this.fire(h.eventNames.TEXT_CHANGED,e.target)}},{key:"_onFabricSelectClear",value:function(e){var t=this.getSelectedObj();this.isPrevEditing=!0,this.setSelectedInfo(e.target,!1),t&&""===t.text&&this.getCanvas().remove(t)}},{key:"_onFabricSelect",value:function(e){this.isPrevEditing=!0,this.setSelectedInfo(e.target,!0)}},{key:"_onFabricMouseDown",value:function(e){var t=e.target;t&&!t.isType("text")||(this.isPrevEditing?this.isPrevEditing=!1:this._fireAddText(e))}},{key:"_fireAddText",value:function(e){var t=e.target,n=e.e||{},o=this.getCanvas().getPointer(n);t||this.fire(h.eventNames.ADD_TEXT,{originPosition:{x:o.x,y:o.y},clientPosition:{x:n.clientX||0,y:n.clientY||0}})}},{key:"_onFabricMouseUp",value:function(e){var t=e.target,n=(new Date).getTime();this._isDoubleClick(n)&&!t.isEditing&&t.enterEditing(),t.isEditing&&this.fire(h.eventNames.TEXT_EDITING),this._lastClickTime=n}},{key:"_isDoubleClick",value:function(e){return e-this._lastClickTime<500}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,h.componentNames.TEXT,e));return t._defaultStyles=s,t._isSelected=!1,t._selectedObj={},t._editingObj={},t._listeners={mousedown:t._onFabricMouseDown.bind(t),select:t._onFabricSelect.bind(t),selectClear:t._onFabricSelectClear.bind(t),scaling:t._onFabricScaling.bind(t),textChanged:t._onFabricTextChanged.bind(t)},t._textarea=null,t._ratio=1,t._lastClickTime=(new Date).getTime(),t._editingObjInfos={},t.isPrevEditing=!1,t}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=s(n(2)),r=s(n(4)),a=s(n(7)),l=n(1),h=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var c={arrow:"M 0 9 H 11 V 12 L 18 7 L 11 2 V 5 H 0 Z",arrow2:"M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z",cancel:"M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z"},f=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,a.default),o(d,[{key:"setStates",value:function(e,t){this._type=e,this._iconColor=t}},{key:"start",value:function(){var e=this.getCanvas();e.selection=!1,e.on("mouse:down",this._handlers.mousedown)}},{key:"end",value:function(){var e=this.getCanvas();e.selection=!0,e.off({"mouse:down":this._handlers.mousedown})}},{key:"add",value:function(a,s){var c=this;return new l.Promise(function(e,t){var n=c.getCanvas(),o=c._pathMap[a],i=h.fObjectOptions.SELECTION_STYLE,r=o?c._createIcon(o):null;(c._icon=r)||t(h.rejectMessages.invalidParameters),r.set(u.default.extend({type:"icon",fill:c._oColor,angle:0},i,s,c.graphics.controlStyle)),n.add(r).setActiveObject(r),e(c.graphics.createObjectProperties(r))})}},{key:"registerPaths",value:function(e){var n=this;u.default.forEach(e,function(e,t){n._pathMap[t]=e},this)}},{key:"setColor",value:function(e,t){this._oColor=e,t&&"icon"===t.get("type")&&(t.set({fill:this._oColor}),this.getCanvas().renderAll())}},{key:"getColor",value:function(e){return e.fill}},{key:"_createIcon",value:function(e){return new r.default.Path(e)}},{key:"_onFabricMouseDown",value:function(e){var t=this,n=this.getCanvas();this._startPoint=n.getPointer(e.e);var o=this._startPoint,i=o.x,r=o.y;this.add(this._type,{left:i,top:r,fill:this._iconColor}).then(function(){t.fire(h.eventNames.ADD_OBJECT,t.graphics.createObjectProperties(t._icon)),n.on("mouse:move",t._handlers.mousemove),n.on("mouse:up",t._handlers.mouseup)})}},{key:"_onFabricMouseMove",value:function(e){var t=this.getCanvas();if(this._icon){var n=t.getPointer(e.e),o=(n.x-this._startPoint.x)/this._icon.width,i=(n.y-this._startPoint.y)/this._icon.height;this._icon.set({scaleX:Math.abs(2*o),scaleY:Math.abs(2*i)}),this._icon.setCoords(),t.renderAll()}}},{key:"_onFabricMouseUp",value:function(){var e=this.getCanvas();this.fire(h.eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(this._icon)),this._icon=null,e.off("mouse:down",this._handlers.mousedown),e.off("mouse:move",this._handlers.mousemove),e.off("mouse:up",this._handlers.mouseup)}}]),d);function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,h.componentNames.ICON,e));return t._oColor="#000000",t._pathMap=c,t._type=null,t._iconColor=null,t._handlers={mousedown:t._onFabricMouseDown.bind(t),mousemove:t._onFabricMouseMove.bind(t),mouseup:t._onFabricMouseUp.bind(t)},t}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=n(2),a=p(n(4)),s=p(n(7)),c=n(1),u=n(0),l=p(n(127)),h=p(n(128)),f=p(n(129)),d=p(n(130));function p(e){return e&&e.__esModule?e:{default:e}}var v=a.default.Image.filters;v.Mask=l.default,v.Sharpen=h.default,v.Emboss=f.default,v.ColorFilter=d.default;var g=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(m,s.default),o(m,[{key:"add",value:function(r,a){var s=this;return new c.Promise(function(e,t){var n=s._getSourceImage(),o=s.getCanvas(),i=s._getFilter(n,r);(i=i||s._createFilter(n,r,a))||t(u.rejectMessages.invalidParameters),s._changeFilterValues(i,a),s._apply(n,function(){o.renderAll(),e({type:r,action:"add",options:a})})})}},{key:"remove",value:function(r){var a=this;return new c.Promise(function(e,t){var n=a._getSourceImage(),o=a.getCanvas(),i=a.getOptions(r);n.filters.length||t(u.rejectMessages.unsupportedOperation),a._removeFilter(n,r),a._apply(n,function(){o.renderAll(),e({type:r,action:"remove",options:i})})})}},{key:"hasFilter",value:function(e){return!!this._getFilter(this._getSourceImage(),e)}},{key:"getOptions",value:function(e){var t=this._getSourceImage(),n=this._getFilter(t,e);return n?(0,r.extend)({},n.options):null}},{key:"_changeFilterValues",value:function(n,o){(0,r.forEach)(o,function(e,t){(0,r.isUndefined)(n[t])||(n[t]=e)}),(0,r.forEach)(n.options,function(e,t){(0,r.isUndefined)(o[t])||(n.options[t]=o[t])})}},{key:"_apply",value:function(e,t){e.filters.push(),e.applyFilters()&&t()}},{key:"_getSourceImage",value:function(){return this.getCanvasImage()}},{key:"_createFilter",value:function(e,t,n){var o=void 0,i=this._getFabricFilterType(t),r=a.default.Image.filters[i];return r&&((o=new r(n)).options=n,e.filters.push(o)),o}},{key:"_getFilter",value:function(e,t){var n=null;if(e){var o=this._getFabricFilterType(t),i=e.filters.length,r=void 0,a=void 0;for(a=0;a<i;a+=1)if((r=e.filters[a]).type===o){n=r;break}}return n}},{key:"_removeFilter",value:function(e,t){var n=this._getFabricFilterType(t);e.filters=(0,r.filter)(e.filters,function(e){return e.type!==n})}},{key:"_getFabricFilterType",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}]),m);function m(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,u.componentNames.FILTER,e))}t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};var a=r.default.util.createClass(r.default.Image.filters.BlendImage,{applyTo:function(e){if(this.mask){var t=e.canvasEl,n=t.width,o=t.height,i=this._createCanvasOfMask(n,o),r=t.getContext("2d"),a=i.getContext("2d"),s=r.getImageData(0,0,n,o);this._drawMask(a,t,r),this._mapData(a,s,n,o),e.imageData=s}},_createCanvasOfMask:function(e,t){var n=r.default.util.createCanvasElement();return n.width=e,n.height=t,n},_drawMask:function(e){var t=this.mask,n=t.getElement(),o=t.angle,i=t.left,r=t.scaleX,a=t.scaleY,s=t.top;e.save(),e.translate(i,s),e.rotate(o*Math.PI/180),e.scale(r,a),e.drawImage(n,-n.width/2,-n.height/2),e.restore()},_mapData:function(e,t,n,o){for(var i=t.data,r=t.height,a=i,s=t.width*r*4,c=e.getImageData(0,0,n,o).data,u=0;u<s;u+=4)a[u+3]=c[u]}});t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};var a=r.default.util.createClass(r.default.Image.filters.Convolute,{type:"Sharpen",initialize:function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]}});t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};var a=r.default.util.createClass(r.default.Image.filters.Convolute,{type:"Emboss",initialize:function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]}});t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(4),u=(o=i)&&o.__esModule?o:{default:o};var r=u.default.util.createClass(u.default.Image.filters.BaseFilter,{type:"ColorFilter",initialize:function(e){e=e||{},this.color=e.color||"#FFFFFF",this.threshold=e.threshold||45,this.x=e.x||null,this.y=e.y||null},applyTo:function(e){var t,n=e.canvasEl,o=n.getContext("2d"),i=o.getImageData(0,0,n.width,n.height),r=i.data,a=this.threshold,s=u.default.Color.sourceFromHex(this.color),c=void 0;for(this.x&&this.y&&(s=this._getColor(i,this.x,this.y)),c=0,t=r.length;c<t;c+=4)this._isOutsideThreshold(r[c],s[0],a)||this._isOutsideThreshold(r[c+1],s[1],a)||this._isOutsideThreshold(r[c+2],s[2],a)||(r[c]=r[c+1]=r[c+2]=r[c+3]=0);o.putImageData(i,0,0)},_isOutsideThreshold:function(e,t,n){var o=e-t;return Math.abs(o)>n},_getColor:function(e,t,n){var o=[0,0,0,0],i=e.data,r=4*(e.width*n+t);return o[0]=i[r],o[1]=i[1+r],o[2]=i[2+r],o[3]=i[3+r],o}});t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=n(2),r=s(n(4)),a=s(n(7)),u=s(n(66)),l=n(132),h=n(1),f=n(0);function s(e){return e&&e.__esModule?e:{default:e}}var d=(0,c.extend)({angle:0,strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:1,height:1,rx:0,ry:0},f.SHAPE_DEFAULT_OPTIONS);function p(e,t,n){var o=e.fill,i=(0,h.getFillTypeFromOption)(e.fill),r=o;o.color&&(r=o.color);var a=null;if("filter"===i){var s=n();a=(0,l.makeFillPatternForFilter)(t,o.filter,s)}else a={fill:r};return(0,c.extend)({},e,a)}var v=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(g,a.default),o(g,[{key:"start",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="crosshair",e.selection=!1,e.uniformScaling=!0,e.forEachObject(function(e){e.set({evented:!1})}),e.on({"mouse:down":this._handlers.mousedown}),r.default.util.addListener(document,"keydown",this._handlers.keydown),r.default.util.addListener(document,"keyup",this._handlers.keyup)}},{key:"end",value:function(){var e=this.getCanvas();this._isSelected=!1,e.defaultCursor="default",e.selection=!0,e.uniformScaling=!1,e.off({"mouse:down":this._handlers.mousedown}),r.default.util.removeListener(document,"keydown",this._handlers.keydown),r.default.util.removeListener(document,"keyup",this._handlers.keyup)}},{key:"setStates",value:function(e,t){this._type=e,t&&(this._options=(0,c.extend)(this._options,t))}},{key:"add",value:function(r,a){var s=this;return new h.Promise(function(e){var t=s.getCanvas(),n=s._extendOptions(a),o=s._createInstance(r,n),i=s.graphics.createObjectProperties(o);s._bindEventOnShape(o),t.add(o).setActiveObject(o),s._resetPositionFillFilter(o),e(i)})}},{key:"change",value:function(a,s){var c=this;return new h.Promise(function(e,t){(0,h.isShape)(a)||t(f.rejectMessages.unsupportedType);var n="filter"===(0,h.getFillTypeFromOption)(s.fill),o=c.graphics,i=o.canvasImage,r=o.createStaticCanvas;a.set(n?p(s,i,r):s),n&&c._resetPositionFillFilter(a),c.getCanvas().renderAll(),e()})}},{key:"makeFillPropertyForUserEvent",value:function(e){var t=(0,h.getFillTypeFromObject)(e),n={};if(t===f.SHAPE_FILL_TYPE.FILTER){var o=(0,l.getFillImageFromShape)(e),i=(0,l.makeFilterOptionFromFabricImage)(o);n.type=t,n.filter=i}else n.type=f.SHAPE_FILL_TYPE.COLOR,n.color=e.fill||"transparent";return n}},{key:"processForCopiedObject",value:function(e,t){if(this._bindEventOnShape(e),"filter"===(0,h.getFillTypeFromObject)(e)){var n=(0,l.getFillImageFromShape)(t),o=(0,l.makeFilterOptionFromFabricImage)(n),i=this.graphics.createStaticCanvas();e.set((0,l.makeFillPatternForFilter)(this.graphics.canvasImage,o,i)),this._resetPositionFillFilter(e)}}},{key:"_createInstance",value:function(e,t){var n=void 0;switch(e){case"rect":n=new r.default.Rect(t);break;case"circle":n=new r.default.Ellipse((0,c.extend)({type:"circle"},t));break;case"triangle":n=new r.default.Triangle(t);break;default:n={}}return n}},{key:"_extendOptions",value:function(e){var t=f.fObjectOptions.SELECTION_STYLE,n=this.graphics,o=n.canvasImage,i=n.createStaticCanvas;return p(e=(0,c.extend)({},d,this._options,t,e),o,i)}},{key:"_bindEventOnShape",value:function(t){var n=this,o=this.getCanvas();t.on({added:function(){n._shapeObj=this,u.default.setOrigins(n._shapeObj)},selected:function(){n._isSelected=!0,n._shapeObj=this,o.uniformScaling=!0,o.defaultCursor="default",u.default.setOrigins(n._shapeObj)},deselected:function(){n._isSelected=!1,n._shapeObj=null,o.defaultCursor="crosshair",o.uniformScaling=!1},modified:function(){u.default.adjustOriginToCenter(this),u.default.setOrigins(this)},modifiedInGroup:function(e){n._fillFilterRePositionInGroupSelection(t,e)},moving:function(){n._resetPositionFillFilter(this)},rotating:function(){n._resetPositionFillFilter(this)},scaling:function(e){var t=o.getPointer(e.e);u.default.setOrigins(this),o.setCursor("crosshair"),u.default.resize(this,t,!0),n._resetPositionFillFilter(this)}})}},{key:"_onFabricMouseDown",value:function(e){if(e.target||(this._isSelected=!1,this._shapeObj=!1),!this._isSelected&&!this._shapeObj){var t=this.getCanvas();this._startPoint=t.getPointer(e.e),t.on({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}}},{key:"_onFabricMouseMove",value:function(e){var t=this,n=this.getCanvas(),o=n.getPointer(e.e),i=this._startPoint.x,r=this._startPoint.y,a=i-o.x,s=r-o.y,c=this._shapeObj;c?(this._shapeObj.set({isRegular:this._withShiftKey}),u.default.resize(c,o),n.renderAll(),this._resetPositionFillFilter(c)):5<Math.abs(a)&&5<Math.abs(s)&&(this._mouseMoved=!0,this.add(this._type,{left:i,top:r,width:a,height:s,perPixelTargetFind:!1}).then(function(e){t.fire(f.eventNames.ADD_OBJECT,e)}))}},{key:"_onFabricMouseUp",value:function(){var t=this,e=this.getCanvas(),n=this._startPoint.x,o=this._startPoint.y,i=this._shapeObj;this._mouseMoved&&(i?i&&(u.default.adjustOriginToCenter(i),this.fire(f.eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(i))):this.add(this._type,{left:n,top:o,width:20,height:20,perPixelTargetFind:!1}).then(function(e){t.fire(f.eventNames.ADD_OBJECT,e)}),this._mouseMoved=!1,e.defaultCursor="default",e.forEachObject(function(e){e.set({evented:!0})})),e.off({"mouse:move":this._handlers.mousemove,"mouse:up":this._handlers.mouseup})}},{key:"_onKeyDown",value:function(e){e.keyCode===f.keyCodes.SHIFT&&(this._withShiftKey=!0,this._shapeObj&&(this._shapeObj.isRegular=!0))}},{key:"_onKeyUp",value:function(e){e.keyCode===f.keyCodes.SHIFT&&(this._withShiftKey=!1,this._shapeObj&&(this._shapeObj.isRegular=!1))}},{key:"_resetPositionFillFilter",value:function(e){if("filter"===(0,h.getFillTypeFromObject)(e)){var t=(0,h.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas,n=(0,l.getFillImageFromShape)(e),o=(0,h.getCustomProperty)(n,"originalAngle").originalAngle;this.graphics.canvasImage.angle!==o&&(0,l.reMakePatternImageSource)(e,this.graphics.canvasImage);var i=e.originX,r=e.originY;u.default.adjustOriginToCenter(e),e.width*=e.scaleX,e.height*=e.scaleY,e.rx*=e.scaleX,e.ry*=e.scaleY,e.scaleX=1,e.scaleY=1,(0,l.rePositionFilterTypeFillImage)(e),(0,h.changeOrigin)(e,{originX:i,originY:r}),(0,l.resetFillPatternCanvas)(t)}}},{key:"_fillFilterRePositionInGroupSelection",value:function(e,t){1===t.scaleX&&1===t.scaleY||t.addWithUpdate();var n=e.angle,o=e.left,i=e.top;t.realizeTransform(e),this._resetPositionFillFilter(e),e.set({angle:n,left:o,top:i})}}]),g);function g(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,f.componentNames.SHAPE,e));return t._shapeObj=null,t._type="rect",t._options=(0,c.extend)({},d),t._isSelected=!1,t._startPoint={},t._withShiftKey=!1,t._mouseMoved=!1,t._handlers={mousedown:t._onFabricMouseDown.bind(t),mousemove:t._onFabricMouseMove.bind(t),mouseup:t._onFabricMouseUp.bind(t),keydown:t._onKeyDown.bind(t),keyup:t._onKeyUp.bind(t)},t}t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFillImageFromShape=y,t.rePositionFilterTypeFillImage=function(e){var t=e.angle,n=e.flipX,o=e.flipY,i=y(e),r=function(e){var t=C(e),n=t[0],o=n.x,i=n.y,r=t[1],a=r.x,s=r.y,c=t[2],u=c.x,l=c.y,h=t[3],f=h.x,d=h.y,p=Math.min(o,a,u,f),v=Math.min(i,s,l,d),g=Math.max(o,a,u,f),m=Math.max(i,s,l,d);return{left:p,top:v,right:g,bottom:m,width:g-p,height:m-v}}(e),a=r.right,s=r.bottom,c=r.width,u=r.height,l=(c-e.width)/2,h=(u-e.height)/2,f=e.left-e.width/2-l,d=e.top-e.height/2-h,p=c/2-l,v=u/2-h,g=Math.max(c,u)+Math.max(l,h),m=function(e){function t(e,t,n,o){return r=(i={type:e,outDistance:t,shapeObj:m,flipX:_,flipY:y,left:n,top:o}).type,a=i.shapeObj,s=i.outDistance,c=i.left,u=i.top,l=i.flipX,h=i.flipY,f=C(a),d=function(n,e,t){var o=0,i=0;(0,b.forEach)(e,function(e,t){e[n]<o&&(o=e[n],i=t)});var r=t[i],a=r[0],s=r[1];return{startPointIndex:i,endPointIndex1:a,endPointIndex2:s}}(r,f,[[1,2],[0,3],[0,3],[1,2]]),p=function(e,r,t){var a=t.startPointIndex,n=t.endPointIndex1,o=t.endPointIndex2,s="x"===e?180:270;return(0,b.map)([n,o],function(e){var t=r[a],n=r[e],o=t.y-n.y,i=t.x-n.x;return 180*Math.atan2(o,i)/Math.PI-s})}(r,f,d),v=d.startPointIndex,g=function(e){var t=e.outDistance,n=e.startPointIndex,o=e.flipX,i=e.flipY,r=e.reatAngles,a=t*Math.cos(r[0]*Math.PI/180),s=t*Math.cos(r[1]*Math.PI/180),c=2===n||3===n,u={top:c?a:s,left:c?s:a};!function(e,t,n){return(!t&&n||!t&&!n)&&0===e||(t&&n||t&&!n)&&1===e||(!t&&!n||!t&&n)&&2===e||(t&&!n||t&&n)&&3===e}(n,o,i)||(u.left=-1*u.left);!function(e,t,n){return(t&&!n||!t&&!n)&&0===e||(!t&&!n||t&&!n)&&1===e||(t&&n||!t&&n)&&2===e||(!t&&n||t&&n)&&3===e}(n,o,i)||(u.top=-1*u.top);return u}({outDistance:s,startPointIndex:v,flipX:l,flipY:h,reatAngles:p}),[c+g.left,u+g.top];var i,r,a,s,c,u,l,h,f,d,p,v,g}var m=e.shapeObj,n=e.left,o=e.top,i=e.width,r=e.height,a=e.cropX,s=e.cropY,_=e.flipX,y=e.flipY,c=e.right,u=e.bottom,l=i,h=r,f=function(s,e){var c=e.left,u=e.top,t=e.width,n=e.height,l=e.cropX,h=e.cropY,f={width:t,height:n};return(0,b.forEach)(["x","y"],function(e){var t="x"===e?l:h,n=f[O[e]],o=E[O[e]];if(o<n){var i=(n-o)/2;f[O[e]]=o;var r=s(e,i,c,u);c=r[0],u=r[1]}if(t<0){var a=s(e,t,c,u);c=a[0],u=a[1]}}),[c,u,f.width,f.height]}(t,{left:n,top:o,width:i,height:r,cropX:a,cropY:s});n=f[0],o=f[1],i=f[2],r=f[3];var d=function(o,e){var i=e.left,r=e.top,t=e.insideCanvasRealImageWidth,n=e.insideCanvasRealImageHeight,a=e.right,s=e.bottom,c=e.cropX,u=e.cropY,l=e.originalWidth,h=e.originalHeight,f=t,d=n,p=E.width,v=E.height;p<a&&0<c&&(f=l-Math.abs(a-p));v<s&&0<u&&(d=h-Math.abs(s-v));var g={x:(t-f)/2,y:(n-d)/2};return(0,b.forEach)(["x","y"],function(e){var t=g[e];if(0<t){var n=o(e,t,i,r);i=n[0],r=n[1]}}),[i,r,f,d]}(t,{left:n,top:o,insideCanvasRealImageWidth:i,insideCanvasRealImageHeight:r,right:c,bottom:u,cropX:a,cropY:s,originalWidth:l,originalHeight:h});return n=d[0],o=d[1],i=d[2],r=d[3],[n,o,i,r]}({shapeObj:e,left:p,top:v,width:c,height:u,cropX:f,cropY:d,flipX:n,flipY:o,right:a,bottom:s});p=m[0],v=m[1],c=m[2],u=m[3],i.set({angle:n===o?-t:t,left:p,top:v,width:c,height:u,cropX:f,cropY:d,flipX:n,flipY:o}),(0,_.setCustomProperty)(i,{fillImageMaxSize:g})},t.makeFilterOptionFromFabricImage=u,t.makeFillPatternForFilter=function(e,t,n){var o=h(l(e),e.angle,t);n.add(o);var i={fill:new fabric.Pattern({source:n.getElement(),repeat:"no-repeat"})};return(0,_.setCustomProperty)(i,{patternSourceCanvas:n}),i},t.resetFillPatternCanvas=function(e){var t=e.getObjects()[0],n=(0,_.getCustomProperty)(t,"fillImageMaxSize").fillImageMaxSize;n=Math.max(1,n),e.setDimensions({width:n,height:n}),e.renderAll()},t.reMakePatternImageSource=function(e,t){var n=(0,_.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas,o=n.getObjects()[0],i=u(o);n.remove(o);var r=h(l(t,!0),t.angle,i);n.add(r)},t.getCachedCanvasImageElement=l;var o,b=n(2),i=n(66),r=(o=i)&&o.__esModule?o:{default:o},_=n(1);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s={pixelate:"blocksize",blur:"blur"},O={x:"width",y:"height"},c=(0,_.flipObject)(s),E=null;function y(e){return(0,_.getCustomProperty)(e,"patternSourceCanvas").patternSourceCanvas.getObjects()[0]}function u(e){return(0,b.map)(e.filters,function(e){var t=Object.keys(e)[0];return a({},c[t],e[t])})}function l(e){return E&&!(1<arguments.length&&void 0!==arguments[1]&&arguments[1])||(E=e.toCanvasElement()),E}function C(e){return[e.getPointByOrigin("left","top"),e.getPointByOrigin("right","top"),e.getPointByOrigin("left","bottom"),e.getPointByOrigin("right","bottom")]}function h(e,t,n){var i=new fabric.Image(e);return(0,b.forEach)(b.extend.apply(void 0,[{}].concat(n)),function(e,t){var n=(0,_.capitalizeString)(t),o=new fabric.Image.filters[n](a({},s[t],e));i.filters.push(o)}),i.applyFilters(),(0,_.setCustomProperty)(i,{originalAngle:t,fillImageMaxSize:Math.max(i.width,i.height)}),r.default.adjustOriginToCenter(i),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=c(n(4)),a=c(n(7)),O=n(1),s=n(0);function c(e){return e&&e.__esModule?e:{default:e}}var u={left:0,top:0,width:0,height:0,stroke:"#000000",strokeWidth:0,fill:"#000000",opacity:.4,evented:!1,selectable:!1,hoverCursor:"auto"},E=.0045,C=.003,k=.003,M=.0066,w=.0044,x=.003,l=s.eventNames.ZOOM_CHANGED,h=s.eventNames.ADD_TEXT,f=s.eventNames.TEXT_EDITING,d=s.eventNames.OBJECT_MODIFIED,p=s.eventNames.KEY_DOWN,v=s.eventNames.KEY_UP,g=s.eventNames.HAND_STARTED,m=s.eventNames.HAND_STOPPED,_=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(y,a.default),o(y,[{key:"attachKeyboardZoomEvents",value:function(){r.default.util.addListener(document,p,this._listeners.keydown),r.default.util.addListener(document,v,this._listeners.keyup)}},{key:"detachKeyboardZoomEvents",value:function(){r.default.util.removeListener(document,p,this._listeners.keydown),r.default.util.removeListener(document,v,this._listeners.keyup)}},{key:"_startTextEditingHandler",value:function(){this.isTextEditing=!0}},{key:"_stopTextEditingHandler",value:function(){this.isTextEditing=!1}},{key:"_startHandModeWithSpaceBar",value:function(e){this.withSpace||this.isTextEditing||e.keyCode===s.keyCodes.SPACE&&(this.withSpace=!0,this.startHandMode())}},{key:"_endHandModeWithSpaceBar",value:function(e){e.keyCode===s.keyCodes.SPACE&&(this.withSpace=!1,this.endHandMode())}},{key:"startZoomInMode",value:function(){if(!this.zoomArea){this.endHandMode(),this.zoomMode=s.zoomModes.ZOOM;var e=this.getCanvas();this._changeObjectsEventedState(!1),this.zoomArea=new r.default.Rect({left:0,top:0,width:.5,height:.5,stroke:"black",strokeWidth:1,fill:"transparent",hoverCursor:"zoom-in"}),e.discardActiveObject(),e.add(this.zoomArea),e.on("mouse:down",this._listeners.startZoom),e.selection=!1,e.defaultCursor="zoom-in"}}},{key:"endZoomInMode",value:function(){this.zoomMode=s.zoomModes.DEFAULT;var e=this.getCanvas(),t=this._listeners,n=t.startZoom,o=t.moveZoom,i=t.stopZoom;e.selection=!0,e.defaultCursor="auto",e.off({"mouse:down":n,"mouse:move":o,"mouse:up":i}),this._changeObjectsEventedState(!0),e.remove(this.zoomArea),this.zoomArea=null}},{key:"start",value:function(){this.zoomArea=null,this._startPoint=null,this._startHandPoint=null}},{key:"end",value:function(){this.endZoomInMode(),this.endHandMode()}},{key:"startHandMode",value:function(){this.endZoomInMode(),this.zoomMode=s.zoomModes.HAND;var e=this.getCanvas();this._changeObjectsEventedState(!1),e.discardActiveObject(),e.off("mouse:down",this._listeners.startHand),e.on("mouse:down",this._listeners.startHand),e.selection=!1,e.defaultCursor="grab",e.fire(g)}},{key:"endHandMode",value:function(){this.zoomMode=s.zoomModes.DEFAULT;var e=this.getCanvas();this._changeObjectsEventedState(!0),e.off("mouse:down",this._listeners.startHand),e.selection=!0,e.defaultCursor="auto",this._startHandPoint=null,e.fire(m)}},{key:"_onMouseDownWithZoomMode",value:function(e){var t=e.target,n=e.e;if(!t){var o=this.getCanvas();o.selection=!1,this._startPoint=o.getPointer(n),this.zoomArea.set({width:0,height:0});var i=this._listeners,r=i.moveZoom,a=i.stopZoom;o.on({"mouse:move":r,"mouse:up":a})}}},{key:"_onMouseMoveWithZoomMode",value:function(e){var t=e.e,n=this.getCanvas(),o=n.getPointer(t),i=o.x,r=o.y,a=this.zoomArea,s=this._startPoint;10<Math.abs(i-s.x)+Math.abs(r-s.y)&&(n.remove(a),a.set(this._calcRectDimensionFromPoint(i,r)),n.add(a))}},{key:"_calcRectDimensionFromPoint",value:function(e,t){var n=this.getCanvas(),o=n.getWidth(),i=n.getHeight(),r=this._startPoint,a=r.x,s=r.y,c=Math.min,u=c(a,e),l=c(s,t);return{left:u,top:l,width:(0,O.clamp)(e,a,o)-u,height:(0,O.clamp)(t,s,i)-l}}},{key:"_onMouseUpWithZoomMode",value:function(){var e=this.zoomLevel,t=this.zoomArea,n=this._listeners,o=n.moveZoom,i=n.stopZoom,r=this.getCanvas(),a=this._getCenterPoint(),s=a.x,c=a.y;this._isMaxZoomLevel()||(this._centerPoints.push({x:s,y:c,prevZoomLevel:e,zoomLevel:e+1}),e+=1,r.zoomToPoint({x:s,y:c},e),this._fireZoomChanged(r,e),this.zoomLevel=e),r.off({"mouse:move":o,"mouse:up":i}),r.remove(t),this._startPoint=null}},{key:"_getCenterPoint",value:function(){var e=this.zoomArea,t=e.left,n=e.top,o=e.width,i=e.height,r=this._startPoint,a=r.x,s=r.y,c=this.aspectRatio;return o<10&&i<10?{x:a,y:s}:i<o?{x:t+c*i/2,y:n+i/2}:{x:t+o/2,y:n+o/c/2}}},{key:"zoom",value:function(e,t){for(var n=e.x,o=e.y,i=1<arguments.length&&void 0!==t?t:this.zoomLevel,r=this.getCanvas(),a=this._centerPoints,s=a.length-1;0<=s&&!(a[s].zoomLevel<i);--s){var c=a.pop(),u=c.x,l=c.y,h=c.prevZoomLevel;r.zoomToPoint({x:u,y:l},h),this.zoomLevel=h}r.zoomToPoint({x:n,y:o},i),this._isDefaultZoomLevel(i)||this._centerPoints.push({x:n,y:o,zoomLevel:i,prevZoomLevel:this.zoomLevel}),this.zoomLevel=i,this._fireZoomChanged(r,i)}},{key:"zoomOut",value:function(){var e=this._centerPoints;if(e.length){var t=this.getCanvas(),n=e.pop(),o=n.x,i=n.y,r=n.prevZoomLevel;this._isDefaultZoomLevel(r)?t.setViewportTransform([1,0,0,1,0,0]):t.zoomToPoint({x:o,y:i},r),this.zoomLevel=r,this._fireZoomChanged(t,this.zoomLevel)}}},{key:"resetZoom",value:function(){var e=this.getCanvas();e.setViewportTransform([1,0,0,1,0,0]),this.zoomLevel=1,this._centerPoints=[],this._fireZoomChanged(e,this.zoomLevel)}},{key:"_isMaxZoomLevel",value:function(){return 5<=this.zoomLevel}},{key:"_movePointOfZoom",value:function(e){var t=e.x,n=e.y,o=this._centerPoints;if(o.length){var i=this.getCanvas(),r=this.zoomLevel,a=o.pop(),s=a.x,c=a.y,u=a.prevZoomLevel,l=s-t,h=c-n;i.zoomToPoint({x:s,y:c},u),i.zoomToPoint({x:l,y:h},r),o.push({x:l,y:h,prevZoomLevel:u,zoomLevel:r}),this._fireZoomChanged(i,r)}}},{key:"_onMouseDownWithHandMode",value:function(e){var t=e.target,n=e.e;if(!t){var o=this.getCanvas();if(!(this.zoomLevel<=1)){o.selection=!1,this._startHandPoint=o.getPointer(n);var i=this._listeners,r=i.moveHand,a=i.stopHand;o.on({"mouse:move":r,"mouse:up":a})}}}},{key:"_onMouseMoveWithHandMode",value:function(e){var t=e.e,n=this.getCanvas().getPointer(t),o=n.x,i=n.y,r=o-this._startHandPoint.x,a=i-this._startHandPoint.y;this._movePointOfZoom({x:r,y:a})}},{key:"_onMouseUpWithHandMode",value:function(){var e=this.getCanvas(),t=this._listeners,n=t.moveHand,o=t.stopHand;e.off({"mouse:move":n,"mouse:up":o}),this._startHandPoint=null}},{key:"_changeScrollState",value:function(e){var t=e.viewport,n=e.zoomLevel,o=this.getCanvas();if(o.remove(this._verticalScroll),o.remove(this._horizontalScroll),!this._isDefaultZoomLevel(n)){var i=o.width,r=o.height,a=t.tl,s=t.tr,c=t.bl,u=s.x-a.x,l=c.y-a.y,h=u*u/i,f=l*M,d=(0,O.clamp)(a.x+a.x/i*u,a.x,s.x-h),p=l*w,v=l*x;this._horizontalScroll.set({left:d,top:c.y-f-p,width:h,height:f,rx:v,ry:v});var g=u*E,m=l*l/r,_=(0,O.clamp)(a.y+a.y/r*l,s.y,c.y-m),y=u*C,b=u*k;this._verticalScroll.set({left:s.x-g-y,top:_,width:g,height:m,rx:b,ry:b}),this._addScrollBar()}}},{key:"_changeObjectsEventedState",value:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this.getCanvas().forEachObject(function(e){e.evented=t})}},{key:"_addScrollBar",value:function(){var e=this,t=this.getCanvas();t.add(this._horizontalScroll),t.add(this._verticalScroll),this.scrollBarTid&&clearTimeout(this.scrollBarTid),this.scrollBarTid=setTimeout(function(){t.remove(e._horizontalScroll),t.remove(e._verticalScroll)},3e3)}},{key:"_isDefaultZoomLevel",value:function(e){return 1===e}},{key:"_fireZoomChanged",value:function(e,t){e.fire(l,{viewport:e.calcViewportBoundaries(),zoomLevel:t})}},{key:"mode",get:function(){return this.zoomMode}}]),y);function y(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,s.componentNames.ZOOM,e));t.zoomArea=null,t._startPoint=null,t._centerPoints=[],t.zoomLevel=1,t.zoomMode=s.zoomModes.DEFAULT,t._listeners={startZoom:t._onMouseDownWithZoomMode.bind(t),moveZoom:t._onMouseMoveWithZoomMode.bind(t),stopZoom:t._onMouseUpWithZoomMode.bind(t),startHand:t._onMouseDownWithHandMode.bind(t),moveHand:t._onMouseMoveWithHandMode.bind(t),stopHand:t._onMouseUpWithHandMode.bind(t),zoomChanged:t._changeScrollState.bind(t),keydown:t._startHandModeWithSpaceBar.bind(t),keyup:t._endHandModeWithSpaceBar.bind(t)};var n=t.getCanvas();return t.aspectRatio=n.width/n.height,t._verticalScroll=new r.default.Rect(u),t._horizontalScroll=new r.default.Rect(u),n.on(l,t._listeners.zoomChanged),t.graphics.on(h,t._startTextEditingHandler.bind(t)),t.graphics.on(f,t._startTextEditingHandler.bind(t)),t.graphics.on(d,t._stopTextEditingHandler.bind(t)),t}t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e){e.getComponent(c.componentNames.CROPPER).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.CROPPER).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.CROPPER))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e,t){e.getComponent(c.componentNames.FREE_DRAWING).start(t)}},{key:"end",value:function(e){e.getComponent(c.componentNames.FREE_DRAWING).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.FREE_DRAWING))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e,t){e.getComponent(c.componentNames.LINE).start(t)}},{key:"end",value:function(e){e.getComponent(c.componentNames.LINE).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.LINE_DRAWING))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e){e.getComponent(c.componentNames.SHAPE).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.SHAPE).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.SHAPE))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e){e.getComponent(c.componentNames.TEXT).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.TEXT).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.TEXT))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e){e.getComponent(c.componentNames.ICON).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.ICON).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.ICON))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r,a=n(15),s=(r=a)&&r.__esModule?r:{default:r},c=n(0);var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,s.default),o(l,[{key:"start",value:function(e){e.getComponent(c.componentNames.ZOOM).start()}},{key:"end",value:function(e){e.getComponent(c.componentNames.ZOOM).end()}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,c.drawingModes.ZOOM))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c=s.componentNames.ICON,u={name:s.commandNames.ADD_ICON,execute:function(t,e,n){var o=this,i=t.getComponent(c);return this.undoData&&this.undoData.object?(t.add(this.undoData.object),a.Promise.resolve(this.undoData.object)):i.add(e,n).then(function(e){return o.undoData.object=t.getObject(e.id),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(u),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);var s={name:n(0).commandNames.ADD_IMAGE_OBJECT,execute:function(t,e){var n=this;return t.addImageObject(e).then(function(e){return n.undoData.object=t.getObject(e.id),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(s),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c={name:s.commandNames.ADD_OBJECT,execute:function(n,o){return new a.Promise(function(e,t){n.contains(o)?t(s.rejectMessages.addedObject):(n.add(o),e(o))})},undo:function(n,o){return new a.Promise(function(e,t){n.contains(o)?(n.remove(o),e(o)):t(s.rejectMessages.noObject)})}};r.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c=s.componentNames.SHAPE,u={name:s.commandNames.ADD_SHAPE,execute:function(n,e,t){var o=this;return n.getComponent(c).add(e,t).then(function(e){var t=e.id;return o.undoData.object=n.getObject(t),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(u),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0),c=n(23);var u=s.componentNames.TEXT,l={name:s.commandNames.ADD_TEXT,execute:function(o,e,t){var i=this,n=o.getComponent(u);if(this.undoData.object){var r=this.undoData.object;return new a.Promise(function(e,t){o.contains(r)?t(s.rejectMessages.redo):(o.add(r),e(r))})}return n.add(e,t).then(function(e){var t=e.id,n=o.getObject(t);return i.undoData.object=n,(0,c.setCachedUndoDataForDimension)((0,c.makeSelectionUndoData)(n,function(){return(0,c.makeSelectionUndoDatum)(t,n,!1)})),e})},undo:function(e){return e.remove(this.undoData.object),a.Promise.resolve()}};r.default.register(l),t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=i(n(2)),o=i(n(3)),f=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var d=f.componentNames.FILTER,p=null;var r={name:f.commandNames.APPLY_FILTER,execute:function(e,t,n,o){var i,r,a,s=e.getComponent(d);if("mask"===t){var c=e.getObject(n.maskObjId);if(!c||!c.isType("image"))return Promise.reject(f.rejectMessages.invalidParameters);h.default.extend(n,{mask:c}),e.remove(n.mask)}if(!this.isRedo){var u=s.getOptions(t),l=(i=u,r=n,a={},"mask"===t&&(a.object=r.mask),a.options=i,a);p=this.setUndoData(l,p,o)}return s.add(t,n)},undo:function(e,t){var n=e.getComponent(d);if("mask"!==t)return this.undoData.options?n.add(t,this.undoData.options):n.remove(t);var o=this.undoData.object;return e.add(o),e.setActiveObject(o),n.remove(t)}};o.default.register(r),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},c=n(1),u=n(0);var l=u.componentNames.ICON,a={name:u.commandNames.CHANGE_ICON_COLOR,execute:function(i,r,a){var s=this;return new c.Promise(function(e,t){var n=i.getComponent(l),o=i.getObject(r);o||t(u.rejectMessages.noObject),s.undoData.object=o,s.undoData.color=n.getColor(o),n.setColor(a,o),e()})},undo:function(e){var t=e.getComponent(l),n=this.undoData,o=n.object,i=n.color;return t.setColor(i,o),c.Promise.resolve()}};r.default.register(a),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(n(2)),o=i(n(3)),h=n(1),f=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var d=f.componentNames.SHAPE,p=null;var r={name:f.commandNames.CHANGE_SHAPE,execute:function(e,t,n,o){var i,r,a,s=e.getComponent(d),c=e.getObject(t);if(!c)return h.Promise.reject(f.rejectMessages.noObject);if(!this.isRedo){var u=(i=n,a={object:r=c,options:{}},l.default.forEachOwnProperties(i,function(e,t){a.options[t]=r[t]}),a);p=this.setUndoData(u,p,o)}return s.change(c,n)},undo:function(e){var t=e.getComponent(d),n=this.undoData,o=n.object,i=n.options;return t.change(o,i)}};o.default.register(r),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c=s.componentNames.TEXT,u={name:s.commandNames.CHANGE_TEXT,execute:function(e,t,n){var o=e.getComponent(c),i=e.getObject(t);return i?(this.undoData.object=i,this.undoData.text=o.getText(i),o.change(i,n)):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e){var t=e.getComponent(c),n=this.undoData,o=n.object,i=n.text;return t.change(o,i)}};r.default.register(u),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i(n(2)),o=i(n(3)),h=n(1),f=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var d=f.componentNames.TEXT,p=null;var r={name:f.commandNames.CHANGE_TEXT_STYLE,execute:function(e,t,n,o){var i,r,a,s=e.getComponent(d),c=e.getObject(t);if(!c)return h.Promise.reject(f.rejectMessages.noObject);if(!this.isRedo){var u=(i=n,a={object:r=c,styles:{}},l.default.forEachOwnProperties(i,function(e,t){var n=r[t];a.styles[t]=n}),a);p=this.setUndoData(u,p,o)}return s.setStyle(c,n)},undo:function(e){var t=e.getComponent(d),n=this.undoData,o=n.object,i=n.styles;return t.setStyle(o,i)}};o.default.register(r),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);var s={name:n(0).commandNames.CLEAR_OBJECTS,execute:function(t){var n=this;return new a.Promise(function(e){n.undoData.objects=t.removeAll(),e()})},undo:function(e){return e.add(this.undoData.objects),a.Promise.resolve()}};r.default.register(s),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(0);var s=a.componentNames.FLIP,c={name:a.commandNames.FLIP_IMAGE,execute:function(e,t){var n=e.getComponent(s);return this.undoData.setting=n.getCurrentSetting(),n[t]()},undo:function(e){return e.getComponent(s).set(this.undoData.setting)}};r.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(0);var c=a.componentNames.IMAGE_LOADER,s={name:a.commandNames.LOAD_IMAGE,execute:function(e,t,n){var o=e.getComponent(c),i=o.getCanvasImage(),r=i?i.width:0,a=i?i.height:0,s=e.removeAll(!0).filter(function(e){return"cropzone"!==e.type});return s.forEach(function(e){e.evented=!0}),this.undoData={name:o.getImageName(),image:i,objects:s},o.load(t,n).then(function(e){return{oldWidth:r,oldHeight:a,newWidth:e.width,newHeight:e.height}})},undo:function(e){var t=e.getComponent(c),n=this.undoData,o=n.objects,i=n.name,r=n.image;return e.removeAll(!0),e.add(o),t.load(i,r)}};r.default.register(s),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(0);var s=a.componentNames.FILTER,c={name:a.commandNames.REMOVE_FILTER,execute:function(e,t){var n=e.getComponent(s);return this.undoData.options=n.getOptions(t),n.remove(t)},undo:function(e,t){var n=e.getComponent(s),o=this.undoData.options;return n.add(t,o)}};r.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c={name:s.commandNames.REMOVE_OBJECT,execute:function(n,o){var i=this;return new a.Promise(function(e,t){i.undoData.objects=n.removeObjectById(o),i.undoData.objects.length?e():t(s.rejectMessages.noObject)})},undo:function(e){return e.add(this.undoData.objects),a.Promise.resolve()}};r.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1);var s={name:n(0).commandNames.RESIZE_CANVAS_DIMENSION,execute:function(t,n){var o=this;return new a.Promise(function(e){o.undoData.size={width:t.cssMaxWidth,height:t.cssMaxHeight},t.setCssMaxDimension(n),t.adjustCanvasDimension(),e()})},undo:function(e){return e.setCssMaxDimension(this.undoData.size),e.adjustCanvasDimension(),a.Promise.resolve()}};r.default.register(s),t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(0);var s=a.componentNames.ROTATION,c=null;var u={name:a.commandNames.ROTATE_IMAGE,execute:function(e,t,n,o){var i=e.getComponent(s);if(!this.isRedo){var r={angle:i.getCurrentAngle()};c=this.setUndoData(r,c,o)}return i[t](n)},undo:function(e){var t=e.getComponent(s),n=this.args,o=n[1],i=n[2];return"setAngle"===o?t[o](this.undoData.angle):t.rotate(-i)}};r.default.register(u),t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(2)),o=i(n(3)),a=n(1),s=n(0);function i(e){return e&&e.__esModule?e:{default:e}}var c={name:s.commandNames.SET_OBJECT_PROPERTIES,execute:function(e,t,n){var o=this,i=e.getObject(t);return i?(this.undoData.props={},r.default.forEachOwnProperties(n,function(e,t){o.undoData.props[t]=i[t]}),e.setObjectProperties(t,n),a.Promise.resolve()):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e,t){var n=this.undoData.props;return e.setObjectProperties(t,n),a.Promise.resolve()}};o.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0);var c={name:s.commandNames.SET_OBJECT_POSITION,execute:function(e,t,n){return e.getObject(t)?(this.undoData.objectId=t,this.undoData.props=e.getObjectProperties(t,["left","top"]),e.setObjectPosition(t,n),e.renderAll(),a.Promise.resolve()):a.Promise.reject(s.rejectMessages.noObject)},undo:function(e){var t=this.undoData,n=t.objectId,o=t.props;return e.setObjectProperties(n,o),e.renderAll(),a.Promise.resolve()}};r.default.register(c),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(3),r=(o=i)&&o.__esModule?o:{default:o},a=n(1),s=n(0),c=n(23);var u={name:s.commandNames.CHANGE_SELECTION,execute:function(t,e){return this.isRedo?e.forEach(function(e){t.setObjectProperties(e.id,e)}):this.undoData=(0,c.getCachedUndoDataForDimension)(),a.Promise.resolve()},undo:function(t){return this.undoData.forEach(function(e){t.setObjectProperties(e.id,e)}),a.Promise.resolve()}};r.default.register(u),t.default=u}],i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist",i(i.s=67);function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var o,r});
//# sourceMappingURL=tui-image-editor.min.js.map